<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- üåê ENTERPRISE CUSTOMER PORTAL - Self-Service Request Management -->
    
    <!-- üé® Portal Request Kanban Dashboard -->
    <record id="view_portal_request_kanban" model="ir.ui.view">
        <field name="name">portal.request.kanban</field>
        <field name="model">portal.request</field>
        <field name="arch" type="xml">
            <kanban default_group_by="request_status" class="o_kanban_portal_request_dashboard">
                <field name="name"/>
                <field name="request_type"/>
                <field name="request_status"/>
                <field name="customer_id"/>
                <field name="priority"/>
                <field name="submission_date"/>
                <field name="target_completion_date"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_card_header">
                                <div class="o_kanban_card_header_title">
                                    <div class="o_primary">
                                        <strong>üåê <field name="name"/></strong>
                                    </div>
                                    <div class="o_secondary">
                                        üë§ <field name="customer_id"/>
                                    </div>
                                </div>
                                <div class="o_kanban_manage_button_section">
                                    <a class="o_kanban_manage_toggle_button" href="#"><i class="fa fa-ellipsis-v" title="More options"/></a>
                                </div>
                            </div>
                            <div class="o_kanban_card_content">
                                <div class="row">
                                    <div class="col-8">
                                        <div><i class="fa fa-cog"/> <field name="request_type"/></div>
                                        <div><i class="fa fa-calendar"/> <field name="submission_date"/></div>
                                        <div><i class="fa fa-target"/> <field name="target_completion_date"/></div>
                                    </div>
                                    <div class="col-4">
                                        <span class="badge" t-att-class="record.priority.raw_value === 'high' ? 'badge-danger' : record.priority.raw_value === 'medium' ? 'badge-warning' : 'badge-secondary'">
                                            <t t-if="record.priority.raw_value === 'high'">üî¥ High</t>
                                            <t t-elif="record.priority.raw_value === 'medium'">üü° Medium</t>
                                            <t t-else="">üü¢ Low</t>
                                        </span>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-6">
                                        <button class="btn btn-primary btn-sm" type="object" name="action_process_request">
                                            ‚ö° Process
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-success btn-sm" type="object" name="action_contact_customer">
                                            üìû Contact
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="o_kanban_card_manage_pane dropdown-menu" role="menu">
                                <a role="menuitem" type="edit" class="dropdown-item">‚úèÔ∏è Edit Request</a>
                                <a role="menuitem" type="object" name="action_view_attachments" class="dropdown-item">üìé View Attachments</a>
                                <a role="menuitem" type="object" name="action_escalate" class="dropdown-item">üìà Escalate</a>
                                <a role="menuitem" type="object" name="action_customer_history" class="dropdown-item">üìã Customer History</a>
                                <div class="dropdown-divider"/>
                                <a role="menuitem" type="object" name="action_send_notification" class="dropdown-item">üìß Send Update</a>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- üìã Enhanced Tree with SLA Tracking -->
    <record id="view_portal_request_tree" model="ir.ui.view">
        <field name="name">portal.request.list</field>
        <field name="model">portal.request</field>
        <field name="arch" type="xml">
            <list decoration-success="request_status == 'completed'" 
                  decoration-warning="request_status == 'in_progress'"
                  decoration-danger="priority == 'high'"
                  decoration-info="request_status == 'pending_approval'">
                <field name="name" string="üåê Request ID"/>
                <field name="customer_id" string="üë§ Customer"/>
                <field name="request_type" string="üîß Type"/>
                <field name="priority" string="‚ö° Priority" widget="badge"/>
                <field name="submission_date" string="üìÖ Submitted"/>
                <field name="target_completion_date" string="üéØ Target"/>
                <field name="assigned_to" string="üë®‚Äçüíº Assigned To"/>
                <field name="request_status" string="üìä Status" widget="badge"/>
                <field name="sla_status" string="‚è±Ô∏è SLA" widget="badge"/>
                <button name="action_process_request" type="object" string="Process" 
                        icon="fa-play" class="btn-link" 
                        invisible="request_status in ['completed', 'cancelled']"/>
                <button name="action_escalate" type="object" string="Escalate" 
                        icon="fa-arrow-up" class="btn-link" 
                        invisible="priority == 'high'"/>
            </list>
        </field>
    </record>

    <!-- üìù Enhanced Form with Complete Request Management -->
    <record id="view_portal_request_form" model="ir.ui.view">
        <field name="name">portal.request.form</field>
        <field name="model">portal.request</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_process_request" type="object" string="‚ö° Process Request" 
                            class="btn-primary" invisible="request_status in ['completed', 'cancelled']"/>
                    <button name="action_approve_request" type="object" string="‚úÖ Approve" 
                            class="btn-success" invisible="request_status != 'pending_approval'"/>
                    <button name="action_escalate" type="object" string="üìà Escalate" class="btn-warning"/>
                    <button name="action_complete_request" type="object" string="üéØ Complete" 
                            class="btn-info" invisible="request_status != 'in_progress'"/>
                    <field name="request_status" widget="statusbar" statusbar_visible="submitted,pending_approval,in_progress,completed,cancelled"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" type="object" name="action_view_attachments" icon="fa-paperclip">
                            <field string="Attachments" name="attachment_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" type="object" name="action_view_communications" icon="fa-comments">
                            <field string="Communications" name="communication_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" type="object" name="action_view_related_requests" icon="fa-link">
                            <field string="Related Requests" name="related_request_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" icon="fa-clock-o" 
                                invisible="sla_status != 'on_time'">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">‚è±Ô∏è</span>
                                <span class="o_stat_text">On Time</span>
                            </div>
                        </button>
                    </div>
                    
                    <group>
                        <group string="üåê Request Information">
                            <field name="name" placeholder="e.g., REQ-2024-001"/>
                            <field name="customer_id"/>
                            <field name="request_type"/>
                            <field name="priority"/>
                        </group>
                        <group string="üìÖ Timeline">
                            <field name="submission_date"/>
                            <field name="target_completion_date"/>
                            <field name="actual_completion_date"/>
                            <field name="sla_deadline"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="üë®‚Äçüíº Assignment">
                            <field name="assigned_to"/>
                            <field name="department"/>
                            <field name="supervisor"/>
                            <field name="escalation_contact"/>
                        </group>
                        <group string="üìä Status Tracking">
                            <field name="sla_status"/>
                            <field name="completion_percentage"/>
                            <field name="customer_satisfaction"/>
                            <field name="billing_required"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="üìù Request Details" name="details">
                            <group>
                                <field name="description" placeholder="Detailed description of the customer request..."/>
                            </group>
                            <group>
                                <group string="üì¶ Service Details">
                                    <field name="service_category"/>
                                    <field name="estimated_hours"/>
                                    <field name="materials_required"/>
                                    <field name="special_instructions"/>
                                </group>
                                <group string="üîí Security &amp; Compliance">
                                    <field name="confidentiality_level"/>
                                    <field name="naid_compliance_required"/>
                                    <field name="chain_of_custody_required"/>
                                    <field name="access_restrictions"/>
                                </group>
                            </group>
                        </page>
                        <page string="üìé Attachments &amp; Documents" name="attachments">
                            <field name="attachment_ids" mode="list">
                                <list>
                                    <field name="name"/>
                                    <field name="file_type"/>
                                    <field name="file_size"/>
                                    <field name="upload_date"/>
                                    <field name="uploaded_by"/>
                                    <field name="confidential"/>
                                    <button name="action_download" type="object" string="Download" icon="fa-download" class="btn-link"/>
                                </list>
                            </field>
                        </page>
                        <page string="üí¨ Communications" name="communications">
                            <field name="communication_log_ids" mode="list">
                                <list>
                                    <field name="communication_date"/>
                                    <field name="communication_type"/>
                                    <field name="from_person"/>
                                    <field name="to_person"/>
                                    <field name="subject"/>
                                    <field name="response_required"/>
                                    <button name="action_view_details" type="object" string="View" icon="fa-eye" class="btn-link"/>
                                </list>
                            </field>
                        </page>
                        <page string="üìã Approval Workflow" name="approval">
                            <group>
                                <group string="‚úÖ Approval Settings">
                                    <field name="requires_approval"/>
                                    <field name="approval_level_required"/>
                                    <field name="auto_approve_threshold"/>
                                    <field name="approval_deadline"/>
                                </group>
                                <group string="üë• Approvers">
                                    <field name="primary_approver"/>
                                    <field name="secondary_approver"/>
                                    <field name="final_approver"/>
                                    <field name="escalation_approver"/>
                                </group>
                            </group>
                            <field name="approval_history_ids" mode="list">
                                <list>
                                    <field name="approval_date"/>
                                    <field name="approver"/>
                                    <field name="approval_action"/>
                                    <field name="approval_level"/>
                                    <field name="comments"/>
                                    <field name="time_taken"/>
                                </list>
                            </field>
                        </page>
                        <page string="üí∞ Billing &amp; Pricing" name="billing">
                            <group>
                                <group string="üíµ Cost Information">
                                    <field name="estimated_cost"/>
                                    <field name="actual_cost"/>
                                    <field name="billing_method"/>
                                    <field name="hourly_rate"/>
                                </group>
                                <group string="üìä Billing Details">
                                    <field name="billable_hours"/>
                                    <field name="material_costs"/>
                                    <field name="total_amount"/>
                                    <field name="invoice_generated"/>
                                </group>
                            </group>
                        </page>
                        <page string="‚è±Ô∏è SLA Tracking" name="sla">
                            <group>
                                <group string="üìä SLA Metrics">
                                    <field name="sla_target_hours" readonly="1"/>
                                    <field name="time_elapsed" readonly="1"/>
                                    <field name="time_remaining" readonly="1"/>
                                    <field name="sla_breach_risk" readonly="1"/>
                                </group>
                                <group string="üìà Performance">
                                    <field name="response_time" readonly="1"/>
                                    <field name="resolution_time" readonly="1"/>
                                    <field name="customer_rating" readonly="1"/>
                                    <field name="quality_score" readonly="1"/>
                                </group>
                            </group>
                            <field name="sla_milestone_ids" mode="list">
                                <list>
                                    <field name="milestone_name"/>
                                    <field name="target_date"/>
                                    <field name="actual_date"/>
                                    <field name="status"/>
                                    <field name="variance"/>
                                    <field name="notes"/>
                                </list>
                            </field>
                        </page>
                        <page string="üìä Analytics" name="analytics">
                            <group>
                                <group string="üìà Performance Metrics">
                                    <field name="processing_time" readonly="1"/>
                                    <field name="customer_wait_time" readonly="1"/>
                                    <field name="first_response_time" readonly="1"/>
                                    <field name="resolution_efficiency" readonly="1"/>
                                </group>
                                <group string="üéØ Quality Indicators">
                                    <field name="rework_required" readonly="1"/>
                                    <field name="customer_complaints" readonly="1"/>
                                    <field name="compliance_score" readonly="1"/>
                                    <field name="overall_satisfaction" readonly="1"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- üìÖ Calendar View for Request Timeline -->
    <record id="view_portal_request_calendar" model="ir.ui.view">
        <field name="name">portal.request.calendar</field>
        <field name="model">portal.request</field>
        <field name="arch" type="xml">
            <calendar string="üìÖ Request Timeline" 
                      date_start="submission_date" 
                      date_stop="target_completion_date"
                      color="priority">
                <field name="name"/>
                <field name="customer_id"/>
                <field name="request_type"/>
                <field name="assigned_to"/>
                <field name="sla_status"/>
            </calendar>
        </field>
    </record>

    <!-- üîç Enhanced Search with Portal Filters -->
    <record id="view_portal_request_search" model="ir.ui.view">
        <field name="name">portal.request.search</field>
        <field name="model">portal.request</field>
        <field name="arch" type="xml">
            <search>
                <field name="name" string="Request"/>
                <field name="customer_id"/>
                <field name="request_type"/>
                <field name="assigned_to"/>
                <field name="description"/>
                
                <filter string="üì• Submitted" name="submitted" domain="[('request_status', '=', 'submitted')]"/>
                <filter string="‚è≥ Pending Approval" name="pending_approval" domain="[('request_status', '=', 'pending_approval')]"/>
                <filter string="üîÑ In Progress" name="in_progress" domain="[('request_status', '=', 'in_progress')]"/>
                <filter string="‚úÖ Completed" name="completed" domain="[('request_status', '=', 'completed')]"/>
                <filter string="‚ùå Cancelled" name="cancelled" domain="[('request_status', '=', 'cancelled')]"/>
                
                <separator/>
                <filter string="üî¥ High Priority" name="high_priority" domain="[('priority', '=', 'high')]"/>
                <filter string="üü° Medium Priority" name="medium_priority" domain="[('priority', '=', 'medium')]"/>
                <filter string="üü¢ Low Priority" name="low_priority" domain="[('priority', '=', 'low')]"/>
                
                <separator/>
                <filter string="‚è±Ô∏è SLA On Time" name="sla_on_time" domain="[('sla_status', '=', 'on_time')]"/>
                <filter string="‚ö†Ô∏è SLA At Risk" name="sla_at_risk" domain="[('sla_status', '=', 'at_risk')]"/>
                <filter string="üö® SLA Breached" name="sla_breached" domain="[('sla_status', '=', 'breached')]"/>
                
                <separator/>
                <filter string="üí∞ Billing Required" name="billing_required" domain="[('billing_required', '=', True)]"/>
                <filter string="üîí Confidential" name="confidential" domain="[('confidentiality_level', 'in', ['high', 'confidential'])]"/>
                <filter string="üèÜ NAID Required" name="naid_required" domain="[('naid_compliance_required', '=', True)]"/>
                
                <separator/>
                <filter string="üìÖ Today" name="today" domain="[('submission_date', '=', context_today())]"/>
                <filter string="üìÜ This Week" name="this_week" 
                        domain="[('submission_date', '&gt;=', (context_today() - relativedelta(days=context_today().weekday())).strftime('%Y-%m-%d')), 
                                ('submission_date', '&lt;', (context_today() + relativedelta(days=7-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                <filter string="üóìÔ∏è This Month" name="this_month" 
                        domain="[('submission_date', '&gt;=', context_today().strftime('%Y-%m-01'))]"/>
                
                <group expand="0" string="üìä Group By">
                    <filter string="Customer" name="group_by_customer" context="{'group_by': 'customer_id'}"/>
                    <filter string="Request Type" name="group_by_type" context="{'group_by': 'request_type'}"/>
                    <filter string="Status" name="group_by_status" context="{'group_by': 'request_status'}"/>
                    <filter string="Priority" name="group_by_priority" context="{'group_by': 'priority'}"/>
                    <filter string="Assigned To" name="group_by_assigned" context="{'group_by': 'assigned_to'}"/>
                    <filter string="SLA Status" name="group_by_sla" context="{'group_by': 'sla_status'}"/>
                    <filter string="Submission Date" name="group_by_date" context="{'group_by': 'submission_date:day'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- üöÄ ENTERPRISE ACTION - Portal Request Management -->
    <record id="action_portal_request" model="ir.actions.act_window">
        <field name="name">üåê Portal Requests</field>
        <field name="res_model">portal.request</field>
        <field name="view_mode">kanban,list,form,calendar</field>
        <field name="search_view_id" ref="view_portal_request_search"/>
        <field name="context">{
            'search_default_in_progress': 1,
            'search_default_pending_approval': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                üåê Process your first customer portal request!
            </p>
            <p>
                <b>Enterprise Customer Portal Management:</b><br/>
                ‚Ä¢ üåê Self-service customer request portal<br/>
                ‚Ä¢ ‚è±Ô∏è Advanced SLA tracking and monitoring<br/>
                ‚Ä¢ üìã Multi-level approval workflow automation<br/>
                ‚Ä¢ üí¨ Integrated communication and notifications<br/>
                ‚Ä¢ üìä Real-time performance analytics<br/>
                ‚Ä¢ üí∞ Automated billing and cost tracking<br/>
                ‚Ä¢ üîí Security controls and access management<br/>
                ‚Ä¢ üì± Mobile-optimized customer experience<br/>
                ‚Ä¢ üèÜ NAID compliance integration and tracking
            </p>
        </field>
    </record>
</odoo>
