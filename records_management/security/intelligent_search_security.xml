<?xml version="1.0" encoding="utf-8"?>
<odoo noupdate="1">
    <data>

        <!-- =============================================================== -->
        <!-- INTELLIGENT SEARCH SECURITY RULES -->
        <!-- Ensure users only see their own data in search results -->
        <!-- =============================================================== -->

        <!-- Container Search Rules (Core Functionality) -->
        <record id="records_container_search_rule" model="ir.rule">
            <field name="name">Container Search Access Rule</field>
            <field name="model_id" ref="model_records_container"/>
            <field name="domain_force">[
                '|', 
                ('partner_id', '=', False),
                '|',
                ('partner_id.user_ids', 'in', user.id),
                ('partner_id', 'in', user.partner_id.commercial_partner_id.child_ids.ids + [user.partner_id.commercial_partner_id.id])
            ]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Portal Container Search Rule (Customer Portal) -->
        <record id="records_container_portal_search_rule" model="ir.rule">
            <field name="name">Portal Container Search Rule</field>
            <field name="model_id" ref="model_records_container"/>
            <field name="domain_force">[
                ('partner_id', 'in', user.partner_id.commercial_partner_id.child_ids.ids + [user.partner_id.commercial_partner_id.id])
            ]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Document Search Rules -->
        <record id="records_document_search_rule" model="ir.rule">
            <field name="name">Document Search Access Rule</field>
            <field name="model_id" ref="model_records_document"/>
            <field name="domain_force">[
                '|', 
                ('partner_id', '=', False),
                '|',
                ('partner_id.user_ids', 'in', user.id),
                ('partner_id', 'in', user.partner_id.commercial_partner_id.child_ids.ids + [user.partner_id.commercial_partner_id.id])
            ]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Portal Document Search Rule -->
        <record id="records_document_portal_search_rule" model="ir.rule">
            <field name="name">Portal Document Search Rule</field>
            <field name="model_id" ref="model_records_document"/>
            <field name="domain_force">[
                ('partner_id', 'in', user.partner_id.commercial_partner_id.child_ids.ids + [user.partner_id.commercial_partner_id.id])
            ]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Location Search Rules (All Users Can See Locations) -->
        <record id="records_location_search_rule" model="ir.rule">
            <field name="name">Location Search Access Rule</field>
            <field name="model_id" ref="model_records_location"/>
            <!-- Allow all records to be visible (no restriction) -->
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_user')), (4, ref('base.group_portal'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
</record>

<!-- =============================================================== -->
<!-- FIELD CUSTOMIZATION PROTECTION RULES -->
<!-- =============================================================== -->

<!-- Field Label Customization Rules (Admin Only for Protected Fields) -->
<record id="field_label_customization_admin_rule" model="ir.rule">
    <field name="name">Field Label Customization Admin Rule</field>
    <field name="model_id" ref="model_field_label_customization"/>
    <!-- Allow all records to be visible (no restriction) -->
    <field name="domain_force">[(1, '=', 1)]</field>
    <field name="groups" eval="[(4, ref('base.group_system'))]"/>
    <field name="perm_read" eval="True"/>
    <field name="perm_write" eval="True"/>
    <field name="perm_create" eval="True"/>
    <field name="perm_unlink" eval="True"/>
</record>

<!-- Regular users can only view field customizations -->
<record id="field_label_customization_user_rule" model="ir.rule">
    <field name="name">Field Label Customization User Rule</field>
    <field name="model_id" ref="model_field_label_customization"/>
    <field name="domain_force">[
                '|',
                ('scope', '=', 'global'),
                ('user_ids', 'in', user.id)
            ]</field>
<field name="groups" eval="[(4, ref('base.group_user'))]"/>
<field name="perm_read" eval="True"/>
<field name="perm_write" eval="False"/>
<field name="perm_create" eval="False"/>
<field name="perm_unlink" eval="False"/>
</record>

<!-- =============================================================== -->
<!-- PORTAL REQUEST SEARCH INTEGRATION RULES -->
<!-- =============================================================== -->

<!-- Portal Request Rules (Customer Can See Own Requests) -->
<record id="portal_request_portal_rule" model="ir.rule">
    <field name="name">Portal Request Portal Access</field>
    <field name="model_id" ref="model_portal_request"/>
    <field name="domain_force">[
                ('partner_id', 'in', user.partner_id.commercial_partner_id.child_ids.ids + [user.partner_id.commercial_partner_id.id])
            ]</field>
<field name="groups" eval="[(4, ref('base.group_portal'))]"/>
<field name="perm_read" eval="True"/>
<field name="perm_write" eval="True"/>
<field name="perm_create" eval="True"/>
<field name="perm_unlink" eval="False"/>
</record>

<!-- Customer Feedback Rules (Customer Can See Own Feedback) -->
<record id="customer_feedback_portal_rule" model="ir.rule">
    <field name="name">Customer Feedback Portal Access</field>
    <field name="model_id" ref="model_customer_feedback"/>
    <field name="domain_force">[
                ('partner_id', 'in', user.partner_id.commercial_partner_id.child_ids.ids + [user.partner_id.commercial_partner_id.id])
            ]</field>
<field name="groups" eval="[(4, ref('base.group_portal'))]"/>
<field name="perm_read" eval="True"/>
<field name="perm_write" eval="True"/>
<field name="perm_create" eval="True"/>
<field name="perm_unlink" eval="False"/>
</record>

<!-- =============================================================== -->
<!-- SEARCH PERFORMANCE MONITORING RULES -->
<!-- =============================================================== -->

<!-- System Configuration Parameters (System Admin Only) -->
<record id="search_config_params_rule" model="ir.rule">
<field name="name">Search Config Parameters Rule</field>
<field name="model_id" ref="base.model_ir_config_parameter"/>
<field name="domain_force">[
                '|',
                ('key', 'not like', 'records_management.search.%'),
                (1, '=', 1)
]</field>
<field name="groups" eval="[(4, ref('base.group_system'))]"/>
<field name="perm_read" eval="True"/>
<field name="perm_write" eval="True"/>
<field name="perm_create" eval="True"/>
<field name="perm_unlink" eval="True"/>

</record>

</data>
</odoo>
</record>

</data>
</odoo>
