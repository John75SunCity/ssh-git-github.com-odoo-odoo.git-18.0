<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    
        <record id="records_storage_department_user_view_list" model="ir.ui.view">
            <field name="name">records.storage.department.user.view.list</field>
            <field name="model">records.storage.department.user</field>
            <field name="arch" type="xml">
                <tree decoration-success="state=='active'" decoration-muted="state=='inactive'">
                    <field name="display_name" />
                    <field name="user_id" />
                    <field name="department_id" />
                    <field name="role" />
                    <field name="priority" widget="badge" />
                    <field name="access_level" widget="badge" />
                    <field name="assignment_count" />
                    <field name="start_date" />
                    <field name="end_date" />
                    <field name="state" widget="badge" decoration-success="state=='active'" decoration-muted="state=='inactive'" />
                    <field name="company_id" groups="base.group_multi_company" />
                </tree>
            </field>
        </record>
        <record id="records_storage_department_user_view_form" model="ir.ui.view">
            <field name="name">records.storage.department.user.view.form</field>
            <field name="model">records.storage.department.user</field>
            <field name="arch" type="xml">
                <form string="Records Storage Department User">
                    <header>
                        <button name="action_activate" type="object" string="Activate" class="oe_highlight" invisible="state == 'active'" />
                        <button name="action_deactivate" type="object" string="Deactivate" class="oe_highlight" invisible="state == 'inactive'" />
                        <field name="state" widget="statusbar" statusbar_visible="active,inactive" />
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="display_name" readonly="1" />
                            </h1>
                        </div>
                        <group>
                            <group name="basic_info" string="Basic Information">
                                <field name="user_id" required="1" />
                                <field name="department_id" required="1" />
                                <field name="role" required="1" />
                                <field name="priority" />
                                <field name="active" />
                            </group>
                            <group name="assignment_info" string="Assignment Details">
                                <field name="start_date" />
                                <field name="end_date" />
                                <field name="assignment_count" readonly="1" />
                                <field name="access_level" />
                            </group>
                        </group>
                        <group name="description_info" string="Description &amp; Notes">
                            <field name="description" placeholder="Brief description of role and responsibilities..." />
                            <field name="notes" placeholder="Internal notes about this assignment..." />
                        </group>
                        <notebook>
                            <page string="Permissions" name="permissions">
                                <group string="Record Permissions">
                                    <group>
                                        <field name="can_view_records" />
                                        <field name="can_edit_records" />
                                        <field name="can_delete_records" />
                                    </group>
                                    <group>
                                        <field name="can_export_records" />
                                        <field name="can_manage_users" />
                                        <field name="can_approve_requests" />
                                    </group>
                                </group>
                            </page>
                            <page string="History" name="history">
                                <field name="history_ids" readonly="1">
                                    <tree>
                                        <field name="change_date" />
                                        <field name="change_type" widget="badge" />
                                        <field name="change_summary" />
                                        <field name="changed_by_id" />
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                        <group name="company_info" string="Company Information">
                            <field name="company_id" groups="base.group_multi_company" readonly="1" />
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" />
                        <field name="activity_ids" />
                        <field name="message_ids" />
                    </div>
                </form>
            </field>
        </record>
        <record id="records_storage_department_user_view_search" model="ir.ui.view">
            <field name="name">records.storage.department.user.view.search</field>
            <field name="model">records.storage.department.user</field>
            <field name="arch" type="xml">
                <search>
                    <field name="display_name" string="Name" filter_domain="[('display_name', 'ilike', self)]" />
                    <field name="user_id" string="User" />
                    <field name="department_id" string="Department" />
                    <separator />
                    <filter string="Active" name="active" domain="[('active', '=', True)]" />
                    <filter string="Inactive" name="inactive" domain="[('active', '=', False)]" />
                    <separator />
                    <filter string="Active Status" name="state_active" domain="[('state', '=', 'active')]" />
                    <filter string="Inactive Status" name="state_inactive" domain="[('state', '=', 'inactive')]" />
                    <separator />
                    <filter string="My Assignments" name="my_assignments" domain="[('user_id', '=', uid)]" />
                    <!-- Refactored: replaced Python date arithmetic with virtual boolean field -->
                    <filter string="This Month" name="this_month" domain="[('start_date_this_month', '=', True)]" />
                    <group expand="1" string="Group By">
                        <filter string="User" name="group_user" context="{'group_by': 'user_id'}" />
                        <filter string="Department" name="group_department" context="{'group_by': 'department_id'}" />
                        <filter string="Status" name="group_state" context="{'group_by': 'state'}" />
                        <filter string="Role" name="group_role" context="{'group_by': 'role'}" />
                        <filter string="Start Date" name="group_start_date" context="{'group_by': 'start_date'}" />
                    </group>
                </search>
            </field>
        </record>
        <record id="action_records_storage_department_user" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model records.storage.department.user has state field - consider using default search filters -->
            <field name="name">Department User Assignments</field>
            <field name="res_model">records.storage.department.user</field>
            <field name="view_mode>tree,form</field>
            <field name="view_ids" eval="[(5, 0, 0),         (0, 0, {'view_mode>tree')}),         (0, 0, {'view_mode': 'form', 'view_id': ref('records_storage_department_user_view_form')})]" />
            <field name="domain">[]</field>
            <field name="context">{
        'search_default_active': 1,
        'search_default_this_month': 1
    }</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
            Click to create a new department user assignment.
</p>
                <p>
Department user assignments allow you to manage which users have access to specific departments
            within the Records Management system. This enables granular access control and department-level
            data separation for multi-tenant scenarios.
        </p>
            </field>
        </record>
    
        <menuitem id="menu_records_storage_department_user" name="Department Users" parent="records_management.menu_records_configuration" action="action_records_storage_department_user" sequence="30" groups="records_management.group_records_manager" />
    
    
    </data>
</odoo>
