<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
<!-- Volume Calculator Form View -->
    <record id="custom_box_volume_calculator_view_form" model="ir.ui.view">
        <field name="name">custom.box.volume.calculator.view.form</field>
        <field name="model">custom.box.volume.calculator</field>
        <field name="arch" type="xml">
    <form string="Box Volume Calculator">
        <sheet>
            <div class="oe_title">
                <h1>
        <field name="name" placeholder="Volume Calculation Session"/>
                </h1>
            </div>

            <group name="session_info" string="Session Information">
                <group>
        <field name="user_id" readonly="1"/>
        <field name="calculation_date" readonly="1"/>
        <field name="calculation_purpose"/>
                </group>
                <group>
        <field name="company_id" readonly="1"/>
        <field name="fsm_task_id" domain="[('project_id.is_fsm', '=', True)]"/>
        <field name="pickup_request_id"/>
                </group>
            </group>

            <notebook>
                <page name="dimensions" string="Box Dimensions">
                    <group name="measurement_unit" string="Measurement System">
        <field name="measurement_unit" widget="radio"/>
                    </group>

        <group name="dimensions_inches" string="Dimensions (Inches)" invisible="measurement_unit != 'inches'">
        <field name="length_inches" required="1"/>
        <field name="width_inches" required="1"/>
        <field name="height_inches" required="1"/>
                    </group>

        <group name="dimensions_cm" string="Dimensions (Centimeters)" invisible="measurement_unit != 'centimeters'">
        <field name="length_cm" required="1"/>
        <field name="width_cm" required="1"/>
        <field name="height_cm" required="1"/>
                    </group>

                    <group name="quantity" string="Quantity">
        <field name="box_quantity"/>
                    </group>

                    <group name="calculated_volume" string="Calculated Volume">
        <field name="custom_volume_cf" string="Volume per Box (CF)"/>
        <field name="total_volume_cf" string="Total Volume (CF)"/>
        <field name="custom_volume_liters" string="Total Volume (Liters)"/>
                    </group>
                </page>

                <page name="work_order_billing" string="Work Order Billing" invisible="not shredding_work_order_id">
                    <div class="alert alert-info mb-3">
                        <strong>üì¶ Box Conversion Summary</strong><br/>
                        Enter the dimensions and quantity above. The system will calculate how many
                        standard Type 01 boxes (1.2 CF each) this is equivalent to, and add them
                        to the work order at the current shredding rate.
                    </div>
                    <group>
                        <group string="Equivalent Standard Boxes">
        <field name="total_volume_cf" readonly="1"/>
        <field name="equivalent_type01_boxes" readonly="1"/>
                        </group>
                        <group string="Billing">
        <field name="type01_rate" readonly="1"/>
        <field name="total_charge" readonly="1"/>
                        </group>
                    </group>
                    <group>
                        <button name="action_add_boxes_to_work_order" 
                                string="‚ûï Add Boxes to Work Order" 
                                type="object" 
                                class="btn-primary btn-lg"
                                invisible="equivalent_type01_boxes == 0"/>
                    </group>
                </page>

                <page name="standard_conversion" string="Standard Container Conversion">
                    <group name="recommendation" string="Recommendation">
        <field name="recommended_container_type"/>
        <field name="equivalent_standard_boxes"/>
        <field name="volume_difference_cf"/>
                    </group>

                    <group name="comparison" string="Volume Comparison">
        <div class="alert alert-info" role="status">
                            <strong>Recommendation:</strong>
        <field name="recommended_container_type" readonly="1" force_save="1"/>
                                    provides the closest match to your custom box volume.
                        </div>
                    </group>
                </page>

                <page name="pricing" string="Pricing Analysis">
                    <group name="rates" string="Pricing Rates">
        <field name="base_rate_per_cf" widget="monetary"/>
                    </group>

                    <group name="price_comparison" string="Price Comparison">
        <field name="custom_box_price" widget="monetary"/>
        <field name="standard_box_price" widget="monetary"/>
        <field name="price_difference" widget="monetary"/>
                    </group>

                    <group name="pricing_notes" string="Pricing Notes">
        <div class="alert alert-warning" role="alert" invisible="price_difference &lt;= 0">
                            <strong>Cost Savings:</strong> Using a custom box saves you
        <field name="price_difference" widget="monetary" readonly="1" force_save="1"/>
                                    compared to standard boxes.
                        </div>
        <div class="alert alert-info" role="status" invisible="price_difference &gt; 0">
                            <strong>Note:</strong> Standard boxes may be more cost-effective for this volume.
                        </div>
                    </group>
                </page>

                <page name="integration" string="FSM Integration">
                    <group name="fsm_links" string="Related Records">
        <field name="shredding_work_order_id"/>
        <field name="fsm_task_id"/>
        <field name="pickup_request_id"/>
        <field name="shredding_service_id"/>
                    </group>

                    <group name="actions" string="Actions">
<button name="action_apply_to_fsm_task" string="Apply to FSM Task" type="object" class="btn-primary" invisible="fsm_task_id == False"/>

                        <button name="action_create_quote_line" string="Create Quote Line" type="object" class="btn-secondary"/>
                        <button name="action_save_calculation" string="Save Calculation" type="object" class="btn-success"/>
                    </group>
                </page>
            </notebook>

            <group name="notes" string="Additional Notes">
        <field name="notes" placeholder="Enter any additional notes about this calculation..."/>
            </group>
        </sheet>

        <div class="oe_chatter">
        <field name="message_follower_ids" widget="mail_followers"/>
        <field name="activity_ids" widget="mail_activity"/>
        <field name="message_ids" widget="mail_thread"/>
        </div>
    </form>
</field>
    </record>

<!-- Volume Calculator List View -->
    <record id="custom_box_volume_calculator_view_tree" model="ir.ui.view">
        <field name="name">custom.box.volume.calculator.view.tree</field>
        <field name="model">custom.box.volume.calculator</field>
        <field name="arch" type="xml">
        <list string="Volume Calculations">
        <field name="name"/>
        <field name="user_id"/>
        <field name="calculation_date"/>
        <field name="calculation_purpose"/>
        <field name="measurement_unit"/>
        <field name="custom_volume_cf"/>
        <field name="recommended_container_type"/>
        <field name="custom_box_price"/>
        <field name="fsm_task_id"/>
</list>
</field>
    </record>

<!-- Volume Calculator Search View -->
    <record id="custom_box_volume_calculator_view_search" model="ir.ui.view">
        <field name="name">custom.box.volume.calculator.view.search</field>
        <field name="model">custom.box.volume.calculator</field>
        <field name="arch" type="xml">
    <search string="Search Volume Calculations">
        <field name="name"/>
        <field name="user_id"/>
        <field name="calculation_purpose"/>
        <field name="measurement_unit"/>
        <field name="recommended_container_type"/>
        <field name="fsm_task_id"/>
        <field name="pickup_request_id"/>
        <field name="shredding_service_id"/>

        <filter string="My Calculations" name="my_calculations" domain="[('user_id', '=', uid)]"/>
        <filter string="FSM Quotes" name="fsm_quotes" domain="[('calculation_purpose', '=', 'fsm_quote')]"/>
        <filter string="Customer Quotes" name="customer_quotes" domain="[('calculation_purpose', '=', 'customer_quote')]"/>
        <filter string="Today" name="today" domain="[('calculation_date', '!=', False)]"/>
        <group expand="0" string="Group By">
            <filter string="User" name="group_user" context="{'group_by': 'user_id'}"/>
            <filter string="Purpose" name="group_purpose" context="{'group_by': 'calculation_purpose'}"/>
            <filter string="Container Type" name="group_container" context="{'group_by': 'recommended_container_type'}"/>
            <filter string="Date" name="group_date" context="{'group_by': 'calculation_date:day'}"/>
        </group>
    </search>
</field>
    </record>

<!-- Volume Calculator Action -->
    <record id="custom_box_volume_calculator_action" model="ir.actions.act_window">
        <field name="name">Box Volume Calculator</field>
        <field name="res_model">custom.box.volume.calculator</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="custom_box_volume_calculator_view_tree"/>


        <field name="search_view_id" ref="custom_box_volume_calculator_view_search"/>
        <field name="context">{'default_calculation_purpose': 'fsm_quote'}</field>
        <field name="help">Calculate custom box volumes and compare with standard containers</field>
    </record>

    <!-- Volume Calculator Menu Item -->
    <menuitem id="custom_box_volume_calculator_menu" name="Volume Calculator" parent="records_management.menu_records_configuration" action="custom_box_volume_calculator_action" sequence="25" groups="records_management.group_records_user"/>

    <!-- Server Action: Open Volume Calculator from Shredding Work Order (Gear Icon) -->
    <record id="action_open_volume_calculator_from_work_order" model="ir.actions.act_window">
        <field name="name">üìê Volume Calculator</field>
        <field name="res_model">custom.box.volume.calculator</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_shredding_work_order_id': active_id,
            'default_calculation_purpose': 'fsm_quote',
        }</field>
        <field name="binding_model_id" ref="records_management.model_work_order_shredding"/>
        <field name="binding_view_types">form</field>
    </record>

    <!-- Also add to Container Destruction Work Order -->
    <record id="action_open_volume_calculator_from_destruction_order" model="ir.actions.act_window">
        <field name="name">üìê Volume Calculator</field>
        <field name="res_model">custom.box.volume.calculator</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_calculation_purpose': 'fsm_quote',
        }</field>
        <field name="binding_model_id" ref="records_management.model_container_destruction_work_order"/>
        <field name="binding_view_types">form</field>
    </record>

    
    </data>
</odoo>
