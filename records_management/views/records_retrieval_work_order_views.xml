<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="records_retrieval_work_order_view_list" model="ir.ui.view">
            <field name="name">records.retrieval.work.order.view.list</field>
            <field name="model">records.retrieval.work.order</field>
            <field name="arch" type="xml">
                <list>
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="user_id"/>
                    <field name="state"/>
                    <field name="delivery_method"/>
                    <field name="completion_date"/>
                </list>
            </field>
        </record>
        <record id="records_retrieval_work_order_view_form" model="ir.ui.view">
            <field name="name">records.retrieval.work.order.view.form</field>
            <field name="model">records.retrieval.work.order</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="action_start_progress" string="‚ñ∂Ô∏è Start" type="object" class="oe_highlight" invisible="state != 'scheduled'"/>
                        <button name="action_open_camera_scanner" string="üì∑ Camera Scan" type="object" class="btn-info" invisible="state not in ['scheduled','in_progress']" title="Scan containers using phone camera"/>
                        <button name="action_open_scanner" string="‚å®Ô∏è Keyboard Scan" type="object" class="btn-secondary" invisible="state not in ['scheduled','in_progress']" icon="fa-barcode" title="Type barcodes manually or use USB scanner"/>
                        <button name="action_verify_and_return" string="‚úÖ Verified and Returned" type="object" class="btn-warning" invisible="state not in ['scheduled','in_progress']" confirm="This will permanently remove ALL scanned containers, create removal charges ($15/container, no shredding), and close the work order. Continue?"/>
                        <button name="action_complete" string="‚úÖ Complete" type="object" class="btn-success" invisible="state != 'in_progress'"/>
                        <button name="action_cancel" string="Cancel" type="object" class="btn-secondary" invisible="state == 'completed'"/>
                        <field name="state" widget="statusbar" statusbar_visible="scheduled,in_progress,completed"/>
                    </header>
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="state"/>
                            <field name="partner_id"/>
                            <field name="department_id"
                                   placeholder="Select department..."
                                   domain="[('partner_id', '=', partner_id)]"
                                   options="{'no_create': True, 'no_quick_create': True}"/>
                            <field name="customer_staging_location_id"
                                   placeholder="Select staging location..."
                                   domain="[('partner_id', '=', partner_id), '|', ('department_id', '=', department_id), ('department_id', '=', False)]"
                                   options="{'no_create': True, 'no_quick_create': True}"/>
                            <field name="user_id"/>
                            <field name="retrieval_team_id"/>
                            <field name="delivery_method"/>
                            <field name="company_id" groups="base.group_multi_company"/>
                        </group>
                        <notebook>
                            <page name="barcode_scanning" string="Barcode Scanning" invisible="state not in ['draft','in_progress']">
                                <group>
                                    <group name="scan_status" string="Scanning Status">
                                        <field name="scanned_count" readonly="1"/>
                                        <field name="last_scan_time" readonly="1"/>
                                    </group>
                                </group>
                                <separator string="Scanned Containers"/>
                                <field name="scanned_barcode_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create': True}">
                                    <list>
                                        <field name="name"/>
                                        <field name="barcode"/>
                                        <field name="partner_id"/>
                                    </list>
                                </field>
                                <div class="alert alert-info" role="status">
                                    <p><i class="fa fa-info-circle" title="Information"/> <strong>How to Scan:</strong></p>
                                    <ul>
                                        <li><strong>USB Scanner:</strong> Focus on barcode field below and scan</li>
                                        <li><strong>Mobile:</strong> Tap camera icon to scan with phone camera</li>
                                        <li><strong>Manual:</strong> Type barcode and press Enter</li>
                                    </ul>
                                </div>
                            </page>
                            <page name="details" string="Details">
                                <group>
                                    <group name="dates" string="Scheduling">
                                        <field name="completion_date" readonly="state != 'in_progress'"/>
                                    </group>
                                    <group name="financials" string="Financial Information">
                                        <!-- Removed always-invisible 'currency_id' (monetary fields already include currency via company) -->
                                    </group>
                                </group>
                                <separator string="Notes"/>
                                <field name="notes" placeholder="Internal notes about this retrieval request..."/>
                            </page>
                            <page name="tracking" string="Tracking &amp; History">
                                <group>
                                    <group name="timestamps" string="Timestamps">
                                        <field name="create_date" readonly="1"/>
                                        <field name="write_date" readonly="1"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Customer Balance" name="customer_balance">
                                <div class="alert alert-danger" role="alert" invisible="not show_payment_alert">
                                    <strong>‚ö†Ô∏è Payment Collection Recommended</strong>
                                    <p>This customer has a significant past due balance. Please discuss payment options during this service call.</p>
                                </div>
                                <group>
                                    <group string="Company Balance">
                                        <field name="customer_total_balance" widget="monetary"/>
                                        <field name="customer_past_due_balance" widget="monetary"/>
                                        <field name="customer_balance_status" widget="badge" 
                                               decoration-success="customer_balance_status == 'current'"
                                               decoration-warning="customer_balance_status == 'attention'"
                                               decoration-danger="customer_balance_status in ('overdue', 'critical')"/>
                                    </group>
                                    <group string="Department Balance" invisible="not department_total_balance">
                                        <field name="department_total_balance" widget="monetary"/>
                                    </group>
                                </group>
                                <group string="Payment Actions">
                                    <div class="d-flex gap-2 flex-wrap">
                                        <button name="action_field_payment" type="object" 
                                                string="üí≥ Collect Payment" class="btn-primary"
                                                help="Collect payment from customer on-site"/>
                                        <button name="action_view_unpaid_invoices" type="object" 
                                                string="üìã View Unpaid Invoices" class="btn-secondary"
                                                help="View all unpaid invoices for this customer"/>
                                        <button name="action_view_payment_history" type="object" 
                                                string="üìä Payment History" class="btn-secondary"
                                                help="View payment history for this customer"/>
                                    </div>
                                </group>
                                <group string="Payment Notes">
                                    <p class="text-muted">
                                        <strong>Balance Status Guide:</strong><br/>
                                        ‚Ä¢ <span class="badge bg-success">Current</span> - All invoices within terms<br/>
                                        ‚Ä¢ <span class="badge bg-warning">Needs Attention</span> - 30+ days past due<br/>
                                        ‚Ä¢ <span class="badge bg-danger">Overdue</span> - 60+ days or $500+ past due<br/>
                                        ‚Ä¢ <span class="badge bg-danger">Critical</span> - 90+ days or $1,000+ past due - Collect payment!
                                    </p>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="records_retrieval_work_order_view_kanban" model="ir.ui.view">
            <field name="name">records.retrieval.work.order.view.kanban</field>
            <field name="model">records.retrieval.work.order</field>
            <field name="arch" type="xml">
                <kanban default_group_by="state" class="o_kanban_small_column">
                    <field name="id" />
                    <field name="name" />
                    <field name="partner_id" />
                    <field name="user_id" />
                    <field name="state" />
                    <field name="delivery_method" />
                    <field name="completion_date" />
                    <templates>
                        <t t-name="card">
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="oe_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="name" />
                                            </strong>
                                            <div class="o_kanban_record_subtitle">
                                                <field name="partner_id" />
                                            </div>
                                        </div>
                                        <div class="o_kanban_manage_button_section">
                                            <a class="o_kanban_manage_toggle_button" href="#">
                                                <i class="fa fa-ellipsis-v" role="img" aria-label="Manage options" title="Manage options" />
                                            </a>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <div class="o_kanban_record_bottom">
                                            <div class="oe_kanban_bottom_left">
                                                <div>
                                                    <i class="fa fa-user" role="img" aria-label="Assigned user" title="Assigned user" />
                                                    <field name="user_id" />
                                                </div>
                                                <div>
                                                    <i class="fa fa-truck" role="img" aria-label="Delivery method" title="Delivery method" />
                                                    <field name="delivery_method" />
                                                </div>
                                            </div>
                                            <div class="oe_kanban_bottom_right">
                                                <field name="completion_date" widget="date" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <record id="records_retrieval_work_order_view_search" model="ir.ui.view">
            <field name="name">records.retrieval.work.order.view.search</field>
            <field name="model">records.retrieval.work.order</field>
            <field name="arch" type="xml">
                <search string="Search Records Retrieval Work Orders">
                    <field name="name" string="Work Order" filter_domain="[('name', 'ilike', self)]" />
                    <field name="partner_id" string="Customer" />
                    <field name="user_id" string="Assigned To" />
                    <field name="retrieval_team_id" string="Team" />
                    <separator />
                    <filter name="scheduled" string="Scheduled" domain="[('state', '=', 'scheduled')]" />
                    <filter name="in_progress" string="In Progress" domain="[('state', '=', 'in_progress')]" />
                    <filter name="completed" string="Completed" domain="[('state', '=', 'completed')]" />
                    <filter name="cancelled" string="Cancelled" domain="[('state', '=', 'cancelled')]" />
                    <separator />
                    <filter name="scan_delivery" string="Scan &amp; Email" domain="[('delivery_method', '=', 'scan')]" />
                    <filter name="physical_delivery" string="Physical Delivery" domain="[('delivery_method', '=', 'physical')]" />
                    <separator />
                    <filter name="my_orders" string="My Orders" domain="[('user_id', '=', uid)]" />
                    <filter name="unassigned" string="Unassigned" domain="[('user_id', '=', False)]" />
                    <separator />
                    <filter name="today" string="Today" domain="[('create_date', '!=', False)]" />
                    <filter name="this_week" string="This Week" domain="[('create_date', '!=', False)]" />
                    <group expand="1" string="Group By">
                        <filter string="Status" name="group_state" domain="[]" context="{'group_by': 'state'}" />
                        <filter string="Customer" name="group_customer" domain="[]" context="{'group_by': 'partner_id'}" />
                        <filter string="Assigned To" name="group_user" domain="[]" context="{'group_by': 'user_id'}" />
                        <filter string="Team" name="group_team" domain="[]" context="{'group_by': 'retrieval_team_id'}" />
                        <filter string="Delivery Method" name="group_delivery" domain="[]" context="{'group_by': 'delivery_method'}" />
                        <filter string="Company" name="group_company" domain="[]" context="{'group_by': 'company_id'}" groups="base.group_multi_company" />
                    </group>
                </search>
            </field>
        </record>
        <record id="action_records_retrieval_work_order" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model records.retrieval.work.order has state field - consider using default search filters -->
            <field name="name">Records Retrieval Work Orders</field>
            <field name="res_model">records.retrieval.work.order</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[]</field>
            <field name="context">{'search_default_in_progress': 1}</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                Click to create a new Records Retrieval Work Order.
            </p>
                <p>
                Records Retrieval Work Orders manage the process of retrieving specific documents
                or records from storage. These orders track the assignment, progress, and delivery
                of requested materials to customers.
            </p>
            </field>
        </record>
        <record id="action_my_records_retrieval_work_order" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model records.retrieval.work.order has state field - consider using default search filters -->
            <field name="name">My Records Retrieval Orders</field>
            <field name="res_model">records.retrieval.work.order</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('user_id', '=', uid)]</field>
            <field name="context">{'search_default_in_progress': 1}</field>
        </record>
        <record id="action_unassigned_records_retrieval_work_order" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model records.retrieval.work.order has state field - consider using default search filters -->
            <field name="name">Unassigned Retrieval Orders</field>
            <field name="res_model">records.retrieval.work.order</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('user_id', '=', False), ('state', 'in', ['draft', 'in_progress'])]</field>
            <field name="context">{'default_state': 'scheduled'}</field>
        </record>
    </data>
</odoo>
