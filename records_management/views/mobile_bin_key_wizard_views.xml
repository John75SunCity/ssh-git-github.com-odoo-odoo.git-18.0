<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>
    <!-- Form view for Mobile Bin Key Wizard -->
    <record id="mobile_bin_key_wizard_view_form" model="ir.ui.view">
        <field name="name">mobile.bin.key.wizard.view.form</field>
        <field name="model">mobile.bin.key.wizard</field>
        <field name="arch" type="xml">
            <form string="Mobile Bin Key Management">
                <div class="o_form_sheet" style="max-width: 100%; padding: 10px;">

                    <!-- Header section -->
                    <div class="row">
                        <div class="col-12">
                            <div class="alert alert-info o_alert" role="status" aria-live="polite">
                                <strong>Mobile Key Management</strong>
                                <span class="d-block">Quick access for field technicians to manage bin keys and services</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action selection -->
                    <group string="Select Action">
                        <field name="action_type" widget="radio" options="{'horizontal': false}"/>
                    </group>

                    <!-- Operation details -->
                    <group string="Operation Details" invisible="action_type in [False, 'quick_lookup']">
                        <field name="partner_id" options="{'no_create_edit': True}" placeholder="Select customer..."/>
                        <field name="priority"/>
                        <field name="operation_reason"/>
                    </group>

                    <!-- Bin key details -->
                    <group string="Bin Key Information" invisible="action_type in [False, 'quick_lookup']">
                        <field name="bin_key_id" options="{'no_create_edit': True}"/>
                        <field name="bin_location_id" readonly="1"/>
                        <field name="bin_number" readonly="1"/>
                        <field name="key_code"/>
                        <field name="access_level_required" readonly="1"/>
                    </group>

                    <!-- Quick lookup section -->
                    <group string="Quick Lookup" invisible="action_type != 'quick_lookup'">
                        <field name="lookup_query" placeholder="Enter search terms..."/>
                    </group>

                    <!-- Operation description -->
                    <group string="Operation Details" invisible="action_type == 'quick_lookup'">
                        <field name="operation_description" placeholder="Describe the operation..."/>
                        <field name="billable"/>
                        <field name="service_charge" invisible="not billable"/>
                    </group>

                    <!-- Emergency options -->
                    <group string="Emergency Access" invisible="not show_emergency_options">
                        <field name="authorization_required" readonly="1"/>
                        <field name="authorized_by_id" readonly="1"/>
                        <field name="approval_date" readonly="1"/>
                    </group>

                    <!-- Lookup results -->
                    <div invisible="not show_lookup_results">
                        <separator string="Lookup Results"/>
                        <group>
                            <field name="containers_found" readonly="1"/>
                            <field name="documents_found" readonly="1"/>
                        </group>
                        <field name="lookup_results" readonly="1" widget="text"/>
                    </div>

                    <!-- Operation tracking -->
                    <group string="Operation Tracking" invisible="state == 'draft'">
                        <field name="operation_start_time" readonly="1"/>
                        <field name="operation_end_time" readonly="1"/>
                        <field name="actual_duration" readonly="1"/>
                    </group>

                    <!-- Compliance -->
                    <group string="Compliance" invisible="not naid_compliance_check">
                        <field name="naid_compliance_check" readonly="1"/>
                        <field name="audit_trail_created" readonly="1"/>
                        <field name="chain_of_custody_id" readonly="1"/>
                    </group>

                    <!-- Operation status -->
                    <group string="Status" invisible="state == 'draft'">
                        <field name="state" readonly="1"/>
                        <field name="operation_notes"/>
                    </group>

                    <!-- Hidden visibility control fields -->
                    <field name="show_emergency_options" invisible="1"/>
                    <field name="show_lookup_results" invisible="1"/>

                </div>

                <!-- Footer buttons -->
                <footer>
                    <div class="row">
                        <div class="col-6">
                            <button string="Cancel" class="btn btn-secondary btn-block" special="cancel"/>
                        </div>
                        <div class="col-6">
                            <button string="Start Operation" class="btn btn-primary btn-block" name="action_start_operation" type="object" invisible="state != 'draft'"/>
                            <button string="Complete Operation" class="btn btn-success btn-block" name="action_complete_operation" type="object" invisible="state != 'in_progress'"/>
                            <button string="Execute Lookup" class="btn btn-info btn-block" name="action_execute_lookup" type="object" invisible="action_type != 'quick_lookup'"/>
                            <button string="Request Authorization" class="btn btn-warning btn-block" name="action_request_authorization" type="object" invisible="not authorization_required or state != 'draft'"/>
                        </div>
                    </div>
                </footer>
            </form>
        </field>
    </record>

    <!-- Action for mobile wizard -->
    <record id="action_mobile_bin_key_wizard" model="ir.actions.act_window">
        <field name="name">Mobile Key Management</field>
        <field name="res_model">mobile.bin.key.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

    <!-- Menu item -->
    <menuitem id="menu_mobile_bin_key_wizard" name="Mobile Key Manager" parent="records_management.menu_records_management_root" action="action_mobile_bin_key_wizard" sequence="5" groups="records_management.group_records_user"/>

    <!-- Quick access shortcut -->
    <record id="action_mobile_key_shortcut" model="ir.actions.server">
        <field name="name">Quick Key Access</field>
        <field name="model_id" ref="records_management.model_mobile_bin_key_wizard"/>
        <field name="state">code</field>
        <field name="code">
action = {
    'type': 'ir.actions.act_window',
    'name': 'Mobile Key Management',
    'res_model': 'mobile.bin.key.wizard',
    'view_mode': 'form',
    'target': 'new',
    'context': {'default_action_type': 'access'}
}
        </field>
    </record>

</data>
</odoo>
