<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Base Rates Views -->
        <record id="view_base_rates_tree" model="ir.ui.view">
            <field name="name">base.rates.tree</field>
            <field name="model">base.rates</field>
            <field name="arch" type="xml">
                <tree decoration-info="state == 'draft'" decoration-success="state == 'active'" 
                      decoration-muted="state in ['superseded', 'expired']">
                    <field name="name"/>
                    <field name="service_category"/>
                    <field name="service_type"/>
                    <field name="rate_structure"/>
                    <field name="base_rate" string="Rate ($)"/>
                    <field name="effective_date"/>
                    <field name="state" widget="badge" 
                           decoration-info="state == 'draft'"
                           decoration-success="state == 'active'"
                           decoration-warning="state == 'superseded'"
                           decoration-danger="state == 'expired'"/>
                    <field name="customer_count" string="Base Rate Users"/>
                    <field name="negotiated_rate_count" string="Negotiated Users"/>
                </tree>
            </field>
        </record>

        <record id="view_base_rates_form" model="ir.ui.view">
            <field name="name">base.rates.form</field>
            <field name="model">base.rates</field>
            <field name="arch" type="xml">
                <form string="Base Rates">
                    <header>
                        <button name="action_activate" string="Activate Rate" type="object" 
                                class="oe_highlight" states="draft"/>
                        <button name="action_expire" string="Expire Rate" type="object" 
                                states="active" confirm="Are you sure you want to expire this rate?"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,active,superseded,expired"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_customers_using_rate" type="object" 
                                    class="oe_stat_button" icon="fa-users">
                                <field name="customer_count" widget="statinfo" string="Base Rate Users"/>
                            </button>
                            <button name="action_view_negotiated_rates" type="object" 
                                    class="oe_stat_button" icon="fa-handshake-o">
                                <field name="negotiated_rate_count" widget="statinfo" string="Negotiated Rates"/>
                            </button>
                        </div>
                        
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="service_category"/>
                                <field name="service_type"/>
                                <field name="rate_structure"/>
                            </group>
                            <group>
                                <field name="base_rate"/>
                                <field name="minimum_charge"/>
                                <field name="effective_date"/>
                                <field name="expiration_date"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Description">
                                <field name="description" placeholder="Describe this rate and when it applies..."/>
                            </page>
                            <page string="Internal Notes">
                                <field name="notes" placeholder="Internal notes about this rate..."/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Customer Rate Profile Views -->
        <record id="view_customer_rate_profile_tree" model="ir.ui.view">
            <field name="name">customer.rate.profile.tree</field>
            <field name="model">customer.rate.profile</field>
            <field name="arch" type="xml">
                <tree decoration-info="state == 'draft'" decoration-success="state == 'active'" 
                      decoration-muted="state in ['superseded', 'expired']">
                    <field name="partner_id"/>
                    <field name="service_category"/>
                    <field name="service_type"/>
                    <field name="adjustment_method"/>
                    <field name="base_rate_amount" string="Base Rate ($)"/>
                    <field name="negotiated_rate" string="Negotiated Rate ($)"/>
                    <field name="rate_difference" string="Difference ($)" 
                           decoration-success="rate_difference &lt; 0"
                           decoration-danger="rate_difference &gt; 0"/>
                    <field name="savings_percentage" string="Savings %" 
                           decoration-success="savings_percentage &gt; 0"
                           decoration-danger="savings_percentage &lt; 0"/>
                    <field name="state" widget="badge"/>
                    <field name="effective_date"/>
                </tree>
            </field>
        </record>

        <record id="view_customer_rate_profile_form" model="ir.ui.view">
            <field name="name">customer.rate.profile.form</field>
            <field name="model">customer.rate.profile</field>
            <field name="arch" type="xml">
                <form string="Customer Rate Profile">
                    <header>
                        <button name="action_approve" string="Approve" type="object" 
                                class="oe_highlight" states="draft" 
                                groups="records_management.group_records_manager"/>
                        <button name="action_activate" string="Activate" type="object" 
                                class="oe_highlight" states="draft" 
                                attrs="{'invisible': [('approved_by', '=', False)]}"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,active,expired"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="partner_id"/>
                                <field name="service_category"/>
                                <field name="service_type"/>
                                <field name="base_rate_id"/>
                            </group>
                            <group>
                                <field name="base_rate_amount"/>
                                <field name="adjustment_method"/>
                                <field name="adjustment_value"/>
                                <field name="negotiated_rate" class="oe_inline"/>
                            </group>
                        </group>

                        <group string="Rate Comparison">
                            <group>
                                <field name="rate_difference" 
                                       decoration-success="rate_difference &lt; 0"
                                       decoration-danger="rate_difference &gt; 0"/>
                                <field name="savings_percentage" 
                                       decoration-success="savings_percentage &gt; 0"
                                       decoration-danger="savings_percentage &lt; 0"/>
                            </group>
                            <group>
                                <field name="effective_date"/>
                                <field name="expiration_date"/>
                                <field name="contract_reference"/>
                            </group>
                        </group>

                        <group string="Approval Information" states="active,expired,superseded">
                            <group>
                                <field name="approved_by"/>
                                <field name="approval_date"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Negotiation Notes">
                                <field name="notes" placeholder="Notes about the negotiation and special terms..."/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Revenue Forecaster Views -->
        <record id="view_revenue_forecaster_form" model="ir.ui.view">
            <field name="name">revenue.forecaster.form</field>
            <field name="model">revenue.forecaster</field>
            <field name="arch" type="xml">
                <form string="Revenue Forecaster">
                    <header>
                        <button name="action_run_forecast" string="🚀 Run Forecast Analysis" type="object" 
                                class="oe_highlight" attrs="{'invisible': [('analysis_complete', '=', True)]}"/>
                        <button name="action_export_forecast" string="📊 Export to Excel" type="object" 
                                attrs="{'invisible': [('analysis_complete', '=', False)]}"/>
                        <button name="action_apply_scenario" string="✅ Apply Rate Changes" type="object" 
                                class="oe_highlight" 
                                attrs="{'invisible': [('analysis_complete', '=', False)]}"
                                confirm="This will implement the forecasted rate changes. Are you sure?"/>
                    </header>
                    <sheet>
                        <div class="alert alert-info" role="alert" attrs="{'invisible': [('analysis_complete', '=', True)]}">
                            <strong>Revenue Forecasting Tool</strong><br/>
                            Configure your scenario parameters below and click "Run Forecast Analysis" to see the potential revenue impact.
                        </div>

                        <!-- Results Summary (only show after analysis) -->
                        <div class="o_form_sheet_bg" attrs="{'invisible': [('analysis_complete', '=', False)]}">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <h5 class="card-title">Current Revenue</h5>
                                            <h3 class="text-primary">$<field name="current_monthly_revenue" nolabel="1"/>/mo</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <h5 class="card-title">Projected Revenue</h5>
                                            <h3 class="text-success">$<field name="projected_monthly_revenue" nolabel="1"/>/mo</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <h5 class="card-title">Monthly Change</h5>
                                            <h3 class="text-info">$<field name="revenue_difference" nolabel="1"/></h3>
                                            <small class="text-muted"><field name="revenue_percentage_change" nolabel="1"/>%</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <h5 class="card-title">Annual Impact</h5>
                                            <h3 class="text-warning">$<field name="annual_revenue_impact" nolabel="1"/></h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>Customers Affected:</strong> <field name="customer_impact_count" nolabel="1"/>
                                </div>
                                <div class="col-md-6">
                                    <strong>Risk Assessment:</strong> 
                                    <field name="risk_assessment" nolabel="1" widget="badge" 
                                           decoration-success="risk_assessment == 'low'"
                                           decoration-warning="risk_assessment == 'medium'"
                                           decoration-danger="risk_assessment in ['high', 'very_high']"/>
                                </div>
                            </div>
                        </div>

                        <group string="Scenario Configuration">
                            <group>
                                <field name="forecast_period"/>
                                <field name="scenario_type"/>
                                <field name="customer_segment"/>
                            </group>
                            <group>
                                <field name="custom_start_date" attrs="{'invisible': [('forecast_period', '!=', 'custom')], 'required': [('forecast_period', '=', 'custom')]}"/>
                                <field name="custom_end_date" attrs="{'invisible': [('forecast_period', '!=', 'custom')], 'required': [('forecast_period', '=', 'custom')]}"/>
                                <field name="specific_customer_ids" widget="many2many_tags" 
                                       attrs="{'invisible': [('customer_segment', '!=', 'specific_customers')]}"/>
                            </group>
                        </group>

                        <group string="Rate Adjustment Parameters" 
                               attrs="{'invisible': [('scenario_type', 'not in', ['global_increase', 'global_decrease', 'category_specific'])]}">
                            <group>
                                <field name="global_adjustment_type" 
                                       attrs="{'invisible': [('scenario_type', 'not in', ['global_increase', 'global_decrease'])]}"/>
                                <field name="global_adjustment_value" 
                                       attrs="{'invisible': [('scenario_type', 'not in', ['global_increase', 'global_decrease'])]}"/>
                                <field name="service_category" 
                                       attrs="{'invisible': [('scenario_type', '!=', 'category_specific')], 'required': [('scenario_type', '=', 'category_specific')]}"/>
                                <field name="category_adjustment_value" 
                                       attrs="{'invisible': [('scenario_type', '!=', 'category_specific')]}"/>
                            </group>
                        </group>

                        <group string="Market Analysis Parameters">
                            <group>
                                <field name="market_growth_rate"/>
                                <field name="inflation_rate"/>
                            </group>
                            <group>
                                <field name="customer_retention_rate"/>
                                <field name="competitor_rate_factor"/>
                            </group>
                        </group>

                        <!-- Detailed Results -->
                        <notebook attrs="{'invisible': [('analysis_complete', '=', False)]}">
                            <page string="Customer Impact Analysis">
                                <field name="forecast_line_ids" readonly="1">
                                    <tree decoration-success="revenue_change &lt; 0" 
                                          decoration-danger="revenue_change &gt; 0">
                                        <field name="partner_id"/>
                                        <field name="customer_segment"/>
                                        <field name="container_count"/>
                                        <field name="current_monthly_revenue"/>
                                        <field name="projected_monthly_revenue"/>
                                        <field name="revenue_change"/>
                                        <field name="revenue_change_percentage"/>
                                        <field name="risk_level" widget="badge"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Rate Change Confirmation Wizard -->
        <record id="view_rate_change_confirmation_wizard_form" model="ir.ui.view">
            <field name="name">rate.change.confirmation.wizard.form</field>
            <field name="model">rate.change.confirmation.wizard</field>
            <field name="arch" type="xml">
                <form string="Rate Change Implementation">
                    <header>
                        <button name="action_approve_changes" string="✅ Approve Changes" type="object" 
                                class="oe_highlight" 
                                attrs="{'invisible': [('approved_by', '!=', False)]}"
                                groups="records_management.group_records_manager"/>
                        <button name="action_implement_changes" string="🚀 Implement Changes" type="object" 
                                class="oe_highlight" 
                                attrs="{'invisible': ['|', ('approved_by', '=', False), ('requires_approval', '=', True)]}"
                                confirm="This will implement the rate changes. This action cannot be undone. Are you sure?"/>
                        <button name="action_cancel_implementation" string="Cancel" type="object" 
                                class="btn-secondary"/>
                    </header>
                    <sheet>
                        <div class="alert alert-warning" role="alert">
                            <strong>⚠️ Rate Change Implementation</strong><br/>
                            Please review the details below before implementing rate changes.
                        </div>

                        <group string="Impact Summary">
                            <group>
                                <field name="revenue_impact" widget="monetary"/>
                                <field name="customer_count"/>
                            </group>
                            <group>
                                <field name="effective_date"/>
                                <field name="implementation_method"/>
                            </group>
                        </group>

                        <group string="Customer Communication">
                            <group>
                                <field name="notification_required"/>
                                <field name="advance_notice_days" 
                                       attrs="{'invisible': [('notification_required', '=', False)]}"/>
                            </group>
                            <group>
                                <field name="phase_duration_months" 
                                       attrs="{'invisible': [('implementation_method', '!=', 'phased')]}"/>
                            </group>
                        </group>

                        <group string="Approval" attrs="{'invisible': [('requires_approval', '=', False)]}">
                            <group>
                                <field name="requires_approval"/>
                                <field name="approved_by" readonly="1"/>
                                <field name="approval_date" readonly="1"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Communication Template" attrs="{'invisible': [('notification_required', '=', False)]}">
                                <field name="communication_template" 
                                       placeholder="Customize the customer communication template..."/>
                            </page>
                            <page string="Risk Management">
                                <group>
                                    <field name="risk_mitigation_plan" 
                                           placeholder="Describe steps to mitigate implementation risks..."/>
                                    <field name="rollback_plan" 
                                           placeholder="Describe the rollback plan if issues arise..."/>
                                </group>
                            </page>
                            <page string="Approval Notes" attrs="{'invisible': [('approved_by', '=', False)]}">
                                <field name="approval_notes" 
                                       placeholder="Management approval notes and conditions..."/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Menu Actions -->
        <record id="action_base_rates" model="ir.actions.act_window">
            <field name="name">Base Service Rates</field>
            <field name="res_model">base.rates</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[]</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Set up your base service rates!
                </p>
                <p>
                    Base rates are the default pricing for all services. Customers without negotiated rates will use these base rates.
                </p>
            </field>
        </record>

        <record id="action_customer_rate_profiles" model="ir.actions.act_window">
            <field name="name">Customer Rate Profiles</field>
            <field name="res_model">customer.rate.profile</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[]</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create negotiated rate profiles!
                </p>
                <p>
                    Set up customer-specific rates that override base rates for negotiated pricing agreements.
                </p>
            </field>
        </record>

        <record id="action_revenue_forecaster" model="ir.actions.act_window">
            <field name="name">Revenue Forecaster</field>
            <field name="res_model">revenue.forecaster</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="context">{}</field>
        </record>

        <record id="action_rate_analysis_wizard" model="ir.actions.act_window">
            <field name="name">Rate Analysis</field>
            <field name="res_model">rate.analysis.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="context">{}</field>
        </record>

    </data>
</odoo>
