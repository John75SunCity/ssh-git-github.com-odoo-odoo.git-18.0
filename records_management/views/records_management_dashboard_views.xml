<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <!-- List View (replaces legacy tree) -->
    <record id="records_management_dashboard_view_list" model="ir.ui.view">
      <field name="name">records.management.dashboard.view.list</field>
      <field name="model">records.management.dashboard</field>
      <field name="arch" type="xml">
        <tree string="Management Dashboards" create="true" editable="bottom">
          <field name="name"/>
          <field name="snapshot_date"/>
          <field name="total_boxes"/>
          <field name="monthly_shredded"/>
          <field name="monthly_revenue"/>
          <field name="kpi_total_containers"/>
          <field name="kpi_monthly_revenue"/>
          <field name="kpi_monthly_shredded"/>
        </tree>
      </field>
    </record>

    <!-- Search View -->
    <record id="records_management_dashboard_view_search" model="ir.ui.view">
      <field name="name">records.management.dashboard.view.search</field>
      <field name="model">records.management.dashboard</field>
      <field name="arch" type="xml">
        <search>
          <field name="name"/>
          <field name="snapshot_date"/>
          <filter name="this_month" string="This Month" domain="['|', ('snapshot_date', '=', False), ('snapshot_date', '&gt;=', (context_today()).strftime('%Y-%m-01'))]"/>
          <group expand="0" string="Group By">
            <filter name="group_by_snapshot" string="Snapshot Date" context="{'group_by': 'snapshot_date'}"/>
            <filter name="group_by_company" string="Company" context="{'group_by': 'company_id'}"/>
          </group>
        </search>
      </field>
    </record>

    <!-- Form View -->
    <record id="records_management_dashboard_view_form" model="ir.ui.view">
      <field name="name">records.management.dashboard.view.form</field>
      <field name="model">records.management.dashboard</field>
      <field name="arch" type="xml">
        <form string="Management Dashboard">
          <header>
            <button name="action_refresh_snapshot" type="object" string="Refresh Snapshot" class="btn-primary"/>
            <button name="create_snapshot" type="object" string="New Snapshot" class="btn-secondary"/>
            <button name="%(action_report_management_dashboard)d" type="action" string="Print PDF" class="btn-secondary"/>
          </header>
          <sheet>
            <group>
              <group string="Snapshot Info">
                <field name="name"/>
                <field name="company_id"/>
                <field name="snapshot_date"/>
              </group>
              <group string="Stored Snapshot Values">
                <field name="total_boxes" readonly="1"/>
                <field name="monthly_shredded" readonly="1"/>
                <field name="monthly_revenue" readonly="1"/>
              </group>
            </group>
            <notebook>
              <page string="Live KPIs">
                <group>
                  <group string="Containers">
                    <field name="kpi_total_containers" readonly="1"/>
                    <field name="kpi_active_containers" readonly="1"/>
                  </group>
                  <group string="Shredding &amp; Requests">
                    <field name="kpi_monthly_shredded" readonly="1"/>
                    <field name="kpi_pending_portal_requests" readonly="1"/>
                  </group>
                </group>
                <group>
                  <group string="Revenue">
                    <field name="kpi_monthly_revenue" readonly="1"/>
                  </group>
                  <group string="Capacity">
                    <field name="kpi_avg_location_utilization" readonly="1"/>
                    <field name="kpi_capacity_warnings" readonly="1"/>
                  </group>
                </group>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <!-- Action -->
    <record id="records_management_dashboard_action" model="ir.actions.act_window">
      <field name="name">Management Dashboards</field>
      <field name="res_model">records.management.dashboard</field>
  <field name="view_mode>tree,form</field>
      <field name="search_view_id" ref="records_management.records_management_dashboard_view_search"/>
      <field name="context">{}</field>
    </record>

    <!-- Menu (under Reporting) -->
    <menuitem id="records_management_dashboard_menu" name="Management Dashboards" parent="records_management.menu_records_reporting_root" action="records_management.records_management_dashboard_action" sequence="90"/>
  </data>
</odoo>
