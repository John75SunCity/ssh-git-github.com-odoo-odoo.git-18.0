<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- ============================================================================
             BASE RATE CARD (base.rate) - Comprehensive Rate Configuration
             One record contains ALL rates for the company (storage, services, fees)
             ============================================================================ -->
        
        <!-- List View -->
        <record id="base_rate_view_tree" model="ir.ui.view">
            <field name="name">base.rate.view.tree</field>
            <field name="model">base.rate</field>
            <field name="arch" type="xml">
                <list decoration-info="state == 'draft'" 
                      decoration-success="state == 'active'" 
                      decoration-muted="state == 'archived'">
                    <field name="name"/>
                    <field name="version"/>
                    <field name="effective_date"/>
                    <field name="expiration_date"/>
                    <field name="state" widget="badge" 
                           decoration-info="state == 'draft'" 
                           decoration-success="state == 'active'" 
                           decoration-muted="state == 'archived'"/>
                    <field name="standard_box_rate" widget="monetary" string="Type 01"/>
                    <field name="legal_box_rate" widget="monetary" string="Type 02"/>
                    <field name="minimum_monthly_charge" widget="monetary" string="Min Monthly"/>
                    <field name="company_id" optional="hide"/>
                </list>
            </field>
        </record>

        <!-- Form View - Complete Rate Card -->
        <record id="base_rate_view_form" model="ir.ui.view">
            <field name="name">base.rate.view.form</field>
            <field name="model">base.rate</field>
            <field name="arch" type="xml">
                <form string="Base Rate Card">
                    <header>
                        <button name="action_activate" string="Activate Rate Card" 
                                type="object" class="oe_highlight" 
                                invisible="state != 'draft'"/>
                        <button name="action_expire" string="Archive Rate Card" 
                                type="object" 
                                confirm="Are you sure you want to archive this rate card?" 
                                invisible="state != 'active'"/>
                        <field name="state" widget="statusbar" 
                               statusbar_visible="draft,active,archived"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_customers_using_rate" type="object" 
                                    class="oe_stat_button" icon="fa-users">
                                <field name="customers_using_rates" widget="statinfo" 
                                       string="Customers"/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <label for="name"/>
                            <h1>
                                <field name="name" placeholder="e.g., 2025 Standard Rates"/>
                            </h1>
                        </div>
                        <group>
                            <group string="Rate Card Details">
                                <field name="company_id" options="{'no_create': True}"/>
                                <field name="version"/>
                                <field name="user_id" string="Manager"/>
                                <field name="active" widget="boolean_toggle"/>
                            </group>
                            <group string="Validity Period">
                                <field name="effective_date"/>
                                <field name="expiration_date"/>
                                <field name="currency_id" invisible="1"/>
                            </group>
                        </group>
                        
                        <notebook>
                            <!-- Container Storage Rates Tab -->
                            <page string="Container Storage Rates" name="container_rates">
                                <div class="alert alert-info" role="alert">
                                    <strong>Monthly Storage Rates by Container Type</strong> - 
                                    These rates are charged monthly for each container in storage.
                                </div>
                                <group>
                                    <group string="Standard Containers">
                                        <field name="standard_box_rate" widget="monetary"/>
                                        <field name="legal_box_rate" widget="monetary"/>
                                        <field name="map_box_rate" widget="monetary"/>
                                    </group>
                                    <group string="Special Containers">
                                        <field name="odd_size_rate" widget="monetary"/>
                                        <field name="pathology_rate" widget="monetary"/>
                                    </group>
                                </group>
                            </page>
                            
                            <!-- Service Rates Tab -->
                            <page string="Service Rates" name="service_rates">
                                <group>
                                    <group string="Pickup &amp; Delivery">
                                        <field name="pickup_rate" widget="monetary"/>
                                        <field name="delivery_rate" widget="monetary"/>
                                    </group>
                                    <group string="Document Services">
                                        <field name="document_retrieval_rate" widget="monetary"/>
                                        <field name="scanning_rate" widget="monetary"/>
                                        <field name="indexing_rate" widget="monetary"/>
                                    </group>
                                </group>
                                <group>
                                    <group string="Destruction Services">
                                        <field name="destruction_rate" widget="monetary"/>
                                    </group>
                                    <group string="Labor Rates">
                                        <field name="technician_hourly_rate" widget="monetary"/>
                                        <field name="supervisor_hourly_rate" widget="monetary"/>
                                    </group>
                                </group>
                            </page>
                            
                            <!-- One-Time Fees Tab -->
                            <page string="One-Time Fees" name="fees">
                                <group>
                                    <group string="Setup Fees">
                                        <field name="new_customer_setup_fee" widget="monetary"/>
                                        <field name="container_setup_fee" widget="monetary"/>
                                        <field name="barcode_generation_fee" widget="monetary"/>
                                    </group>
                                </group>
                            </page>
                            
                            <!-- Billing Configuration Tab -->
                            <page string="Billing Configuration" name="billing_config">
                                <group>
                                    <group string="Billing Defaults">
                                        <field name="billing_frequency_default"/>
                                        <field name="proration_method"/>
                                        <field name="minimum_monthly_charge" widget="monetary"/>
                                    </group>
                                </group>
                            </page>
                            
                            <!-- Volume Pricing Tab -->
                            <page string="Volume Pricing" name="volume_pricing">
                                <group>
                                    <group string="Volume Tier Settings">
                                        <field name="enable_volume_tiers" widget="boolean_toggle"/>
                                    </group>
                                </group>
                                <group invisible="not enable_volume_tiers">
                                    <group string="Small Volume (Higher Rates)">
                                        <field name="small_volume_threshold"/>
                                        <field name="small_volume_multiplier"/>
                                    </group>
                                    <group string="Large Volume (Discount)">
                                        <field name="large_volume_threshold"/>
                                        <field name="large_volume_multiplier"/>
                                    </group>
                                    <group string="Enterprise Volume (Bigger Discount)">
                                        <field name="enterprise_volume_threshold"/>
                                        <field name="enterprise_volume_multiplier"/>
                                    </group>
                                </group>
                            </page>
                            
                            <!-- Location Pricing Tab -->
                            <page string="Location Pricing" name="location_pricing">
                                <group>
                                    <group string="Location Modifier Settings">
                                        <field name="enable_location_modifiers" widget="boolean_toggle"/>
                                    </group>
                                </group>
                                <group invisible="not enable_location_modifiers">
                                    <group string="Location Multipliers">
                                        <field name="premium_location_multiplier"/>
                                        <field name="standard_location_multiplier"/>
                                        <field name="economy_location_multiplier"/>
                                    </group>
                                </group>
                            </page>
                            
                            <!-- Statistics Tab -->
                            <page string="Statistics" name="statistics">
                                <group>
                                    <group string="Rate Analysis (Computed)">
                                        <field name="average_container_rate" widget="monetary" readonly="1"/>
                                        <field name="rate_per_cubic_foot" widget="monetary" readonly="1"/>
                                        <field name="total_service_rate" widget="monetary" readonly="1"/>
                                    </group>
                                    <group string="Usage Statistics (Computed)">
                                        <field name="customers_using_rates" readonly="1"/>
                                        <field name="containers_at_base_rates" readonly="1"/>
                                    </group>
                                </group>
                            </page>
                            
                            <!-- Description Tab -->
                            <page string="Notes" name="notes">
                                <field name="description" 
                                       placeholder="Add notes about this rate card, when it applies, special conditions, etc."/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Search View -->
        <record id="base_rate_view_search" model="ir.ui.view">
            <field name="name">base.rate.view.search</field>
            <field name="model">base.rate</field>
            <field name="arch" type="xml">
                <search string="Search Rate Cards">
                    <field name="name"/>
                    <field name="company_id"/>
                    <filter string="Active" name="active" domain="[('state', '=', 'active')]"/>
                    <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                    <filter string="Archived" name="archived" domain="[('state', '=', 'archived')]"/>
                    <separator/>
                    <filter string="Current (Not Expired)" name="current" 
                            domain="['|', ('expiration_date', '=', False), ('expiration_date', '>=', context_today().strftime('%Y-%m-%d'))]"/>
                    <group expand="0" string="Group By">
                        <filter string="State" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Company" name="group_company" context="{'group_by': 'company_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Action for Base Rate Cards -->
        <record id="action_base_rate_cards" model="ir.actions.act_window">
            <field name="name">Base Rate Cards</field>
            <field name="res_model">base.rate</field>
            <field name="view_mode">list,form</field>
            <field name="context">{'search_default_active': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first Rate Card!
                </p>
                <p>
                    A Rate Card contains ALL your base pricing: container storage rates, 
                    service fees, one-time fees, and billing configuration. 
                    Customers without negotiated rates will use these prices.
                </p>
            </field>
        </record>
        
        <!-- Action for Customer Negotiated Rates (must be defined before menus reference it) -->
        <record id="action_customer_negotiated_rate" model="ir.actions.act_window">
            <field name="name">Customer Negotiated Rates</field>
            <field name="res_model">customer.negotiated.rate</field>
            <field name="view_mode">list,form</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Set up customer-specific rates!
                </p>
                <p>
                    Negotiated rates override base rates for specific customers.
                    Use these for volume discounts or special pricing agreements.
                </p>
            </field>
        </record>
        
        <!-- Alias for backward compatibility -->
        <record id="action_base_rates" model="ir.actions.act_window">
            <field name="name">Base Service Rates</field>
            <field name="res_model">base.rate</field>
            <field name="view_mode">list,form</field>
            <field name="context">{'search_default_active': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Set up your base service rates!
                </p>
                <p>
                    Base rates are the default pricing for all services. 
                    Customers without negotiated rates will use these base rates.
                </p>
            </field>
        </record>

    </data>
</odoo>
