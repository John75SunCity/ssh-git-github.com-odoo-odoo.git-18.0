<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
<!-- hard.drive.scan.wizard form view -->
    <record id="hard_drive_scan_wizard_view_form" model="ir.ui.view">
        <field name="name">hard.drive.scan.wizard.form</field>
        <field name="model">hard.drive.scan.wizard</field>
        <field name="arch" type="xml">
            <form string="Hard Drive Scanner">
                <header>
                    <field name="scan_step" widget="statusbar" statusbar_visible="pickup,verification,single_step"/>
                    <button name="action_manager_bypass" string="Manager Bypass" type="object"
                            class="btn-warning" groups="records_management.group_records_manager"
                            invisible="manager_bypass or scan_step == 'single_step'"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <span invisible="scan_step != 'pickup'">ðŸ“± Pickup Scan</span>
                            <span invisible="scan_step != 'verification'">âœ… Facility Verification</span>
                            <span invisible="scan_step != 'single_step'">âš¡ Single Step (Manager)</span>
                        </h1>
                        <div class="o_row">
                            <label for="work_order_display" string="Work Order:"/>
                            <field name="work_order_display" readonly="1"/>
                        </div>
                        <!-- Hidden fields to receive context from different work order types -->
                        <field name="fsm_task_id" invisible="1"/>
                        <field name="shredding_work_order_id" invisible="1"/>
                        <field name="destruction_work_order_id" invisible="1"/>
                        <div class="o_row">
                            <label for="partner_id" string="Customer:"/>
                            <field name="partner_id" readonly="1"/>
                        </div>
                    </div>

                    <group>
                        <group string="Scan Settings">
                            <field name="destruction_method"/>
                            <field name="two_step_verification" readonly="1"/>
                            <field name="manager_bypass" readonly="1" invisible="not manager_bypass"/>
                        </group>
                        <group string="Summary">
                            <field name="total_drives_count" readonly="1"/>
                            <field name="verified_drives_count" readonly="1"
                                invisible="not two_step_verification or manager_bypass"/>
                        </group>
                    </group>

                    <group string="ðŸ“± Quick Scan Entry">
                        <div class="o_row">
                            <button name="action_open_camera_scanner" string="ðŸ“· Open Camera Scanner" type="object"
                                    class="btn-success" icon="fa-camera"/>
                        </div>
                        <field name="serial_numbers_text" placeholder="Or type serial numbers here (one per line)..."
                            nolabel="1" widget="text"/>
                        <button name="action_process_scanned_serials" string="âž• Add to List" type="object"
                                class="btn-primary" invisible="not serial_numbers_text"/>
                    </group>

                    <separator string="ðŸ“‹ Scanned Hard Drives"/>
                    <field name="scan_line_ids" nolabel="1">
                        <list editable="bottom">
                            <field name="serial_number" readonly="1"/>
                            <field name="verified" widget="boolean_toggle"
                                invisible="context.get('default_scan_step') == 'pickup' or parent.manager_bypass"/>
                            <field name="scanned_at_pickup" readonly="1" optional="hide"/>
                            <field name="scanned_at_facility" readonly="1" optional="hide"/>
                        </list>
                    </field>

                    <div class="oe_button_box" invisible="not scan_line_ids">
                        <div class="alert alert-info" role="alert" invisible="scan_step != 'verification' or manager_bypass">
                            <strong>Two-Step Verification:</strong> Check off each drive as you verify it at the facility.
                        </div>
                        <div class="alert alert-success" role="alert" invisible="scan_step != 'single_step'">
                            <strong>Manager Override:</strong> Single-step processing enabled.
                        </div>
                    </div>
                </sheet>
                <footer>
                    <button name="action_verify_selected" string="âœ… Verify All" type="object"
                            class="btn-success" invisible="scan_step != 'verification' or manager_bypass"/>
                    <button name="action_confirm_destruction" string="ðŸŽ¯ Complete &amp; Generate Certificate" type="object"
                            class="btn-primary" invisible="not scan_line_ids"/>
                    <button string="Cancel" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>    <!-- Action to open the hard drive scan wizard from FSM Tasks -->
    <record id="action_hard_drive_scan_wizard" model="ir.actions.act_window">
        <field name="name">Scan Hard Drives</field>
        <field name="res_model">hard.drive.scan.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="binding_model_id" ref="project.model_project_task"/>
        <field name="binding_view_types">form</field>
        <field name="context">{'default_fsm_task_id': active_id}</field>
    </record>

    <!-- Action to open the hard drive scan wizard from Shredding Work Orders -->
    <record id="action_hard_drive_scan_wizard_shredding" model="ir.actions.act_window">
        <field name="name">Scan Hard Drives</field>
        <field name="res_model">hard.drive.scan.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="binding_model_id" ref="model_work_order_shredding"/>
        <field name="binding_view_types">form</field>
        <field name="context">{'default_shredding_work_order_id': active_id}</field>
    </record>

    <!-- Action to open the hard drive scan wizard from Destruction Work Orders -->
    <record id="action_hard_drive_scan_wizard_destruction" model="ir.actions.act_window">
        <field name="name">Scan Hard Drives</field>
        <field name="res_model">hard.drive.scan.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="binding_model_id" ref="model_container_destruction_work_order"/>
        <field name="binding_view_types">form</field>
        <field name="context">{'default_destruction_work_order_id': active_id}</field>
    </record>
    </data>
</odoo>
