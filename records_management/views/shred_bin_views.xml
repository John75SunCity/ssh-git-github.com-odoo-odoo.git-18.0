<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="shred_bin_view_tree" model="ir.ui.view">
            <field name="model">shred.bin</field>
            <field name="arch" type="xml">
                <list string="Customer Shred Bins" decoration-danger="state=='full'" decoration-warning="capacity_pounds >= 75 and state=='in_service'" decoration-success="state=='in_service' and capacity_pounds &lt; 75" decoration-info="state=='deployed'" decoration-muted="state=='retired'" decoration-bf="state=='maintenance'" class="o_list_view_shred_bins">
                    <field name="name" />
                    <field name="partner_id" />
                    <field name="bin_size" />
                    <field name="customer_location" />
                    <field name="state" />
                    <field name="capacity_pounds" />
                    <!-- Technical scheduling flag used for batch planning; hidden from direct editing -->
                    <field name="needs_collection" invisible="1" />
                    <field name="last_service_date" />
                    <field name="service_count" />
                    <field name="user_id" />
                    <!-- Removed always-invisible 'active' (archive handled via filters) -->
                </list>
            </field>
        </record>
        <record id="shred_bin_view_form" model="ir.ui.view">
            <field name="name">shred.bin.view.form</field>
            <field name="model">shred.bin</field>
            <field name="arch" type="xml">
                <form string="My Shred Bin" create="false" edit="false" delete="false">
                    <header>
                        <button name="action_mark_full" type="object" string="Mark Full" class="btn-primary" invisible="state != 'in_service'" />
                        <button name="action_start_collection" type="object" string="Request Collection" class="btn-warning" invisible="state != 'full'" />
                        <button name="action_complete_service" type="object" string="Complete Service" class="btn-success" invisible="state != 'collecting'" />
                        <field name="state" widget="statusbar" statusbar_visible="deployed,in_service,full,collecting" statusbar_colors="{&quot;full&quot;:&quot;red&quot;,&quot;collecting&quot;:&quot;orange&quot;,&quot;in_service&quot;:&quot;green&quot;}" />
                    </header>
                    <sheet>
                        <widget name="web_ribbon" title="Collection Requested" bg_color="bg-danger" invisible="needs_collection == False" />
                        <div class="oe_title">
                            <h1>
                                <field name="name" />
                            </h1>
                        </div>
                        <group>
                            <group string="Bin Information">
                                <field name="bin_size" readonly="1" />
                                <field name="customer_location" readonly="1" />
                                <field name="capacity_pounds" readonly="1" />
                                <field name="is_locked" readonly="1" />
                                <field name="needs_collection" readonly="1" />
                            </group>
                            <group string="Service Information">
                                <field name="partner_id" readonly="1" />
                                <field name="user_id" readonly="1" />
                                <field name="last_service_date" readonly="1" />
                                <field name="service_count" readonly="1" />
                            </group>
                        </group>
                        <separator string="Description" />
                        <field name="description" readonly="1" />
                        <div class="alert alert-info" role="status" invisible="capacity_pounds &lt; 50">
                            <strong>Collection Notice:</strong> Your bin is getting full. Consider requesting collection when ready.
                        </div>
                        <div class="alert alert-success" role="status" invisible="needs_collection == True">
                            <strong>Service Status:</strong> Your bin is in good service. We'll collect it when you request or when it's full.
                        </div>
                        <notebook>
                            <page string="Service History">
                                <field name="service_ids" readonly="1">
                                    <list>
                                        <field name="name" />
                                        <field name="date_start" />
                                        <field name="state" />
                                    </list>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" />
                        <field name="activity_ids" />
                        <field name="message_ids" />
                    </div>
                </form>
            </field>
        </record>
        <record id="shred_bin_view_search" model="ir.ui.view">
            <field name="name">shred.bin.view.search</field>
            <field name="model">shred.bin</field>
            <field name="arch" type="xml">
                <search string="Search Shred Bins">
                    <field name="name" string="Bin Number" />
                    <field name="partner_id" string="Customer" />
                    <field name="customer_location" />
                    <field name="barcode" />
                    <field name="user_id" />
                    <filter name="needs_collection" string="Needs Collection" domain="[('needs_collection', '=', True)]" />
                    <filter name="in_service" string="In Service" domain="[('state', '=', 'in_service')]" />
                    <filter name="full" string="Full" domain="[('state', '=', 'full')]" />
                    <filter name="maintenance" string="Maintenance" domain="[('state', '=', 'maintenance')]" />
                    <separator />
                    <filter name="active" string="Active" domain="[('active', '=', True)]" />
                    <filter name="archived" string="Archived" domain="[('active', '=', False)]" />
                    <group expand="0" string="Group By">
                        <filter name="group_customer" string="Customer" context="{'group_by': 'partner_id'}" />
                        <filter name="group_state" string="Status" context="{'group_by': 'state'}" />
                        <filter name="group_bin_size" string="Bin Size" context="{'group_by': 'bin_size'}" />
                        <filter name="group_service_rep" string="Service Rep" context="{'group_by': 'user_id'}" />
                    </group>
                </search>
            </field>
        </record>
        <record id="shred_bin_view_kanban" model="ir.ui.view">
            <field name="name">shred.bin.view.kanban</field>
            <field name="model">shred.bin</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile" default_group_by="state">
                    <field name="name" />
                    <field name="partner_id" />
                    <field name="bin_size" />
                    <field name="capacity_pounds" />
                    <field name="needs_collection" />
                    <field name="state" />
                    <field name="service_count" />
                    <field name="customer_location" />
                    <templates>
                        <t t-name="card">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click #{record.state.raw_value=='full' ? 'border-danger' : record.state.raw_value=='in_service' ? 'border-success' : record.state.raw_value=='deployed' ? 'border-info' : record.state.raw_value=='maintenance' ? 'border-dark' : 'border-secondary'}">
                                <div class="o_kanban_image">
                                    <i class="fa fa-trash fa-2x" t-attf-style="color: #{record.state.raw_value=='full' ? '#dc3545' : record.state.raw_value=='in_service' ? '#28a745' : record.state.raw_value=='deployed' ? '#007bff' : record.state.raw_value=='maintenance' ? '#6f42c1' : record.state.raw_value=='collecting' ? '#fd7e14' : '#6c757d'};" title="Shred Bin" />
                                </div>
                                <div class="oe_kanban_details">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="name" />
                                            </strong>
                                            <br />
                                            <small class="o_kanban_record_subtitle text-muted">
                                                <field name="partner_id" />
                                            </small>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <div class="row">
                                            <div class="col-6">
                                                <small>
                                                    <strong>Size:</strong>
                                                    <field name="bin_size" />
                                                </small>
                                            </div>
                                            <div class="col-6">
                                                <small>
                                                    <strong>Capacity:</strong>
                                                    <field name="capacity_pounds" /> lbs
                                                </small>
                                            </div>
                                        </div>
                                        <div class="row mt-2">
                                            <div class="col-12">
                                                <span t-attf-class="badge #{record.state.raw_value=='full' ? 'badge-danger' : record.state.raw_value=='in_service' ? 'badge-success' : record.state.raw_value=='deployed' ? 'badge-info' : record.state.raw_value=='maintenance' ? 'badge-secondary' : record.state.raw_value=='collecting' ? 'badge-warning' : 'badge-light'}">
                                                    <field name="state" />
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <small t-if="record.service_count.raw_value &gt; 0">
                                                <i class="fa fa-scissors text-muted" title="Services" />
                                                <field name="service_count" /> services
                                            </small>
                                        </div>
                                        <div class="oe_kanban_bottom_right">
                                            <span t-if="record.needs_collection.raw_value" class="badge badge-danger">
                                                Collection Due
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <record id="action_shred_bin" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model shred.bin has state field - consider using default search filters -->
            <field name="name">Customer Shred Bins</field>
            <field name="res_model">shred.bin</field>
            <field name="view_mode">list,form</field>
            <field name="context">{'search_default_in_service': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                Create your first shred bin!
            </p>
                <p>
                Shred bins are placed at customer locations to collect confidential documents
                for secure destruction. Track fill levels, schedule collections, and manage
                the complete service lifecycle.
            </p>
                <div class="mt-3">
                    <h5>Color Coding System:</h5>
                    <ul>
                        <li>
                            <span class="badge badge-danger">Red</span> - Full bins (immediate collection needed)</li>
                        <li>
                            <span class="badge badge-warning">Yellow</span> - High fill level (75-90%, collection soon)</li>
                        <li>
                            <span class="badge badge-success">Green</span> - In active service (good status)</li>
                        <li>
                            <span class="badge badge-info">Blue</span> - Accounted for at facility</li>
                        <li>
                            <span class="badge badge-secondary">Purple</span> - Under maintenance</li>
                        <li>
                            <span class="badge badge-light">Grey</span> - Unknown/retired status</li>
                    </ul>
                </div>
            </field>
        </record>
        <record id="action_shred_bin_portal" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model shred.bin has state field - consider using default search filters -->
            <field name="name">My Shred Bins</field>
            <field name="res_model">shred.bin</field>
            <field name="view_mode">list,form</field>
            <field name="domain">['&amp;', ('partner_id', '=', user.partner_id.commercial_partner_id.id), '|', ('department_id', '=', False), ('department_id.user_ids', 'in', [user.id])]</field>
            <field name="context">{'create': False, 'delete': False, 'edit': False}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                No shred bins found at your location.
            </p>
                <p>
                Contact your service representative to have shred bins deployed at your location.
                Once deployed, you can monitor fill levels and request collections here.
            </p>
                <div class="mt-3">
                    <h5>Status Indicators:</h5>
                    <ul>
                        <li>
                            <span class="badge badge-danger">Red</span> - Ready for collection</li>
                        <li>
                            <span class="badge badge-warning">Yellow</span> - Collection needed soon</li>
                        <li>
                            <span class="badge badge-success">Green</span> - In good service</li>
                    </ul>
                </div>
            </field>
        </record>
    
        <menuitem id="menu_shred_bin" name="Shred Bins" parent="records_management.menu_records_operations" action="action_shred_bin" sequence="15" />
        <menuitem id="menu_shred_bin_portal" name="My Shred Bins" parent="portal.portal_menu" action="action_shred_bin_portal" sequence="20" groups="base.group_portal" />
    
        <template id="shred_bin_custom_css" name="Shred Bin Custom CSS" inherit_id="web.layout">
            <xpath expr="//head" position="inside">
                <style>
                /* Shred Bin Status Colors */
                .o_list_view_shred_bins .o_data_row.text-danger {
                    background-color: #f8d7da !important; /* Light red background for full bins */
                }

                .o_list_view_shred_bins .o_data_row.text-warning {
                    background-color: #fff3cd !important; /* Light yellow background for high fill */
                }

                .o_list_view_shred_bins .o_data_row.text-success {
                    background-color: #d4edda !important; /* Light green background for good status */
                }

                .o_list_view_shred_bins .o_data_row.text-info {
                    background-color: #d1ecf1 !important; /* Light blue background for facility bins */
                }

                /* Map marker colors based on bin status */
                .o_map_view .o_map_marker[data-state="full"] {
                    color: #dc3545 !important; /* Red for full bins */
                }

                .o_map_view .o_map_marker[data-state="in_service"][data-fill-high="true"] {
                    color: #ffc107 !important; /* Yellow for high fill */
                }

                .o_map_view .o_map_marker[data-state="in_service"] {
                    color: #28a745 !important; /* Green for in service */
                }

                .o_map_view .o_map_marker[data-state="deployed"] {
                    color: #007bff !important; /* Blue for deployed */
                }

                .o_map_view .o_map_marker[data-state="maintenance"] {
                    color: #6f42c1 !important; /* Purple for maintenance */
                }

                .o_map_view .o_map_marker[data-state="collecting"] {
                    color: #fd7e14 !important; /* Orange for collecting */
                }

                .o_map_view .o_map_marker {
                    color: #6c757d !important; /* Grey for unknown */
                }

                /* Portal specific styling */
                .o_kanban_portal .oe_kanban_card {
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                }

                .o_kanban_portal .oe_kanban_card:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    transition: all 0.2s ease;
                }

                /* Enhanced progress bars */
                .progress-bar.bg-danger {
                    background-color: #dc3545 !important;
                    animation: pulse-red 2s infinite;
                }

                .progress-bar.bg-warning {
                    background-color: #ffc107 !important;
                }

                .progress-bar.bg-success {
                    background-color: #28a745 !important;
                }

                @keyframes pulse-red {
                    0% { opacity: 1; }
                    50% { opacity: 0.7; }
                    100% { opacity: 1; }
                }
            </style>
            </xpath>
        </template>
    
    </data>
</odoo>
