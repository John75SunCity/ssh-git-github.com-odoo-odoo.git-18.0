<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="work_order_shredding_view_tree" model="ir.ui.view">
            <field name="name">work.order.shredding.view.tree</field>
            <field name="model">work.order.shredding</field>
            <field name="arch" type="xml">
                <list string="Shredding Work Orders" decoration-info="state=='draft'" decoration-warning="state=='in_progress'" decoration-success="state=='completed'" decoration-muted="state=='cancelled'" decoration-danger="priority=='urgent'">
                    <field name="priority" widget="priority" />
                    <field name="name" />
                    <field name="partner_id" />
                    <field name="scheduled_date" />
                    <field name="boxes_count" string="Boxes" />
                    <field name="actual_weight" string="Weight (kg)" sum="Total Weight" />
                    <field name="state" widget="badge" decoration-info="state=='draft'" decoration-warning="state=='in_progress'" decoration-success="state=='completed'" />
                    <field name="completion_percentage" widget="progressbar" />
                    <field name="company_id" groups="base.group_multi_company" />
                </list>
            </field>
        </record>
        <record id="work_order_shredding_view_form" model="ir.ui.view">
            <field name="name">work.order.shredding.view.form</field>
            <field name="model">work.order.shredding</field>
            <field name="arch" type="xml">
                <form string="Shredding Work Order">
                    <header>
                        <button name="action_confirm" string="Confirm" type="object" class="oe_highlight" invisible="state != 'draft'" />
                        <button name="action_start_work" string="Start Shredding" type="object" class="btn-warning" invisible="state != 'confirmed'" />
                        <button name="action_open_bin_service_scanner" string="üóëÔ∏è Bin Service" type="object" class="btn-primary" invisible="state not in ['confirmed','assigned','in_progress']" title="TIP or SWAP bins - Record billable services"/>
                        <button name="action_open_camera_scanner" string="üì∑ Camera Scan" type="object" class="btn-info" invisible="state not in ['confirmed','assigned','in_progress']" title="Scan containers using phone camera"/>
                        <button name="action_open_scanner" string="‚å®Ô∏è Keyboard Scan" type="object" class="btn-secondary" invisible="state not in ['confirmed','assigned','in_progress']" icon="fa-barcode" title="Type barcodes manually or use USB scanner"/>
                        <button name="action_complete_work" string="Complete" type="object" class="btn-success" invisible="state != 'in_progress'" />
                        <button name="action_create_invoice" type="object" string="Create Invoice" 
                                class="btn-primary" invisible="state not in ('completed', 'verified') or invoice_id"
                                groups="records_management.group_records_manager"/>
                        <button name="action_view_invoice" type="object" string="View Invoice" 
                                class="btn-secondary" invisible="not invoice_id"/>
                        <button name="action_reset_for_rebilling" type="object" string="Reset for Re-billing" 
                                class="btn-warning" invisible="not invoice_id"
                                groups="records_management.group_records_manager"
                                confirm="This will unlink the invoice from this work order, allowing it to be billed again. Continue?"/>
                        <button name="action_cancel" string="Cancel" type="object" invisible="state not in ['draft','confirmed']" />
                        <button name="action_reset_to_draft" string="Reset to Draft" type="object" invisible="state != 'cancelled'" />
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,in_progress,completed" />
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" type="object" name="action_view_certificates" icon="fa-certificate">
                                <field name="certificate_count" string="Certificates" widget="statinfo" />
                            </button>
                        </div>
                        <widget name="web_ribbon" title="Archived" bg_color="bg-danger" invisible="active == True" />
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only" />
                            <h1>
                                <field name="name" placeholder="Work Order Number..." />
                            </h1>
                            <div class="o_row" name="priority_row">
                                <field name="priority" widget="priority" class="mr16" />
                                <field name="material_type" />
                            </div>
                        </div>
                        <group>
                            <group name="order_info" string="Order Information">
                                <field name="partner_id" 
                                       placeholder="Type customer name..."
                                       options="{'no_create': True, 'no_quick_create': True}"
                                       autocomplete="off"/>
                                <field name="portal_request_id" 
                                       domain="[('partner_id', '=', partner_id), ('state', 'not in', ['completed', 'rejected', 'cancelled']), ('request_type', 'in', ['shredding', 'destruction', 'pickup', 'other'])]"
                                       options="{'no_create': True}"
                                       placeholder="Link to pending portal request..."/>
                                <field name="scheduled_date" />
                                <field name="shredding_service_type" widget="radio"/>
                                <field name="material_type" widget="radio"/>
                                <field name="bin_quantity" invisible="shredding_service_type not in ('bin_onetime', 'bin_recurring', 'bin_mobile')"/>
                                <field name="active" />
                            </group>
                            <group name="service_location" string="Service Location">
                                <field name="customer_staging_location_id"
                                       placeholder="Select staging location..."
                                       options="{'no_create': true}"
                                       domain="[('partner_id', '=', partner_id)]"/>
                                <field name="use_service_location" widget="boolean_toggle"/>
                                <field name="service_location_id" 
                                       invisible="not use_service_location"
                                       placeholder="Select or create a service location..."
                                       options="{'no_quick_create': False}"
                                       context="{'default_parent_id': partner_id, 'default_is_service_location': True, 'default_type': 'other'}"/>
                                <field name="effective_service_address" readonly="1" 
                                       widget="text" string="Service Address"/>
                            </group>
                            <group name="progress_info" string="Progress &amp; Status">
                                <field name="start_date" readonly="1" />
                                <field name="completion_date" readonly="1" />
                                <field name="boxes_count" string="Boxes to Shred" />
                                <field name="actual_weight" string="Actual Weight (kg)" />
                                <field name="actual_duration" readonly="1" />
                                <field name="completion_percentage" widget="progressbar" />
                                <field name="certificate_required" widget="boolean_toggle" />
                            </group>
                        </group>
                        <notebook>
                            <page name="barcode_scanning" string="Barcode Scanning" invisible="state not in ['confirmed','assigned','in_progress']">
                                <group>
                                    <group name="scan_status" string="Scanning Status">
                                        <field name="scanned_count" readonly="1"/>
                                        <field name="last_scan_time" readonly="1"/>
                                    </group>
                                </group>
                                <separator string="Scanned Containers"/>
                                <field name="scanned_barcode_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create': True}">
                                    <list>
                                        <field name="name"/>
                                        <field name="barcode"/>
                                        <field name="partner_id"/>
                                    </list>
                                </field>
                                <div class="alert alert-info" role="status">
                                    <p><i class="fa fa-info-circle" title="Information"/> <strong>How to Scan:</strong></p>
                                    <ul>
                                        <li><strong>USB Scanner:</strong> Focus on barcode field below and scan</li>
                                        <li><strong>Mobile:</strong> Tap camera icon to scan with phone camera</li>
                                        <li><strong>Manual:</strong> Type barcode and press Enter</li>
                                    </ul>
                                </div>
                            </page>
                            <page name="materials" string="Materials &amp; Resources">
                                <group>
                                    <group>
                                        <field name="estimated_weight" />
                                        <field name="vehicle_id" />
                                    </group>
                                    <group>
                                        <field name="assigned_team_id" />
                                        <field name="technician_ids" widget="many2many_tags" />
                                    </group>
                                </group>
                                <separator string="Details" />
                                <group>
                                    <field name="special_instructions" />
                                </group>
                            </page>
                            <page name="completion" string="Completion">
                                <group>
                                    <field name="completion_notes" />
                                </group>
                            </page>
                            <page name="certificate" string="Certificate &amp; Invoice">
                                <group>
                                    <group>
                                        <field name="certificate_id" readonly="1" />
                                    </group>
                                    <group>
                                        <field name="invoice_id" readonly="1" />
                                        <field name="invoiced" />
                                    </group>
                                </group>
                            </page>
                            <page string="Customer Balance" name="customer_balance">
                                <div class="alert alert-danger" role="alert" invisible="not show_payment_alert">
                                    <strong>‚ö†Ô∏è Payment Collection Recommended</strong>
                                    <p>This customer has a significant past due balance. Please discuss payment options during this service call.</p>
                                </div>
                                <group>
                                    <group string="Company Balance">
                                        <field name="customer_total_balance" widget="monetary"/>
                                        <field name="customer_past_due_balance" widget="monetary"/>
                                        <field name="customer_balance_status" widget="badge" 
                                               decoration-success="customer_balance_status == 'current'"
                                               decoration-warning="customer_balance_status == 'attention'"
                                               decoration-danger="customer_balance_status in ('overdue', 'critical')"/>
                                    </group>
                                    <group string="Department Balance" invisible="not department_total_balance">
                                        <field name="department_total_balance" widget="monetary"/>
                                    </group>
                                </group>
                                <group string="Payment Actions">
                                    <div class="d-flex gap-2 flex-wrap">
                                        <button name="action_field_payment" type="object" 
                                                string="üí≥ Collect Payment" class="btn-primary"
                                                help="Collect payment from customer on-site"/>
                                        <button name="action_view_unpaid_invoices" type="object" 
                                                string="üìã View Unpaid Invoices" class="btn-secondary"
                                                help="View all unpaid invoices for this customer"/>
                                        <button name="action_view_payment_history" type="object" 
                                                string="üìä Payment History" class="btn-secondary"
                                                help="View payment history for this customer"/>
                                    </div>
                                </group>
                                <group string="Payment Notes">
                                    <p class="text-muted">
                                        <strong>Balance Status Guide:</strong><br/>
                                        ‚Ä¢ <span class="badge bg-success">Current</span> - All invoices within terms<br/>
                                        ‚Ä¢ <span class="badge bg-warning">Needs Attention</span> - 30+ days past due<br/>
                                        ‚Ä¢ <span class="badge bg-danger">Overdue</span> - 60+ days or $500+ past due<br/>
                                        ‚Ä¢ <span class="badge bg-danger">Critical</span> - 90+ days or $1,000+ past due - Collect payment!
                                    </p>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" />
                        <field name="activity_ids" />
                        <field name="message_ids" />
                    </div>
                </form>
            </field>
        </record>
        <record id="work_order_shredding_view_kanban" model="ir.ui.view">
            <field name="name">work.order.shredding.view.kanban</field>
            <field name="model">work.order.shredding</field>
            <field name="arch" type="xml">
                <kanban default_group_by="state" class="o_kanban_small_column">
                    <field name="name" />
                    <field name="partner_id" />
                    <field name="state" />
                    <field name="priority" />
                    <field name="scheduled_date" />
                    <field name="completion_percentage" />
                    <field name="boxes_count" />
                    <field name="actual_weight" />
                    <field name="material_type" />
                    <templates>
                        <t t-name="card">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                <div class="o_kanban_image">
                                    <i class="fa fa-scissors fa-2x text-primary" title="Shredding Service" />
                                </div>
                                <div class="oe_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="name" />
                                            </strong>
                                            <br />
                                            <small class="text-muted">
                                                <field name="partner_id" />
                                            </small>
                                        </div>
                                        <span class="float-right">
                                            <field name="priority" widget="priority" />
                                        </span>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <div class="row">
                                            <div class="col-6">
                                                <small>
                                                    <i class="fa fa-calendar" title="Scheduled Date" />
                                                    <field name="scheduled_date" />
                                                </small>
                                            </div>
                                            <div class="col-6">
                                                <small>
                                                    <i class="fa fa-cubes" title="Boxes" />
                                                    <field name="boxes_count" />
boxes
                                                </small>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">
                                                <small>
                                                    <i class="fa fa-weight" title="Weight" />
                                                    <field name="actual_weight" />
lbs
                                                </small>
                                            </div>
                                            <div class="col-6">
                                                <small>
                                                    <i class="fa fa-percent" title="Completion" />
                                                    <field name="completion_percentage" />
%
                                                </small>
                                            </div>
                                        </div>
                                        <div class="progress mt8">
                                            <div class="progress-bar" role="progressbar" t-attf-style="width: #{record.completion_percentage.raw_value}%" />
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <span class="badge badge-secondary">
                                                <field name="material_type" />
                                            </span>
                                        </div>
                                        <div class="oe_kanban_bottom_right">
                                            <field name="activity_ids" widget="kanban_activity" />
                                        </div>
                                    </div>
                                </div>
                                <div class="oe_clear" />
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <record id="work_order_shredding_view_search" model="ir.ui.view">
            <field name="name">work.order.shredding.view.search</field>
            <field name="model">work.order.shredding</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name" string="Work Order" filter_domain="['|', '|', ('name', 'ilike', self), ('partner_id', 'ilike', self), ('assigned_team_id', 'ilike', self)]" />
                    <field name="partner_id" />
                    <field name="assigned_team_id" />
                    <field name="material_type" />
                    <separator />
                    <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]" />
                    <filter string="Confirmed" name="confirmed" domain="[('state', '=', 'confirmed')]" />
                    <filter string="In Progress" name="in_progress" domain="[('state', '=', 'in_progress')]" />
                    <filter string="Completed" name="completed" domain="[('state', '=', 'completed')]" />
                    <filter string="Cancelled" name="cancelled" domain="[('state', '=', 'cancelled')]" />
                    <separator />
                    <filter string="Urgent Priority" name="urgent" domain="[('priority', '=', 'urgent')]" />
                    <filter string="High Priority" name="high_priority" domain="[('priority', 'in', ['urgent', 'high'])]" />
                    <filter string="Certificate Required" name="cert_required" domain="[('certificate_required', '=', True)]" />
                    <separator />
                    <group expand="0" string="Group By">
                        <filter string="State" name="group_state" context="{'group_by': 'state'}" />
                        <filter string="Priority" name="group_priority" context="{'group_by': 'priority'}" />
                        <filter string="Partner" name="group_partner" context="{'group_by': 'partner_id'}" />
                        <filter string="Material Type" name="group_material" context="{'group_by': 'material_type'}" />
                        <filter string="Scheduled Date" name="group_date" context="{'group_by': 'scheduled_date'}" />
                    </group>
                </search>
            </field>
        </record>
        <record id="action_work_order_shredding" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model work.order.shredding has state field - consider using default search filters -->
            <field name="name">Shredding Work Orders</field>
            <field name="res_model">work.order.shredding</field>
            <!-- Added activity, graph, pivot for analytics and scheduling -->
            <field name="view_mode">list,form</field>
            <field name="domain">[]</field>
            <field name="context">{'search_default_in_progress': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    <i class="fa fa-scissors"/> No shredding work orders yet!
                </p>
                <p>
                    <b>‚ö†Ô∏è Prerequisites:</b>
                </p>
                <ul>
                    <li>‚úì <b>Shredding Equipment</b> - Go to: <i>Records Management &gt; Configuration &gt; Equipment</i></li>
                    <li>‚úì <b>NAID Certification</b> - Go to: <i>Records Management &gt; Compliance &gt; NAID Settings</i></li>
                    <li>‚úì <b>Containers to Shred</b> - Go to: <i>Records Management &gt; Containers</i></li>
                    <li>‚úì <b>Technicians Assigned</b> - Go to: <i>Employees &gt; Shredding Teams</i></li>
                </ul>
                <p>
                    <b>üìã To create a shredding work order:</b>
                </p>
                <ol>
                    <li>Click "Create" and assign <b>Customer/Partner</b></li>
                    <li>Select <b>Shredding Type</b> (on-site/off-site/mobile)</li>
                    <li>Choose <b>Service Location</b> (customer site vs facility)</li>
                    <li>Set <b>Scheduled Date</b> and <b>Deadline</b></li>
                    <li>Add <b>Containers</b> to shred (auto-calculates weight/volume)</li>
                    <li>Assign <b>Shredding Equipment</b> and <b>Equipment Operator</b></li>
                    <li>Select <b>Coordinator</b> for multi-order sessions</li>
                    <li>Configure <b>NAID Compliance</b> settings (AAA/AA/A level)</li>
                    <li>Add <b>Assigned Technicians</b> and <b>Vehicle</b> if mobile</li>
                    <li>Enable <b>Witness Required</b> if customer observation needed</li>
                    <li>Click <b>Confirm</b> to lock order and schedule resources</li>
                    <li>Click <b>Start Shredding</b> when equipment ready</li>
                    <li>Check off containers as shredded (progress bar updates)</li>
                    <li>Click <b>Complete</b> when all items destroyed</li>
                    <li>System auto-generates <b>Certificate of Destruction</b> with witness signatures</li>
                </ol>
                <p>
                    <b>üìä Work Order States:</b>
                </p>
                <ul>
                    <li><b>Draft:</b> Planning stage, containers being added, resources not yet committed</li>
                    <li><b>Confirmed:</b> Schedule locked, equipment/technicians assigned, awaiting execution start</li>
                    <li><b>In Progress:</b> Active shredding, containers being destroyed, real-time progress tracking</li>
                    <li><b>Paused:</b> Temporary suspension (equipment maintenance, lunch break, customer request)</li>
                    <li><b>Completed:</b> All containers shredded, certificate issued, audit logs sealed</li>
                    <li><b>Cancelled:</b> Order terminated (customer cancellation, equipment failure, safety issue)</li>
                </ul>
                <p>
                    <b>üöÄ Key Features:</b><br/>
                    ‚Ä¢ <b>NAID AAA/AA/A Compliance:</b> Full chain of custody, witness signatures, video recording optional<br/>
                    ‚Ä¢ <b>Multi-Container Batching:</b> Process 10-100+ containers per work order with auto weight totals<br/>
                    ‚Ä¢ <b>Real-Time Progress:</b> Visual progress bar shows % completion, containers remaining<br/>
                    ‚Ä¢ <b>Equipment Management:</b> Track shredder usage, maintenance schedules, operator assignments<br/>
                    ‚Ä¢ <b>Witness Integration:</b> Digital signatures from customer witnesses, technicians, operators<br/>
                    ‚Ä¢ <b>Compliance Checklist:</b> Step-by-step verification tasks for NAID certification requirements<br/>
                    ‚Ä¢ <b>Auto-Certificates:</b> Generate Certificate of Destruction PDF with all required NAID elements<br/>
                    ‚Ä¢ <b>Timeline Tracking:</b> Immutable audit trail of every event, pause, duration, user action<br/>
                    ‚Ä¢ <b>Bulk Operations:</b> Confirm/start multiple orders simultaneously for efficiency<br/>
                    ‚Ä¢ <b>Performance Analytics:</b> Graph/pivot views for duration analysis, weight trends, team performance<br/>
                </p>
                <p>
                    <b>üí° Pro Tips:</b><br/>
                    ‚Ä¢ Use <b>Coordinator</b> to batch multiple customers' shredding into one session for cost efficiency<br/>
                    ‚Ä¢ Set <b>Priority = Urgent</b> for time-sensitive legal hold destructions (highlights in red)<br/>
                    ‚Ä¢ Enable <b>NAID Compliant</b> checkbox to enforce all compliance checklist items before completion<br/>
                    ‚Ä¢ Use <b>Pause/Resume</b> for meal breaks - maintains accurate labor time tracking<br/>
                    ‚Ä¢ Review <b>Equipment Status</b> before starting - prevents mid-shred breakdowns<br/>
                    ‚Ä¢ <b>Video Recording</b> toggle provides extra security documentation for high-value clients<br/>
                </p>
            </field>
        </record>
        <record id="action_work_order_shredding_my" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model work.order.shredding has state field - consider using default search filters -->
            <field name="name">My Shredding Orders</field>
            <field name="res_model">work.order.shredding</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('create_uid', '=', uid)]</field>
            <field name="context">{'search_default_in_progress': 1}</field>
        </record>
        <record id="action_work_order_shredding_urgent" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model work.order.shredding has state field - consider using default search filters -->
            <field name="name">Urgent Shredding Orders</field>
            <field name="res_model">work.order.shredding</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('priority', '=', 'urgent'), ('state', 'not in', ['completed', 'cancelled'])]</field>
            <field name="context">{'default_priority': 'urgent'}</field>
        </record>
        <record id="action_work_order_shredding_naid" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model work.order.shredding has state field - consider using default search filters -->
            <field name="name">NAID Compliance Orders</field>
            <field name="res_model">work.order.shredding</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('naid_compliant', '=', True)]</field>
            <field name="context">{'search_default_group_state': 1}</field>
        </record>
        <record id="action_work_order_shredding_today" model="ir.actions.act_window">
            <!-- OPTIMIZATION: Model work.order.shredding has state field - consider using default search filters -->
            <field name="name">Today's Shredding Orders</field>
            <field name="res_model">work.order.shredding</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('scheduled_date', '&gt;=', datetime.datetime.combine(context_today, datetime.time(0,0,0))), ('scheduled_date', '&lt;=', datetime.datetime.combine(context_today, datetime.time(23,59,59)))]</field>
            <field name="context">{'search_default_group_coordinator': 1}</field>
        </record>
        <!-- Activity view for shredding orders -->
        <record id="work_order_shredding_view_activity" model="ir.ui.view">
            <field name="name">work.order.shredding.view.activity</field>
            <field name="model">work.order.shredding</field>
            <field name="arch" type="xml">
                <activity string="Shredding Work Order Activities"/>
            </field>
        </record>
        <!-- Graph view for shredding performance -->
        <record id="work_order_shredding_view_graph" model="ir.ui.view">
            <field name="name">work.order.shredding.view.graph</field>
            <field name="model">work.order.shredding</field>
            <field name="arch" type="xml">
                <graph string="Shredding Performance" type="bar" stacked="True">
                    <field name="scheduled_date" interval="day" />
                    <field name="actual_duration" type="measure" />
                    <field name="actual_weight" type="measure" />
                    <field name="boxes_count" type="measure" />
                    <field name="state" />
                </graph>
            </field>
        </record>
        <!-- Pivot view for multi-dimensional shredding analytics -->
        <record id="work_order_shredding_view_pivot" model="ir.ui.view">
            <field name="name">work.order.shredding.view.pivot</field>
            <field name="model">work.order.shredding</field>
            <field name="arch" type="xml">
                <pivot string="Shredding Analysis" disable_linking="True">
                    <field name="scheduled_date" interval="month" />
                    <field name="partner_id" />
                    <field name="priority" />
                    <field name="material_type" />
                    <field name="state" />
                    <field name="actual_duration" type="measure" />
                    <field name="actual_weight" type="measure" />
                    <field name="boxes_count" type="measure" />
                </pivot>
            </field>
        </record>
    </data>
</odoo>
