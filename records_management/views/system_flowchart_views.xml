<?xml version="1.0" encoding="UTF-8"?>
<odoo>
<data>

    <!-- ============================================================================ -->
    <!-- SYSTEM DIAGRAM DATA - SEARCH VIEW -->
    <!-- ============================================================================ -->
    <record id="system_diagram_data_view_search" model="ir.ui.view">
        <field name="name">system.diagram.data.view.search</field>
        <field name="model">system.diagram.data</field>
        <field name="arch" type="xml">
            <search string="System Flowchart Search">
                <field name="name" string="Diagram Name" filter_domain="[('name', 'ilike', self)]"/>
                <field name="search_query" string="Search Query"/>
                <field name="search_type" string="Search Type"/>

                <separator/>
                <filter name="access_only" string="Access Rights Only" domain="[('show_access_only', '=', True)]"/>
                <filter name="with_nodes" string="Has Diagram Data" domain="[('nodes_data', '!=', False)]"/>

                <separator/>
                <filter name="user_focused" string="User Focused" domain="[('search_type', '=', 'user')]"/>
                <filter name="model_focused" string="Model Focused" domain="[('search_type', '=', 'model')]"/>
                <filter name="company_focused" string="Company Focused" domain="[('search_type', '=', 'company')]"/>

                <group expand="0" string="Group By">
                    <filter string="Search Type" name="group_search_type" domain="[]" context="{'group_by': 'search_type'}"/>
                    <filter string="Access Filter" name="group_access" domain="[]" context="{'group_by': 'show_access_only'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- ============================================================================ -->
    <!-- SYSTEM DIAGRAM DATA - TREE VIEW (Enhanced) -->
    <!-- ============================================================================ -->
    <record id="system_diagram_data_view_tree" model="ir.ui.view">
        <field name="name">system.diagram.data.view.tree</field>
        <field name="model">system.diagram.data</field>
        <field name="arch" type="xml">
            <tree string="System Architecture Diagrams" decoration-success="nodes_data and edges_data" decoration-warning="not nodes_data or not edges_data" create="true" edit="true" delete="true">
                <field name="name" string="Diagram Name"/>
                <field name="search_type" string="Focus Type" widget="badge"/>
                <field name="search_query" string="Query/Target"/>
                <field name="show_access_only" string="Access Only" widget="boolean_toggle"/>

                <!-- Status indicators -->
                <field name="nodes_data" invisible="1"/>
                <field name="edges_data" invisible="1"/>
                <field name="create_date" string="Created" widget="date"/>

                <!-- Action buttons -->
                <button name="action_generate_diagram" type="object" title="Generate Interactive Flowchart" icon="fa-sitemap" class="btn-primary"/>
                <button name="action_export_diagram" type="object" title="Export Diagram Data" icon="fa-download" class="btn-secondary"/>
                <button name="action_refresh_data" type="object" title="Refresh Diagram Data" icon="fa-refresh" class="btn-outline-primary"/>
            </tree>
        </field>
    </record>

<!-- ============================================================================ -->
<!-- SYSTEM DIAGRAM DATA - KANBAN VIEW -->
<!-- ============================================================================ -->
<record id="system_diagram_data_view_kanban" model="ir.ui.view">
<field name="name">system.diagram.data.view.kanban</field>
<field name="model">system.diagram.data</field>
<field name="arch" type="xml">
<kanban string="System Architecture Diagrams" class="o_kanban_dashboard">
    <field name="name"/>

<field name="search_type"/>

<field name="search_query"/>

<field name="show_access_only"/>
<field name="nodes_data"/>
<field name="edges_data"/>

<field name="create_date"/>

<templates>
    <t t-name="kanban-box">
        <div class="oe_kanban_card oe_kanban_global_click">
            <div class="oe_kanban_content">
                <!-- Header -->
                <div class="o_kanban_record_top mb16">
                    <div class="o_kanban_record_headings">
                        <strong class="o_kanban_record_title">
                            <field name="name"/>
                        </strong>
                        <span class="badge badge-pill" t-attf-class="badge-{{record.search_type.raw_value == 'user' and 'primary' or record.search_type.raw_value == 'model' and 'success' or 'info'}}">
                            <field name="search_type"/>
                        </span>
                    </div>
                </div>

                <!-- Content -->
                <div class="o_kanban_record_body">
                    <div class="row">
                        <div class="col-8">
                            <span class="text-muted">Target: </span>
                            <field name="search_query"/>
                        </div>
                        <div class="col-4 text-right">
                            <field name="show_access_only" widget="boolean_toggle"/>
                        </div>
                    </div>

                    <!-- Status indicators -->
                    <div class="mt8">
                        <span class="badge badge-light mr8" t-if="record.nodes_data.raw_value">
                            <i class="fa fa-circle-o text-success"/>
 Nodes Ready
                        </span>
                        <span class="badge badge-light" t-if="record.edges_data.raw_value">
                            <i class="fa fa-link text-success"/>
 Edges Ready
                        </span>
                    </div>
                </div>

                <!-- Footer with actions -->
                <div class="o_kanban_record_bottom mt16">
                    <div class="oe_kanban_bottom_left">
                        <span class="text-muted">
                            <field name="create_date" widget="date"/>
                        </span>
                    </div>
                    <div class="oe_kanban_bottom_right">
                        <button name="action_generate_diagram" type="object" class="btn btn-primary btn-sm">
                            <i class="fa fa-sitemap"/>
 Open
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </t>
</templates>
</kanban>
</field>
</record>

<!-- ============================================================================ -->
<!-- SYSTEM DIAGRAM DATA - ENHANCED FORM VIEW -->
<!-- ============================================================================ -->
<record id="system_diagram_data_view_form" model="ir.ui.view">
    <field name="name">system.diagram.data.view.form</field>
    <field name="model">system.diagram.data</field>
    <field name="arch" type="xml">
        <form string="System Diagram Configuration">
<header>
    <button name="action_generate_diagram" string="Generate Interactive Flowchart" type="object" class="btn-primary"/>
    <button name="action_export_diagram" string="Export Diagram" type="object" class="btn-secondary"/>
    <button name="action_refresh_data" string="Refresh Data" type="object" class="btn-outline-primary"/>
    <button name="action_validate_config" string="Validate Configuration" type="object" class="btn-outline-success"/>
</header>

<sheet>
<div class="oe_button_box" name="button_box">
    <button name="action_view_related_users" type="object" class="oe_stat_button" icon="fa-users" attrs="{'invisible': [('search_type', '!=', 'user')]}">
        <div class="o_field_widget o_stat_info">
            <span class="o_stat_text">Related Users</span>
        </div>
    </button>

    <button name="action_view_related_models" type="object" class="oe_stat_button" icon="fa-database" attrs="{'invisible': [('search_type', '!=', 'model')]}">
        <div class="o_field_widget o_stat_info">
            <span class="o_stat_text">Related Models</span>
        </div>
    </button>
</div>

<widget name="web_ribbon" title="Configuration Valid" bg_color="bg-success" attrs="{'invisible': [('nodes_data', '=', False)]}"/>

<group>
<group string="Basic Configuration">
    <field name="name" placeholder="e.g., User Access Analysis - John Doe"/>
    <field name="search_type" widget="radio" options="{'horizontal': true}"/>
    <field name="search_query" placeholder="Enter user name, model name, or company" attrs="{'required': [('search_type', 'in', ['user', 'model', 'company'])]}"/>
</group>
<group string="Display Options">
    <field name="show_access_only" widget="boolean_toggle"/>
    <field name="active" widget="boolean_toggle"/>
</group>
</group>

<notebook>
<page string="📊 Diagram Visualization" name="diagram_viz">
    <div class="alert alert-info" role="alert" attrs="{'invisible': [('nodes_data', '!=', False), ('edges_data', '!=', False)]}">
        <i class="fa fa-info-circle"/>

                            Click <strong>"Generate Interactive Flowchart"</strong> to create the diagram visualization.
    </div>

    <group attrs="{'invisible': [('nodes_data', '=', False), ('edges_data', '=', False)]}">
        <div class="text-center mb16">
            <button name="action_generate_diagram" string="🚀 Launch Interactive Flowchart" type="object" class="btn-primary btn-lg"/>
        </div>
    </group>
</page>

<page string="🔧 Technical Data" name="technical_data">
                        <group>
<group string="Node Data">
    <field name="nodes_data" widget="ace" options="{'mode': 'json', 'theme': 'monokai'}" placeholder='{"nodes": [{"id": "node1", "label": "Example Node"}]}'/>
</group>
<group string="Edge Data">
    <field name="edges_data" widget="ace" options="{'mode': 'json', 'theme': 'monokai'}" placeholder='{"edges": [{"from": "node1", "to": "node2"}]}'/>
</group>
</group>
</page>

<page string="⚙️ Advanced Configuration" name="advanced_config">
    <group>
<field name="diagram_config" widget="ace" options="{'mode': 'json', 'theme': 'github'}" placeholder='{"layout": {"hierarchical": true}, "interaction": {"hover": true}}'/>
</group>
<div class="mt16">
    <h5>Configuration Templates</h5>
    <div class="row">
        <div class="col-md-4">
            <button name="action_load_user_template" string="👤 User Access Template" type="object" class="btn btn-outline-primary btn-block"/>
        </div>
        <div class="col-md-4">
            <button name="action_load_model_template" string="🏗️ Model Structure Template" type="object" class="btn btn-outline-success btn-block"/>
        </div>
        <div class="col-md-4">
            <button name="action_load_system_template" string="🌐 System Overview Template" type="object" class="btn btn-outline-info btn-block"/>
        </div>
    </div>
</div>
</page>
<page string="📋 Export &amp; Share" name="export_share">
    <group>
<group string="Export Options">
    <div>
        <button name="action_export_png" string="📷 Export as PNG" type="object" class="btn btn-outline-primary mr8"/>
        <button name="action_export_pdf" string="📄 Export as PDF" type="object" class="btn btn-outline-secondary mr8"/>
        <button name="action_export_json" string="💾 Export Data (JSON)" type="object" class="btn btn-outline-info"/>
    </div>
</group>
<group string="Share Options">
    <div>
        <button name="action_generate_share_link" string="🔗 Generate Share Link" type="object" class="btn btn-outline-success mr8"/>
        <button name="action_email_diagram" string="📧 Email Diagram" type="object" class="btn btn-outline-warning"/>
    </div>
</group>
</group>
</page>
</notebook>
</sheet>
<div class="oe_chatter">
    <field name="message_follower_ids"/>
    <field name="message_ids"/>
</div>
</form>
</field>
</record>

<!-- ============================================================================ -->
<!-- ENHANCED ACTIONS -->
<!-- ============================================================================ -->
<record id="action_system_flowchart" model="ir.actions.act_window">
<field name="name">📊 System Architecture Flowchart</field>
<field name="res_model">system.diagram.data</field>
<field name="view_mode">kanban,tree,form</field>
<field name="target">current</field>
<field name="context">{
        'search_default_with_nodes': 1,
        'default_search_type': 'user',
        'default_show_access_only': True
    }</field>
<field name="help" type="html">
    <p class="o_view_nocontent_smiling_face">
🚀 Create Your First Interactive System Flowchart!
</p>
<div class="row">
    <div class="col-md-8 offset-md-2">
        <p class="lead">
                    Visualize your Records Management System architecture with interactive,
                    real-time flowcharts showing models, users, access rights, and relationships.
        </p>
<h5>✨ Key Features:</h5>
<ul class="list-unstyled">
    <li>🎯        <strong>Real-time Access Rights</strong> - Visual indicators for permissions</li>
    <li>🔍        <strong>Interactive Search</strong> - Find users, models, and companies instantly</li>
    <li>🏗️        <strong>Hierarchical Layout</strong> - Clear system structure visualization</li>
    <li>📊        <strong>Detailed Analytics</strong> - Click nodes for comprehensive information</li>
    <li>📤        <strong>Export Ready</strong> - Save diagrams for documentation and presentations</li>
</ul>
<div class="text-center mt24">
    <p class="text-muted">Ready to explore your system architecture?</p>
</div>
</div>
</div>
</field>
</record>

<!-- Quick Launch Actions for Different Scenarios -->
<record id="action_system_flowchart_user_analysis" model="ir.actions.act_window">
    <field name="name">👤 User Access Analysis</field>
    <field name="res_model">system.diagram.data</field>
    <field name="view_mode">form</field>
    <field name="target">new</field>
    <field name="context">{
        'default_name': 'User Access Analysis',
        'default_search_type': 'user',
        'default_show_access_only': True,
        'form_view_initial_mode': 'edit'
    }</field>
</record>

<record id="action_system_flowchart_model_explorer" model="ir.actions.act_window">
    <field name="name">🏗️ Model Structure Explorer</field>
    <field name="res_model">system.diagram.data</field>
    <field name="view_mode">form</field>
    <field name="target">new</field>
    <field name="context">{
        'default_name': 'Model Structure Analysis',
        'default_search_type': 'model',
        'default_show_access_only': False,
        'form_view_initial_mode': 'edit'
    }</field>
</record>

<record id="action_system_flowchart_company_overview" model="ir.actions.act_window">
    <field name="name">🏢 Company System Overview</field>
    <field name="res_model">system.diagram.data</field>
    <field name="view_mode">form</field>
    <field name="target">new</field>
    <field name="context">{
        'default_name': 'Company System Overview',
        'default_search_type': 'company',
        'default_show_access_only': False,
        'form_view_initial_mode': 'edit'
    }</field>
</record>

<!-- Modern Client Action for Interactive Flowchart -->
<record id="action_system_flowchart_interactive" model="ir.actions.client">
    <field name="name">🎯 Interactive System Flowchart</field>
    <field name="tag">records_management.system_flowchart_interactive</field>
    <field name="target">current</field>
    <field name="params" eval="{'fullscreen': True, 'withControlPanel': True}"/>
</record>

<!-- ============================================================================ -->
<!-- ENHANCED MENU STRUCTURE -->
<!-- ============================================================================ -->
<menuitem id="menu_system_architecture" name="📊 System Architecture" parent="records_management.menu_records_management_root" sequence="20" groups="records_management.group_records_manager"/>

<!-- Main System Analysis Submenu -->
<menuitem id="menu_system_analysis" name="🔍 System Analysis" parent="menu_system_architecture" sequence="10"/>

<!-- Interactive Flowchart Options -->
<menuitem id="menu_system_flowchart_main" name="🎯 Interactive Flowcharts" parent="menu_system_analysis" action="action_system_flowchart" sequence="10"/>

<menuitem id="menu_system_flowchart_user" name="👤 User Access Analysis" parent="menu_system_analysis" action="action_system_flowchart_user_analysis" sequence="20"/>

<menuitem id="menu_system_flowchart_model" name="🏗️ Model Structure Explorer" parent="menu_system_analysis" action="action_system_flowchart_model_explorer" sequence="30"/>


<menuitem id="menu_system_flowchart_company" name="🏢 Company Overview" parent="menu_system_analysis" action="action_system_flowchart_company_overview" sequence="40"/>


<!-- Quick Access for Users -->
<menuitem id="menu_system_overview_quick" name="📋 System Overview" parent="records_management.menu_records_management_root" action="action_system_flowchart_interactive" sequence="5" groups="records_management.group_records_user"/>


<!-- Configuration Menu -->
<menuitem id="menu_system_flowchart_config" name="⚙️ Flowchart Configuration" parent="records_management.menu_records_configuration" action="action_system_flowchart" sequence="45" groups="records_management.group_records_manager"/>


</data>
</odoo>
