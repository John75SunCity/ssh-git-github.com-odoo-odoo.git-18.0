<?xml version="1.0" encoding="utf-8"?>
<odoo><!-- List view for bin.key.history -->
    <record id="bin_key_history_view_tree" model="ir.ui.view">
        <field name="name">bin.key.history.view.tree</field>
        <field name="model">bin.key.history</field>
        <field name="arch" type="xml">
        <list string="Bin Key History" decoration-info="action_type == 'assigned'" decoration-success="action_type == 'returned'" decoration-warning="action_type == 'lost'" decoration-danger="action_type == 'emergency_override'">
        <field name="key_id"/>
        <field name="assigned_to"/>
        <field name="action_type" widget="badge"/>
        <field name="assignment_date"/>
        <field name="return_date"/>
        <field name="assignment_reason"/>
        <field name="authorized_by"/>
        <field name="company_id" groups="base.group_multi_company"/>

        </list>
    </field>
    </record>

<!-- Form view for bin.key.history -->
    <record id="bin_key_history_view_form" model="ir.ui.view">
        <field name="name">bin.key.history.view.form</field>
        <field name="model">bin.key.history</field>
        <field name="arch" type="xml">
        <form string="Bin Key History Record" create="false" edit="false">
            <sheet>
        <div class="oe_button_box" name="button_box">
<button name="action_view_key_details" type="object" class="oe_stat_button" icon="fa-key" title="View Key Details">
    <div class="o_stat_info">
        <span class="o_stat_text">View Key</span>
    </div>
</button>
</div>

<widget name="web_ribbon" title="Emergency Override" bg_color="bg-danger" invisible="action_type != 'emergency_override'"/>

<widget name="web_ribbon" title="Lost Key" bg_color="bg-warning" invisible="action_type != 'lost'"/>


                <div class="oe_title">
        <label for="name" class="oe_edit_only"/>

                    <h1>
        <field name="name" readonly="1"/>

                    </h1>
                </div>
        <group>
        <group string="Key Assignment Details">
        <field name="key_id" readonly="1"/>
        <field name="assigned_to" readonly="1"/>
        <field name="action_type" widget="badge" readonly="1"/>
        <field name="assignment_reason" readonly="1"/>
</group>
        <group string="Timeline">
        <field name="assignment_date" readonly="1"/>
        <field name="return_date" readonly="1"/>
        <field name="expected_return_date" readonly="1"/>
        <field name="duration_hours" readonly="1"/>
</group>
</group>

        <group>
        <group string="Authorization">
        <field name="authorized_by" readonly="1"/>
        <field name="authorization_reason" readonly="1"/>
</group>
        <group string="Security">
        <field name="security_deposit_taken" readonly="1"/>
        <field name="deposit_amount" readonly="1"/>
        <field name="access_level_granted" readonly="1"/>
</group>
</group>

<notebook>
        <page string="Audit Trail">
    <group>
        <field name="assignment_location" readonly="1"/>
        <field name="return_location" readonly="1"/>
        <field name="witness_signature" readonly="1"/>
        <field name="additional_notes" widget="text" readonly="1"/>
    </group>
</page>
        <page string="System Information">
    <group>
        <field name="company_id" groups="base.group_multi_company" readonly="1"/>
        <field name="user_id" readonly="1"/>
        <field name="active" readonly="1"/>
        <field name="create_date" readonly="1"/>
        <field name="create_uid" readonly="1"/>
    </group>
</page>
</notebook>
            </sheet>
        <div class="oe_chatter">
        <field name="message_follower_ids" widget="mail_followers"/>
        <field name="activity_ids" widget="mail_activity"/>
        <field name="message_ids" widget="mail_thread"/>
</div>
        </form>
    </field>
    </record>

<!-- Kanban view for bin.key.history -->
    <record id="bin_key_history_view_kanban" model="ir.ui.view">
        <field name="name">bin.key.history.view.kanban</field>
        <field name="model">bin.key.history</field>
        <field name="arch" type="xml">
    <kanban class="o_kanban_mobile">
        <field name="key_id"/>
        <field name="assigned_to"/>
        <field name="action_type"/>
        <field name="assignment_date"/>
        <field name="return_date"/>
        <templates>
<t t-name="card">
                <div class="oe_kanban_card oe_kanban_global_click">
                    <div class="o_kanban_record_top mb-2">
                        <div class="o_kanban_record_headings">
                            <strong class="o_kanban_record_title">
        <field name="key_id"/>
                            </strong>
                        </div>
                        <div class="o_kanban_record_subtitle text-muted">
        <field name="assigned_to"/>
                        </div>
                    </div>
                    <div class="o_kanban_record_body">
                        <span class="badge" t-attf-class="badge-#{action_type == 'assigned' and 'info' or action_type == 'returned' and 'success' or action_type == 'lost' and 'warning' or 'danger'}">
        <field name="action_type"/>
                        </span>
                        <br/>
                        <i class="fa fa-calendar"/>
        <field name="assignment_date"/>
                        <t t-if="return_date">
                            <br/>
                            <i class="fa fa-check"/>
        <field name="return_date"/>
                        </t>
                    </div>
                </div>
            </t>
        </templates>
    </kanban>
</field>
    </record>

<!-- Search view for bin.key.history -->
    <record id="bin_key_history_view_search" model="ir.ui.view">
        <field name="name">bin.key.history.view.search</field>
        <field name="model">bin.key.history</field>
        <field name="arch" type="xml">
        <search string="Search Key History">
        <field name="name" string="Record Name"/>
        <field name="key_id" string="Key"/>
        <field name="assigned_to" string="Assigned To"/>
        <field name="authorized_by" string="Authorized By"/>
        <field name="assignment_reason" string="Reason"/>

<separator/>

<filter string="Active Assignments" name="active_assignments" domain="[('return_date', '=', False)]"/>
<filter string="Returned Keys" name="returned" domain="[('return_date', '!=', False)]"/>
<filter string="Overdue Returns" name="overdue" domain="[('expected_return_date', '&lt;', context_today), ('return_date', '=', False)]"/>
<filter string="Emergency Access" name="emergency" domain="[('action_type', '=', 'emergency_override')]"/>
<filter string="Lost Keys" name="lost" domain="[('action_type', '=', 'lost')]"/>

<separator/>

<filter string="This Month" name="this_month" domain="[('assignment_date', '&gt;=', context_today.strftime('%Y-%m-01'))]"/>
<filter string="Last 7 Days" name="last_week" domain="[('assignment_date', '&gt;=', (context_today - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>

<separator/>

<filter string="Archived" name="inactive" domain="[('active', '=', False)]"/>

            <group expand="1" string="Group By">
<filter string="Action Type" name="group_action_type" domain="[]" context="{'group_by': 'action_type'}"/>
<filter string="Key" name="group_key" domain="[]" context="{'group_by': 'key_id'}"/>
<filter string="Assigned To" name="group_assigned_to" domain="[]" context="{'group_by': 'assigned_to'}"/>
<filter string="Authorized By" name="group_authorized_by" domain="[]" context="{'group_by': 'authorized_by'}"/>
<filter string="Assignment Date" name="group_assignment_date" domain="[]" context="{'group_by': 'assignment_date:month'}"/>
<filter string="Company" name="group_company" domain="[]" context="{'group_by': 'company_id'}" groups="base.group_multi_company"/>

            </group>
        </search>
    </field>
    </record>

<!-- Action for bin.key.history -->
    <record id="action_bin_key_history" model="ir.actions.act_window">
        <field name="name">Bin Key History</field>
        <field name="res_model">bin.key.history</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="domain">[]</field>
        <field name="context">{'search_default_this_month': 1}</field>
        <field name="help" type="html">
        <p class="oe_view_nocontent_create">
No key history records found.
</p>
<p>
Key history records are automatically created when keys are assigned,
            returned, or when other actions are performed. This provides a complete
            audit trail for compliance and security monitoring.
</p>
<p>
<strong>Key Features:</strong>
<br/>
            • Complete assignment and return tracking<br/>
            • Emergency access logging<br/>
            • Security deposit management<br/>
            • Authorization audit trails<br/>
            • NAID AAA compliance support
        </p>
    </field>
    </record>

    </odoo>
