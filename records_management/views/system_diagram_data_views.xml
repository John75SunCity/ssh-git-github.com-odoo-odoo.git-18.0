<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================================================ -->
    <!-- SYSTEM DIAGRAM DATA - LIST VIEW -->
    <!-- ============================================================================ -->
    <record id="system_diagram_data_view_list" model="ir.ui.view">
        <field name="name">system.diagram.data.view.list</field>
        <field name="model">system.diagram.data</field>
        <field name="arch" type="xml">
        <list string="System Diagrams"
              decoration-info="search_type == 'user'"
              decoration-success="search_type == 'model'"
              decoration-warning="search_type == 'company'">
            <field name="name"/>
            <field name="search_type" widget="badge"/>
            <field name="search_query"/>
            <field name="show_access_only" widget="boolean_toggle"/>
            <field name="node_count" string="Nodes"/>
            <field name="edge_count" string="Edges"/>
            <field name="create_date" string="Created"/>
            <field name="company_id" groups="base.group_multi_company"/>
        </list>
    </field>
    </record>

<!-- ============================================================================ -->
<!-- SYSTEM DIAGRAM DATA - FORM VIEW -->
<!-- ============================================================================ -->
    <record id="system_diagram_data_view_form" model="ir.ui.view">
        <field name="name">system.diagram.data.view.form</field>
        <field name="model">system.diagram.data</field>
        <field name="arch" type="xml">
        <form string="System Diagram Data">
            <header>
                <field name="state" widget="statusbar" statusbar_visible="draft,generated,cached"/>
            </header>
            <sheet>
                <div class="oe_button_box" name="button_box">
                    <button class="oe_stat_button" type="action" icon="fa-sitemap">
                        <field name="node_count" string="Nodes" widget="statinfo"/>
                    </button>
                    <button class="oe_stat_button" type="action" icon="fa-link">
                        <field name="edge_count" string="Edges" widget="statinfo"/>
                    </button>
                </div>
                <div class="oe_title">
                    <label for="name" class="oe_edit_only"/>
                    <h1>
                        <field name="name" placeholder="System Diagram Name..."/>
                    </h1>
                </div>
                <group>
                    <group name="search_config" string="Search Configuration">
                        <field name="search_type" widget="radio"/>
                        <field name="search_query" placeholder="Enter search target (user, model, or company)"/>
                        <field name="show_access_only" string="Access Rights Focus"/>
                        <field name="include_inactive" string="Include Inactive Records"/>
                    </group>
                    <group name="system_info" string="System Information">
                        <field name="company_id" groups="base.group_multi_company"/>
                        <field name="user_id" string="Created by"/>
                        <field name="create_date" string="Generated Date"/>
                        <field name="cache_timestamp" string="Cache Updated" widget="datetime"/>
                    </group>
                </group>
                <notebook>
                    <page name="diagram_preview" string="Diagram Preview">
                        <group>
                            <field name="diagram_html" widget="html" nolabel="1"/>
                        </group>
                    </page>
                    <page name="nodes_data" string="Nodes Data">
                        <group>
                            <field name="nodes_data" widget="ace" options="{'mode': 'json'}" nolabel="1"/>
                        </group>
                    </page>
                    <page name="edges_data" string="Edges Data">
                        <group>
                            <field name="edges_data" widget="ace" options="{'mode': 'json'}" nolabel="1"/>
                        </group>
                    </page>
                    <page name="advanced_config" string="Advanced Configuration">
                        <group>
                            <group name="layout_settings" string="Layout Settings">
                                <field name="layout_algorithm" string="Layout Algorithm"/>
                                <field name="node_spacing" string="Node Spacing"/>
                                <field name="edge_length" string="Edge Length"/>
                            </group>
                            <group name="filter_settings" string="Filter Settings">
                                <field name="max_depth" string="Maximum Depth"/>
                                <field name="exclude_system_models" string="Exclude System Models"/>
                                <field name="group_by_module" string="Group by Module"/>
                            </group>
                        </group>
                    </page>
                    <page name="performance_stats" string="Performance Statistics">
                        <group>
                            <field name="generation_time" string="Generation Time (ms)" readonly="1"/>
                            <field name="cache_size" string="Cache Size (KB)" readonly="1"/>
                            <field name="last_access" string="Last Accessed" readonly="1"/>
                        </group>
                    </page>
                </notebook>
            </sheet>
            <div class="oe_chatter">
                <field name="message_follower_ids"/>
                <field name="activity_ids"/>
                <field name="message_ids"/>
            </div>
        </form>
    </field>
    </record>

<!-- ============================================================================ -->
<!-- SYSTEM DIAGRAM DATA - SEARCH VIEW -->
<!-- ============================================================================ -->
    <record id="system_diagram_data_view_search" model="ir.ui.view">
        <field name="name">system.diagram.data.view.search</field>
        <field name="model">system.diagram.data</field>
        <field name="arch" type="xml">
        <search string="System Diagrams Search">
            <field name="name" string="Diagram Name" filter_domain="[('name', 'ilike', self)]"/>
            <field name="search_query" string="Search Target"/>
            <field name="search_type" string="Diagram Type"/>
            <separator/>
            <!-- Filters -->
            <filter name="user_diagrams" string="User Analysis" domain="[('search_type', '=', 'user')]"/>
            <filter name="model_diagrams" string="Model Structure" domain="[('search_type', '=', 'model')]"/>
            <filter name="company_diagrams" string="Company Overview" domain="[('search_type', '=', 'company')]"/>
            <separator/>
            <filter name="access_focus" string="Access Rights Focus" domain="[('show_access_only', '=', True)]"/>
            <filter name="include_inactive" string="Include Inactive" domain="[('include_inactive', '=', True)]"/>
            <separator/>
            <filter name="recent" string="Recent (Last 7 days)" domain="[('create_date', '>=', (context_today - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
            <filter name="my_diagrams" string="My Diagrams" domain="[('user_id', '=', uid)]"/>
            <group expand="0" string="Group By">
                <filter name="group_by_type" string="Diagram Type" context="{'group_by': 'search_type'}"/>
                <filter name="group_by_user" string="Created By" context="{'group_by': 'user_id'}"/>
                <filter name="group_by_date" string="Creation Date" context="{'group_by': 'create_date'}"/>
                <filter name="group_by_company" string="Company" context="{'group_by': 'company_id'}" groups="base.group_multi_company"/>
            </group>
        </search>
    </field>
    </record>

<!-- ============================================================================ -->
<!-- SYSTEM DIAGRAM DATA - KANBAN VIEW -->
<!-- ============================================================================ -->
    <record id="system_diagram_data_view_kanban" model="ir.ui.view">
        <field name="name">system.diagram.data.view.kanban</field>
        <field name="model">system.diagram.data</field>
        <field name="arch" type="xml">
        <kanban string="System Architecture Diagrams" class="o_kanban_dashboard">
            <field name="name"/>
            <field name="search_type"/>
            <field name="search_query"/>
            <field name="show_access_only"/>
            <field name="node_count"/>
            <field name="edge_count"/>
            <field name="create_date"/>
            <field name="state" optional="hide"/>
            <templates>
                <t t-name="kanban-box">
                    <div class="oe_kanban_card oe_kanban_global_click">
                        <div class="oe_kanban_content">
                            <!-- Header -->
                            <div class="o_kanban_record_top mb16">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="name"/>
                                    </strong>
                                    <span class="badge badge-pill float-end" t-attf-class="badge-{{record.search_type.raw_value == 'user' and 'primary' or record.search_type.raw_value == 'model' and 'success' or 'info'}}">
                                        <t t-if="record.search_type.raw_value == 'user'"><i class="fa fa-user"/> User</t>
                                        <t t-elif="record.search_type.raw_value == 'model'"><i class="fa fa-building-o"/> Model</t>
                                        <t t-else=""><i class="fa fa-building"/> Company</t>
                                    </span>
                                </div>
                            </div>
                            <!-- Content -->
                            <div class="o_kanban_record_body">
                                <div class="row">
                                    <div class="col-8">
                                        <span class="text-muted">Target: </span>
                                        <strong>
                                            <field name="search_query"/>
                                        </strong>
                                    </div>
                                    <div class="col-4 text-end">
                                        <field name="show_access_only" widget="boolean_toggle"/>
                                    </div>
                                </div>
                                <!-- Statistics -->
                                <div class="mt-2">
                                    <span class="badge badge-light me-2">
                                        <i class="fa fa-circle-o text-primary"/>
                                        <field name="node_count"/>
                                        Nodes
                                    </span>
                                    <span class="badge badge-light">
                                        <i class="fa fa-link text-success"/>
                                        <field name="edge_count"/>
                                        Edges
                                    </span>
                                </div>
                                <!-- Status indicators -->
                                <div class="mt-2" t-if="record.state">
                                    <t t-if="record.state.raw_value == 'cached'">
                                        <span class="badge badge-success">
                                            <i class="fa fa-check"/>
                                            Cached
                                        </span>
                                    </t>
                                    <t t-elif="record.state.raw_value == 'generated'">
                                        <span class="badge badge-info">
                                            <i class="fa fa-cog"/>
                                            Generated
                                        </span>
                                    </t>
                                    <t t-else="">
                                        <span class="badge badge-warning">
                                            <i class="fa fa-clock-o"/>
                                            Draft
                                        </span>
                                    </t>
                                </div>
                            </div>
                            <!-- Footer with actions -->
                            <div class="o_kanban_record_bottom mt-3">
                                <div class="oe_kanban_bottom_left">
                                    <small class="text-muted">
                                        <field name="create_date" widget="relative"/>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </templates>
        </kanban>
    </field>
    </record>

<!-- ============================================================================ -->
<!-- WINDOW ACTIONS -->
<!-- ============================================================================ -->
    <record id="action_system_diagram_data" model="ir.actions.act_window">
        <field name="name">System Diagrams</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[]</field>
        <field name="context">{}</field>
        <field name="help" type="html">
        <p class="o_view_nocontent_create">
            <strong><i class='fa fa-bullseye'></i> Create Your First System Diagram</strong>
        </p>
        <p>
            System diagrams help visualize your Odoo architecture, user access patterns, and model relationships.
            Click the "New" button to create your first interactive system diagram.
        </p>
        <p>
            <strong>Diagram Types:</strong>
            <br/>
            <i class='fa fa-user'></i> <strong>User Analysis:</strong> Shows user access rights and permissions<br/>
            <i class='fa fa-building-o'></i> <strong>Model Structure:</strong> Displays model relationships and dependencies<br/>
            <i class='fa fa-building'></i> <strong>Company Overview:</strong> Complete system architecture for your company
        </p>
    </field>
    </record>

<!-- Specialized actions for different diagram types -->
    <record id="action_system_diagram_user_analysis" model="ir.actions.act_window">
        <field name="name">User Access Analysis</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('search_type', '=', 'user')]</field>
        <field name="context">{'default_search_type': 'user', 'default_show_access_only': True}</field>
    </record>

    <record id="action_system_diagram_model_explorer" model="ir.actions.act_window">
        <field name="name">Model Structure Explorer</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('search_type', '=', 'model')]</field>
        <field name="context">{'default_search_type': 'model'}</field>
    </record>

    <record id="action_system_diagram_company_overview" model="ir.actions.act_window">
        <field name="name">Company System Overview</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('search_type', '=', 'company')]</field>
        <field name="context">{'default_search_type': 'company'}</field>
    </record>

<!-- ============================================================================ -->
<!-- ENHANCED ACTIONS -->
<!-- ============================================================================ -->
    <record id="action_system_flowchart" model="ir.actions.act_window">
        <field name="name">System Architecture Flowchart</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form</field>
        <field name="target">current</field>
        <field name="context">{
        'search_default_with_nodes': 1,
        'default_search_type': 'user',
        'default_show_access_only': True
    }</field>
        <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
            <i class='fa fa-rocket'></i> Create Your First Interactive System Flowchart!
        </p>
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <p class="lead">
                    Visualize your Records Management System architecture with interactive,
                    real-time flowcharts showing models, users, access rights, and relationships.
                </p>
                <h5>Key Features:</h5>
                <ul class="list-unstyled">
                    <li><i class='fa fa-bullseye'></i> <strong>Real-time Access Rights</strong> - Visual indicators for permissions</li>
                    <li><i class='fa fa-search'></i> <strong>Interactive Search</strong> - Find users, models, and companies instantly</li>
                    <li><i class='fa fa-building-o'></i> <strong>Hierarchical Layout</strong> - Clear system structure visualization</li>
                    <li><i class='fa fa-bar-chart'></i> <strong>Detailed Analytics</strong> - Click nodes for comprehensive information</li>
                    <li><i class='fa fa-share'></i> <strong>Export Ready</strong> - Save diagrams for documentation and presentations</li>
                </ul>
                <div class="text-center mt24">
                    <p class="text-muted">Ready to explore your system architecture?</p>
                </div>
            </div>
        </div>
    </field>
    </record>

<!-- Quick Launch Actions for Different Scenarios -->
    <record id="action_system_flowchart_user_analysis" model="ir.actions.act_window">
        <field name="name">User Access Analysis</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
        'default_name': 'User Access Analysis',
        'default_search_type': 'user',
        'default_show_access_only': True,
        'form_view_initial_mode': 'edit'
    }</field>
    </record>

    <record id="action_system_flowchart_model_explorer" model="ir.actions.act_window">
        <field name="name">Model Structure Explorer</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
        'default_name': 'Model Structure Analysis',
        'default_search_type': 'model',
        'default_show_access_only': False,
        'form_view_initial_mode': 'edit'
    }</field>
    </record>

    <record id="action_system_flowchart_company_overview" model="ir.actions.act_window">
        <field name="name">Company System Overview</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
        'default_name': 'Company System Overview',
        'default_search_type': 'company',
        'default_show_access_only': False,
        'form_view_initial_mode': 'edit'
    }</field>
    </record>

<!-- Modern Client Action for Interactive Flowchart -->
    <record id="action_system_flowchart_interactive" model="ir.actions.client">
        <field name="name">Interactive System Flowchart</field>
        <field name="tag">records_management.system_flowchart_interactive</field>
        <field name="target">current</field>
    <!-- Removed 'fullscreen': True to avoid referencing website.fullscreen_indication template when website module not installed -->
        <field name="params" eval="{'withControlPanel': True}"/>
    </record>

<!-- ============================================================================ -->
<!-- ENHANCED MENU STRUCTURE -->
<!-- ============================================================================ -->

<!-- System Architecture - ensure parent menu exists or create fallback -->
    <menuitem id="system_diagram_data_menu_architecture"
      name="System Architecture"
      parent="records_management.menu_records_configuration"
      sequence="70"
      groups="records_management.group_records_manager"/>

    <menuitem id="system_diagram_data_menu_analysis"
      name="System Analysis"
      parent="system_diagram_data_menu_architecture"
      sequence="10"
      groups="base.group_system"/>

    <menuitem id="system_diagram_data_menu_flowchart_main"
      name="Interactive Flowcharts"
      parent="system_diagram_data_menu_analysis"
      action="action_system_flowchart"
      sequence="10"/>

    <menuitem id="system_diagram_data_menu_flowchart_user"
      name="User Access Analysis"
      parent="system_diagram_data_menu_analysis"
      action="action_system_flowchart_user_analysis"
      sequence="20"/>

    <menuitem id="system_diagram_data_menu_flowchart_model"
      name="Model Structure Explorer"
      parent="system_diagram_data_menu_analysis"
      action="action_system_flowchart_model_explorer"
      sequence="30"/>

    <menuitem id="system_diagram_data_menu_flowchart_company"
      name="Company Overview"
      parent="system_diagram_data_menu_analysis"
      action="action_system_flowchart_company_overview"
      sequence="40"/>

<!-- System Overview - ensure parent menu exists -->
    <menuitem id="system_diagram_data_menu_overview_quick"
      name="System Overview"
      parent="records_management.menu_records_operations"
      action="action_system_flowchart_interactive"
      sequence="5"
      groups="records_management.group_records_user"/>

    <menuitem id="system_diagram_data_menu_flowchart_config"
      name="Flowchart Configuration"
      parent="records_management.menu_records_configuration"
      action="action_system_flowchart"
      sequence="45"
      groups="records_management.group_records_manager"/>

</odoo>
