<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    <record id="system_diagram_data_view_tree" model="ir.ui.view">
        <field name="name">system.diagram.data.view.tree</field>
        <field name="model">system.diagram.data</field>
        <field name="type">list</field>
        <field name="arch" type="xml">
            <list string="System Diagrams"
                  decoration-info="search_type == 'access'"
                  decoration-success="search_type == 'models'"
                  decoration-warning="search_type == 'company'">
                <field name="name"/>
                <field name="search_type" widget="badge"/>
                <field name="search_query"/>
                <field name="show_access_only" widget="boolean_toggle"/>
                <field name="include_inactive" widget="boolean_toggle"/>
                <field name="node_count" string="Nodes"/>
                <field name="edge_count" string="Edges"/>
                <field name="cache_timestamp" string="Cache Updated"/>
                <field name="company_id" groups="base.group_multi_company"/>
            </list>
        </field>
    </record>

    <record id="system_diagram_data_view_form" model="ir.ui.view">
        <field name="name">system.diagram.data.view.form</field>
        <field name="model">system.diagram.data</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="System Diagram Data">
                <sheet>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" placeholder="System Diagram Name"/>
                        </h1>
                    </div>
                    <group>
                        <group name="search_config" string="Search Configuration">
                            <field name="search_type" widget="radio"/>
                            <field name="search_query" placeholder="Filter by user, model, or company"/>
                            <field name="show_access_only"/>
                            <field name="include_inactive"/>
                            <field name="group_by_module"/>
                            <field name="exclude_system_models"/>
                            <field name="max_depth"/>
                            <button name="action_regenerate_diagram" string="Regenerate Diagram" type="object" class="btn btn-primary"/>
                        </group>
                        <group name="system_info" string="System Information">
                            <field name="company_id" groups="base.group_multi_company"/>
                            <field name="create_uid" string="Created By" readonly="1"/>
                            <field name="create_date" string="Created On" readonly="1"/>
                            <field name="last_access" string="Last Accessed" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="diagram_preview" string="Diagram Preview">
                            <field name="diagram_html" widget="html" readonly="1" nolabel="1"/>
                        </page>
                        <page name="layout_settings" string="Layout Settings">
                            <group>
                                <field name="layout_algorithm"/>
                                <field name="node_spacing"/>
                                <field name="edge_length"/>
                            </group>
                        </page>
                        <page name="data_nodes" string="Nodes JSON">
                            <field name="nodes_data" widget="text" readonly="1" nolabel="1"/>
                        </page>
                        <page name="data_edges" string="Edges JSON">
                            <field name="edges_data" widget="text" readonly="1" nolabel="1"/>
                        </page>
                        <page name="configuration_json" string="Configuration JSON">
                            <field name="diagram_config" widget="text" readonly="1" nolabel="1"/>
                        </page>
                        <page name="performance_stats" string="Performance Statistics">
                            <group>
                                <field name="node_count" string="Nodes" readonly="1"/>
                                <field name="edge_count" string="Edges" readonly="1"/>
                                <field name="generation_time" string="Generation Time (s)" readonly="1"/>
                                <field name="cache_size" string="Cache Size (KB)" readonly="1"/>
                                <field name="cache_timestamp" string="Cache Updated" widget="datetime" readonly="1"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="system_diagram_data_view_search" model="ir.ui.view">
        <field name="name">system.diagram.data.view.search</field>
        <field name="model">system.diagram.data</field>
        <field name="type">search</field>
        <field name="arch" type="xml">
            <search string="System Diagrams">
                <field name="name"/>
                <field name="search_query"/>
                <field name="search_type"/>
                <separator/>
                <filter name="filter_all" string="All Data" domain="[('search_type', '=', 'all')]"/>
                <filter name="filter_access" string="Access Focus" domain="[('search_type', '=', 'access')]"/>
                <filter name="filter_models" string="Models Only" domain="[('search_type', '=', 'models')]"/>
                <filter name="filter_relationships" string="Relationships" domain="[('search_type', '=', 'relationships')]"/>
                <filter name="filter_company" string="Company Overview" domain="[('search_type', '=', 'company')]"/>
                <separator/>
                <filter name="filter_show_access" string="Access Only" domain="[('show_access_only', '=', True)]"/>
                <filter name="filter_include_inactive" string="Include Inactive" domain="[('include_inactive', '=', True)]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter name="group_search_type" string="Diagram Type" context="{'group_by': 'search_type'}"/>
                    <filter name="group_creator" string="Creator" context="{'group_by': 'create_uid'}"/>
                    <filter name="group_created_on" string="Created On" context="{'group_by': 'create_date'}"/>
                    <filter name="group_company" string="Company" context="{'group_by': 'company_id'}" groups="base.group_multi_company"/>
                </group>
            </search>
        </field>
    </record>

    <record id="system_diagram_data_view_kanban" model="ir.ui.view">
        <field name="name">system.diagram.data.view.kanban</field>
        <field name="model">system.diagram.data</field>
        <field name="type">kanban</field>
        <field name="arch" type="xml">
            <kanban string="System Diagrams" class="o_kanban_dashboard">
                <field name="name"/>
                <field name="search_type"/>
                <field name="search_query"/>
                <field name="show_access_only"/>
                <field name="include_inactive"/>
                <field name="node_count"/>
                <field name="edge_count"/>
                <field name="cache_timestamp"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top mb16">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <span class="badge badge-pill float-end badge-secondary">
                                            <t t-if="record.search_type.raw_value == 'access'"><i class="fa fa-user"/> Access</t>
                                            <t t-elif="record.search_type.raw_value == 'models'"><i class="fa fa-cubes"/> Models</t>
                                            <t t-elif="record.search_type.raw_value == 'relationships'"><i class="fa fa-sitemap"/> Relationships</t>
                                            <t t-elif="record.search_type.raw_value == 'company'"><i class="fa fa-building"/> Company</t>
                                            <t t-else=""><i class="fa fa-globe"/> All</t>
                                        </span>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="row">
                                        <div class="col-8">
                                            <span class="text-muted">Target:</span>
                                            <strong>
                                                <field name="search_query"/>
                                            </strong>
                                        </div>
                                        <div class="col-4 text-end">
                                            <field name="show_access_only" widget="boolean_toggle"/>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <span class="badge badge-light me-2">
                                            <i class="fa fa-circle-o text-primary" title="Node count"/>
                                            <field name="node_count"/> Nodes
                                        </span>
                                        <span class="badge badge-light">
                                            <i class="fa fa-link text-success" title="Edge count"/>
                                            <field name="edge_count"/> Edges
                                        </span>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom mt-3">
                                    <div class="oe_kanban_bottom_left">
                                        <small class="text-muted">
                                            <field name="cache_timestamp" widget="relative"/>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="action_system_diagram_data" model="ir.actions.act_window">
        <field name="name">System Diagrams</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form,kanban</field>
        <field name="view_id" ref="system_diagram_data_view_tree"/>
        <field name="context">{'default_search_type': 'all'}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_create">
                <strong><i class="fa fa-bullseye"></i> Create Your First System Diagram</strong>
            </p>
            <p>
                System diagrams help visualize your architecture, user access patterns, and model relationships.
                Click the "New" button to generate an interactive diagram.
            </p>
        </field>
    </record>

    <record id="action_system_diagram_access" model="ir.actions.act_window">
        <field name="name">Access Focus Diagrams</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form,kanban</field>
        <field name="view_id" ref="system_diagram_data_view_tree"/>
        <field name="domain">[('search_type', '=', 'access')]</field>
        <field name="context">{'default_search_type': 'access', 'default_show_access_only': True}</field>
    </record>

    <record id="action_system_diagram_models" model="ir.actions.act_window">
        <field name="name">Model Explorer</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form,kanban</field>
        <field name="view_id" ref="system_diagram_data_view_tree"/>
        <field name="domain">[('search_type', '=', 'models')]</field>
        <field name="context">{'default_search_type': 'models'}</field>
    </record>

    <record id="action_system_diagram_relationships" model="ir.actions.act_window">
        <field name="name">Relationship Maps</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form,kanban</field>
        <field name="view_id" ref="system_diagram_data_view_tree"/>
        <field name="domain">[('search_type', '=', 'relationships')]</field>
        <field name="context">{'default_search_type': 'relationships'}</field>
    </record>

    <record id="action_system_diagram_company" model="ir.actions.act_window">
        <field name="name">Company Overview</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form,kanban</field>
        <field name="view_id" ref="system_diagram_data_view_tree"/>
        <field name="domain">[('search_type', '=', 'company')]</field>
        <field name="context">{'default_search_type': 'company'}</field>
    </record>

    <record id="action_system_flowchart" model="ir.actions.act_window">
        <field name="name">System Architecture Flowcharts</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">list,form,kanban</field>
        <field name="view_id" ref="system_diagram_data_view_tree"/>
        <field name="target">current</field>
        <field name="context">{
            'search_default_with_nodes': 1,
            'default_search_type': 'access',
            'default_show_access_only': True
        }</field>
    </record>

    <record id="action_system_flowchart_access" model="ir.actions.act_window">
        <field name="name">User Access Analysis</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_name': 'User Access Analysis',
            'default_search_type': 'access',
            'default_show_access_only': True
        }</field>
    </record>

    <record id="action_system_flowchart_models" model="ir.actions.act_window">
        <field name="name">Model Structure Explorer</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_name': 'Model Structure Explorer',
            'default_search_type': 'models',
            'default_show_access_only': False
        }</field>
    </record>

    <record id="action_system_flowchart_relationships" model="ir.actions.act_window">
        <field name="name">Relationship Map</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_name': 'Relationship Map',
            'default_search_type': 'relationships',
            'default_show_access_only': False
        }</field>
    </record>

    <record id="action_system_flowchart_company" model="ir.actions.act_window">
        <field name="name">Company System Overview</field>
        <field name="res_model">system.diagram.data</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_name': 'Company System Overview',
            'default_search_type': 'company',
            'default_show_access_only': False
        }</field>
    </record>

    <record id="action_system_flowchart_interactive" model="ir.actions.client">
        <field name="name">Interactive System Flowchart</field>
        <field name="tag">records_management.system_flowchart_interactive</field>
        <field name="target">current</field>
        <field name="params" eval="{'withControlPanel': True}"/>
    </record>

    <!-- New Owl-based System Diagram View (uses web_vis_network) -->
    <record id="action_system_diagram_owl" model="ir.actions.client">
        <field name="name">System Architecture Diagram</field>
        <field name="tag">system_diagram_view</field>
        <field name="target">current</field>
        <field name="params" eval="{}"/>
    </record>

    <menuitem id="system_diagram_data_menu_architecture"
              name="System Architecture"
              parent="records_management.menu_records_configuration"
              sequence="70"
              groups="records_management.group_records_manager"/>

    <menuitem id="system_diagram_data_menu_analysis"
              name="System Analysis"
              parent="system_diagram_data_menu_architecture"
              sequence="10"
              groups="base.group_system"/>

    <menuitem id="system_diagram_data_menu_main"
              name="All Diagrams"
              parent="system_diagram_data_menu_analysis"
              action="action_system_diagram_data"
              sequence="5"/>

    <menuitem id="system_diagram_data_menu_access"
              name="Access Focus"
              parent="system_diagram_data_menu_analysis"
              action="action_system_diagram_access"
              sequence="10"/>

    <menuitem id="system_diagram_data_menu_models"
              name="Model Explorer"
              parent="system_diagram_data_menu_analysis"
              action="action_system_diagram_models"
              sequence="20"/>

    <menuitem id="system_diagram_data_menu_relationships"
              name="Relationship Maps"
              parent="system_diagram_data_menu_analysis"
              action="action_system_diagram_relationships"
              sequence="30"/>

    <menuitem id="system_diagram_data_menu_company"
              name="Company Overview"
              parent="system_diagram_data_menu_analysis"
              action="action_system_diagram_company"
              sequence="40"/>

    <menuitem id="system_diagram_data_menu_flowchart_main"
              name="Interactive Flowcharts"
              parent="system_diagram_data_menu_analysis"
              action="action_system_flowchart"
              sequence="50"/>

    <menuitem id="system_diagram_data_menu_overview_quick"
              name="System Overview"
              parent="records_management.menu_records_operations"
              action="action_system_flowchart_interactive"
              sequence="5"
              groups="records_management.group_records_user"/>

    <!-- New Owl-based diagram menu -->
    <menuitem id="system_diagram_data_menu_owl_view"
              name="System Diagram (Modern)"
              parent="system_diagram_data_menu_analysis"
              action="action_system_diagram_owl"
              sequence="1"
              groups="records_management.group_records_user"/>

    <menuitem id="system_diagram_data_menu_flowchart_access"
              name="Create Access Diagram"
              parent="system_diagram_data_menu_analysis"
              action="action_system_flowchart_access"
              sequence="60"/>

    <menuitem id="system_diagram_data_menu_flowchart_models"
              name="Create Model Diagram"
              parent="system_diagram_data_menu_analysis"
              action="action_system_flowchart_models"
              sequence="70"/>

    <menuitem id="system_diagram_data_menu_flowchart_relationships"
              name="Create Relationship Diagram"
              parent="system_diagram_data_menu_analysis"
              action="action_system_flowchart_relationships"
              sequence="80"/>

    <menuitem id="system_diagram_data_menu_flowchart_company"
              name="Create Company Diagram"
              parent="system_diagram_data_menu_analysis"
              action="action_system_flowchart_company"
              sequence="90"/>

    </data>
</odoo>
