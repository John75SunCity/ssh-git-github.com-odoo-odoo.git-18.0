<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- NAID Audit Log Views -->
    <record id="view_naid_audit_log_tree" model="ir.ui.view">
        <field name="name">naid.audit.log.tree</field>
        <field name="model">naid.audit.log</field>
        <field name="type">list</field>
        <field name="arch" type="xml">
            <list string="NAID Audit Logs" decoration-danger="compliance_status=='violation'" decoration-warning="compliance_status=='warning'">
                <field name="timestamp"/>
                <field name="event_type"/>
                <field name="employee_id"/>
                <field name="partner_id"/>
                <field name="risk_level"/>
                <field name="compliance_status"/>
                <field name="remediation_required"/>
                <field name="is_overdue"/>
            </list>
        </field>
    </record>
    
    <record id="view_naid_audit_log_form" model="ir.ui.view">
        <field name="name">naid.audit.log.form</field>
        <field name="model">naid.audit.log</field>
        <field name="arch" type="xml">
            <form string="NAID Audit Log">
                <header>
                    <button name="action_mark_reviewed" string="Mark Reviewed" type="object" 
                            attrs="{'invisible': [('reviewed_by', '!=', False)]}" class="btn-primary"/>
                    <button name="action_complete_remediation" string="Complete Remediation" type="object"
                            attrs="{'invisible': ['|', ('remediation_required', '=', False), ('remediation_completed', '=', True)]}" class="btn-success"/>
                    <field name="compliance_status" widget="statusbar"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="timestamp"/>
                            <field name="event_type"/>
                            <field name="risk_level"/>
                            <field name="employee_id"/>
                            <field name="partner_id"/>
                        </group>
                        <group>
                            <field name="document_id"/>
                            <field name="box_id"/>
                            <field name="bale_id"/>
                            <field name="ip_address"/>
                            <field name="session_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Description">
                            <field name="description" nolabel="1"/>
                        </page>
                        <page string="Chain of Custody">
                            <field name="custody_chain" nolabel="1"/>
                        </page>
                        <page string="Witnesses">
                            <field name="witness_employee_ids"/>
                        </page>
                        <page string="Evidence">
                            <field name="evidence_attachment_ids"/>
                        </page>
                        <page string="Remediation" attrs="{'invisible': [('remediation_required', '=', False)]}">
                            <group>
                                <field name="remediation_required"/>
                                <field name="remediation_deadline"/>
                                <field name="remediation_completed"/>
                                <field name="remediation_completed_date"/>
                            </group>
                            <field name="remediation_description"/>
                        </page>
                        <page string="Review">
                            <group>
                                <field name="reviewed_by"/>
                                <field name="review_date"/>
                            </group>
                            <field name="review_notes"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    
    <record id="view_naid_audit_log_search" model="ir.ui.view">
        <field name="name">naid.audit.log.search</field>
        <field name="model">naid.audit.log</field>
        <field name="arch" type="xml">
            <search string="NAID Audit Logs">
                <field name="event_type"/>
                <field name="employee_id"/>
                <field name="partner_id"/>
                <field name="description"/>
                <filter string="High Risk" name="high_risk" domain="[('risk_level', '=', 'high')]"/>
                <filter string="Critical Risk" name="critical_risk" domain="[('risk_level', '=', 'critical')]"/>
                <filter string="Violations" name="violations" domain="[('compliance_status', 'in', ['violation', 'critical'])]"/>
                <filter string="Remediation Required" name="remediation_required" domain="[('remediation_required', '=', True)]"/>
                <filter string="Overdue" name="overdue" domain="[('is_overdue', '=', True)]"/>
                <separator/>
                <filter string="Today" name="today" domain="[('timestamp', '&gt;=', datetime.datetime.now().strftime('%Y-%m-%d'))]"/>
                <filter string="This Week" name="week" domain="[('timestamp', '&gt;=', (datetime.datetime.now() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                <filter string="This Month" name="month" domain="[('timestamp', '&gt;=', (datetime.datetime.now() - datetime.timedelta(days=30)).strftime('%Y-%m-%d'))]"/>
                <group expand="0" string="Group By">
                    <filter string="Event Type" name="group_event_type" context="{'group_by': 'event_type'}"/>
                    <filter string="Employee" name="group_employee" context="{'group_by': 'employee_id'}"/>
                    <filter string="Risk Level" name="group_risk" context="{'group_by': 'risk_level'}"/>
                    <filter string="Compliance Status" name="group_compliance" context="{'group_by': 'compliance_status'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- NAID Compliance Policy Views -->
    <record id="view_naid_compliance_policy_tree" model="ir.ui.view">
        <field name="name">naid.compliance.policy.tree</field>
        <field name="model">naid.compliance.policy</field>
        <field name="type">list</field>
        <field name="arch" type="xml">
            <list string="NAID Compliance Policies" editable="bottom">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="policy_type"/>
                <field name="mandatory"/>
                <field name="automated_check"/>
                <field name="check_frequency"/>
                <field name="active"/>
            </list>
        </field>
    </record>
    
    <record id="view_naid_compliance_policy_form" model="ir.ui.view">
        <field name="name">naid.compliance.policy.form</field>
        <field name="model">naid.compliance.policy</field>
        <field name="arch" type="xml">
            <form string="NAID Compliance Policy">
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="policy_type"/>
                            <field name="sequence"/>
                            <field name="active"/>
                        </group>
                        <group>
                            <field name="mandatory"/>
                            <field name="automated_check"/>
                            <field name="check_frequency"/>
                            <field name="review_frequency_months"/>
                        </group>
                    </group>
                    <group string="Review Dates">
                        <field name="last_review_date"/>
                        <field name="next_review_date"/>
                    </group>
                    <notebook>
                        <page string="Description">
                            <field name="description" nolabel="1"/>
                        </page>
                        <page string="Implementation">
                            <field name="implementation_notes" nolabel="1"/>
                        </page>
                        <page string="Violations">
                            <field name="violation_consequences" nolabel="1"/>
                        </page>
                        <page string="Responsible Employees">
                            <field name="responsible_employee_ids"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- NAID Chain of Custody Views -->
    <record id="view_naid_chain_custody_tree" model="ir.ui.view">
        <field name="name">naid.chain.custody.tree</field>
        <field name="model">naid.chain.custody</field>
        <field name="type">list</field>
        <field name="arch" type="xml">
            <list string="Chain of Custody">
                <field name="name"/>
                <field name="customer_id"/>
                <field name="current_custodian_id"/>
                <field name="start_date"/>
                <field name="end_date"/>
                <field name="status"/>
                <field name="compliance_verified"/>
            </list>
        </field>
    </record>
    
    <record id="view_naid_chain_custody_form" model="ir.ui.view">
        <field name="name">naid.chain.custody.form</field>
        <field name="model">naid.chain.custody</field>
        <field name="arch" type="xml">
            <form string="Chain of Custody">
                <header>
                    <button name="action_transfer_custody" string="Transfer Custody" type="object" class="btn-primary"/>
                    <button name="action_complete_custody" string="Complete Custody" type="object" 
                            attrs="{'invisible': [('status', '=', 'completed')]}" class="btn-success"/>
                    <field name="status" widget="statusbar"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="customer_id"/>
                            <field name="service_id"/>
                            <field name="current_custodian_id"/>
                        </group>
                        <group>
                            <field name="start_date"/>
                            <field name="end_date"/>
                            <field name="security_level"/>
                            <field name="total_weight"/>
                        </group>
                    </group>
                    <group string="Materials">
                        <field name="materials_description" nolabel="1"/>
                    </group>
                    <notebook>
                        <page string="Custody Events">
                            <field name="custody_events">
                                <list editable="bottom">
                                    <field name="timestamp"/>
                                    <field name="event_type"/>
                                    <field name="employee_id"/>
                                    <field name="location"/>
                                    <field name="description"/>
                                </list>
                            </field>
                        </page>
                        <page string="Compliance">
                            <group>
                                <field name="compliance_verified"/>
                            </group>
                            <field name="verification_notes" nolabel="1"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- HR Employee NAID Views -->
    <record id="view_hr_employee_naid_form" model="ir.ui.view">
        <field name="name">hr.employee.naid.form</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">
            <notebook position="inside">
                <page string="NAID Compliance" groups="group_naid_security_officer,group_naid_compliance_manager">
                    <group string="Background Check">
                        <group>
                            <field name="background_check_status"/>
                            <field name="background_check_date"/>
                            <field name="background_check_expiry"/>
                        </group>
                        <group>
                            <field name="background_check_provider"/>
                            <field name="background_check_reference"/>
                            <field name="background_check_expires_soon"/>
                        </group>
                    </group>
                    <group string="Security Clearance">
                        <group>
                            <field name="security_clearance_level"/>
                            <field name="security_clearance_date"/>
                            <field name="security_clearance_expiry"/>
                        </group>
                        <group>
                            <field name="clearance_expires_soon"/>
                        </group>
                    </group>
                    <group string="NAID Training">
                        <group>
                            <field name="naid_training_completed"/>
                            <field name="naid_training_date"/>
                            <field name="naid_training_expiry"/>
                        </group>
                        <group>
                            <field name="naid_certification_number"/>
                            <field name="training_expires_soon"/>
                        </group>
                    </group>
                    <group string="Facility Access">
                        <group>
                            <field name="facility_access_level"/>
                            <field name="access_card_number"/>
                            <field name="access_card_issued_date"/>
                        </group>
                        <group>
                            <field name="access_card_active"/>
                        </group>
                    </group>
                    <group string="Compliance Status">
                        <group>
                            <field name="compliance_status"/>
                            <field name="last_compliance_review"/>
                            <field name="next_compliance_review"/>
                        </group>
                        <group>
                            <field name="emergency_contact_verified"/>
                            <field name="emergency_contact_verification_date"/>
                        </group>
                    </group>
                    <group string="Compliance Notes">
                        <field name="compliance_notes" nolabel="1"/>
                    </group>
                    <group string="Actions">
                        <button name="action_request_background_check" string="Request Background Check" type="object" class="btn-secondary"/>
                        <button name="action_approve_background_check" string="Approve Background Check" type="object" class="btn-success"/>
                        <button name="action_complete_naid_training" string="Complete NAID Training" type="object" class="btn-info"/>
                        <button name="action_issue_access_card" string="Issue Access Card" type="object" class="btn-primary"/>
                        <button name="action_revoke_access_card" string="Revoke Access Card" type="object" class="btn-warning"/>
                        <button name="action_conduct_compliance_review" string="Conduct Compliance Review" type="object" class="btn-secondary"/>
                    </group>
                </page>
            </notebook>
        </field>
    </record>
    
    <!-- Menu Items -->
    <record id="menu_naid_compliance" model="ir.ui.menu">
        <field name="name">NAID Compliance</field>
        <field name="parent_id" ref="records_management.menu_records_management_root"/>
        <field name="sequence">100</field>
        <field name="groups_id" eval="[(4, ref('group_naid_security_officer'))]"/>
    </record>
    
    <record id="action_naid_audit_log" model="ir.actions.act_window">
        <field name="name">Audit Logs</field>
        <field name="res_model">naid.audit.log</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_week': 1}</field>
    </record>
    
    <record id="menu_naid_audit_log" model="ir.ui.menu">
        <field name="name">Audit Logs</field>
        <field name="parent_id" ref="menu_naid_compliance"/>
        <field name="action" ref="action_naid_audit_log"/>
        <field name="sequence">10</field>
    </record>
    
    <record id="action_naid_compliance_policy" model="ir.actions.act_window">
        <field name="name">Compliance Policies</field>
        <field name="res_model">naid.compliance.policy</field>
        <field name="view_mode">tree,form</field>
    </record>
    
    <record id="menu_naid_compliance_policy" model="ir.ui.menu">
        <field name="name">Compliance Policies</field>
        <field name="parent_id" ref="menu_naid_compliance"/>
        <field name="action" ref="action_naid_compliance_policy"/>
        <field name="sequence">20</field>
    </record>
    
    <record id="action_naid_chain_custody" model="ir.actions.act_window">
        <field name="name">Chain of Custody</field>
        <field name="res_model">naid.chain.custody</field>
        <field name="view_mode">tree,form</field>
    </record>
    
    <record id="menu_naid_chain_custody" model="ir.ui.menu">
        <field name="name">Chain of Custody</field>
        <field name="parent_id" ref="menu_naid_compliance"/>
        <field name="action" ref="action_naid_chain_custody"/>
        <field name="sequence">30</field>
    </record>
    
</odoo>
