<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- üîß ENTERPRISE FIELD SERVICE MANAGEMENT - Mobile Operations -->
    
    <!-- üé® FSM Task Kanban Dashboard -->
    <record id="view_fsm_task_kanban" model="ir.ui.view">
        <field name="name">fsm.task.kanban</field>
        <field name="model">fsm.task</field>
        <field name="arch" type="xml">
            <kanban default_group_by="task_status" class="o_kanban_fsm_task_dashboard">
                <field name="name"/>
                <field name="task_type"/>
                <field name="task_status"/>
                <field name="assigned_technician"/>
                <field name="scheduled_date"/>
                <field name="priority"/>
                <field name="customer_id"/>
                <field name="location_address"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_card_header">
                                <div class="o_kanban_card_header_title">
                                    <div class="o_primary">
                                        <strong>üîß <field name="name"/></strong>
                                    </div>
                                    <div class="o_secondary">
                                        üë§ <field name="customer_id"/>
                                    </div>
                                </div>
                                <div class="o_kanban_manage_button_section">
                                    <a class="o_kanban_manage_toggle_button" href="#"><i class="fa fa-ellipsis-v" title="More options"/></a>
                                </div>
                            </div>
                            <div class="o_kanban_card_content">
                                <div class="row">
                                    <div class="col-8">
                                        <div><i class="fa fa-wrench" title="Task Type"/> <field name="task_type"/></div>
                                        <div><i class="fa fa-calendar" title="Scheduled Date"/> <field name="scheduled_date"/></div>
                                        <div><i class="fa fa-user" title="Assigned Technician"/> <field name="assigned_technician"/></div>
                                        <div><i class="fa fa-map-marker" title="Location"/> <field name="location_address"/></div>
                                    </div>
                                    <div class="col-4">
                                        <span class="badge" t-att-class="record.priority.raw_value === 'high' ? 'badge-danger' : record.priority.raw_value === 'medium' ? 'badge-warning' : 'badge-secondary'">
                                            <t t-if="record.priority.raw_value === 'high'">üî¥ High</t>
                                            <t t-elif="record.priority.raw_value === 'medium'">üü° Medium</t>
                                            <t t-else="">üü¢ Low</t>
                                        </span>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-6">
                                        <button class="btn btn-primary btn-sm" type="object" name="action_start_task">
                                            ‚ñ∂Ô∏è Start
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-success btn-sm" type="object" name="action_complete_task">
                                            ‚úÖ Complete
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="o_kanban_card_manage_pane dropdown-menu" role="menu">
                                <a role="menuitem" type="edit" class="dropdown-item">‚úèÔ∏è Edit Task</a>
                                <a role="menuitem" type="object" name="action_view_location" class="dropdown-item">üó∫Ô∏è View Location</a>
                                <a role="menuitem" type="object" name="action_contact_customer" class="dropdown-item">üìû Contact Customer</a>
                                <a role="menuitem" type="object" name="action_reschedule" class="dropdown-item">üìÖ Reschedule</a>
                                <div class="dropdown-divider"/>
                                <a role="menuitem" type="object" name="action_mobile_app" class="dropdown-item">üì± Mobile App</a>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- üìã Enhanced Tree with Technician Dispatch -->
    <record id="view_fsm_task_tree" model="ir.ui.view">
        <field name="name">fsm.task.list</field>
        <field name="model">fsm.task</field>
        <field name="arch" type="xml">
            <list decoration-success="task_status == 'completed'" 
                  decoration-warning="task_status == 'in_progress'"
                  decoration-danger="priority == 'high'"
                  decoration-info="task_status == 'scheduled'">
                <field name="name" string="üîß Task"/>
                <field name="task_type" string="üõ†Ô∏è Type"/>
                <field name="customer_id" string="üë§ Customer"/>
                <field name="assigned_technician" string="üë®‚Äçüîß Technician"/>
                <field name="scheduled_date" string="üìÖ Scheduled"/>
                <field name="priority" string="‚ö° Priority" widget="badge"/>
                <field name="task_status" string="üéØ Status" widget="badge"/>
                <field name="estimated_duration" string="‚è±Ô∏è Duration"/>
                <field name="location_address" string="üìç Location"/>
                <button name="action_start_task" type="object" string="Start" 
                        icon="fa-play" class="btn-link" 
                        invisible="task_status != 'scheduled'"/>
                <button name="action_complete_task" type="object" string="Complete" 
                        icon="fa-check" class="btn-link" 
                        invisible="task_status != 'in_progress'"/>
            </list>
        </field>
    </record>

    <!-- üìù Enhanced Form with Mobile-Optimized Workflow -->
    <record id="view_fsm_task_form" model="ir.ui.view">
        <field name="name">fsm.task.form</field>
        <field name="model">fsm.task</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_start_task" type="object" string="‚ñ∂Ô∏è Start Task" 
                            class="btn-primary" invisible="task_status != 'scheduled'"/>
                    <button name="action_pause_task" type="object" string="‚è∏Ô∏è Pause Task" 
                            class="btn-warning" invisible="task_status != 'in_progress'"/>
                    <button name="action_complete_task" type="object" string="‚úÖ Complete Task" 
                            class="btn-success" invisible="task_status != 'in_progress'"/>
                    <button name="action_reschedule" type="object" string="üìÖ Reschedule" class="btn-secondary"/>
                    <field name="task_status" widget="statusbar" statusbar_visible="scheduled,in_progress,completed,cancelled"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" type="object" name="action_view_time_logs" icon="fa-clock-o">
                            <field string="Time Logs" name="time_log_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" type="object" name="action_view_materials" icon="fa-cubes">
                            <field string="Materials Used" name="material_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" type="object" name="action_view_location" icon="fa-map-marker">
                            <field string="GPS Tracking" name="location_update_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" icon="fa-mobile" 
                                invisible="not mobile_optimized">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">üì±</span>
                                <span class="o_stat_text">Mobile Ready</span>
                            </div>
                        </button>
                    </div>
                    
                    <group>
                        <group string="üîß Task Information">
                            <field name="name" placeholder="e.g., Box Retrieval - Building A"/>
                            <field name="task_type"/>
                            <field name="description"/>
                            <field name="priority"/>
                        </group>
                        <group string="üë§ Assignment">
                            <field name="customer_id"/>
                            <field name="assigned_technician"/>
                            <field name="backup_technician"/>
                            <field name="supervisor"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="üìÖ Scheduling">
                            <field name="scheduled_date"/>
                            <field name="estimated_duration"/>
                            <field name="actual_start_time"/>
                            <field name="actual_completion_time"/>
                        </group>
                        <group string="üìç Location Details">
                            <field name="location_address"/>
                            <field name="location_coordinates"/>
                            <field name="facility_access_code"/>
                            <field name="parking_instructions"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="üìã Task Details" name="details">
                            <group>
                                <group string="üéØ Service Requirements">
                                    <field name="service_type"/>
                                    <field name="equipment_required"/>
                                    <field name="special_instructions"/>
                                    <field name="safety_requirements"/>
                                </group>
                                <group string="üì¶ Records Information">
                                    <field name="boxes_to_retrieve"/>
                                    <field name="documents_to_deliver"/>
                                    <field name="confidentiality_level"/>
                                    <field name="chain_of_custody_required"/>
                                </group>
                            </group>
                            <field name="task_checklist_ids" mode="list">
                                <list editable="bottom">
                                    <field name="checklist_item"/>
                                    <field name="required"/>
                                    <field name="completed"/>
                                    <field name="completion_time"/>
                                    <field name="notes"/>
                                </list>
                            </field>
                        </page>
                        <page string="‚è±Ô∏è Time Tracking" name="time_tracking">
                            <field name="time_log_ids" mode="list">
                                <list>
                                    <field name="start_time"/>
                                    <field name="end_time"/>
                                    <field name="duration"/>
                                    <field name="activity_type"/>
                                    <field name="technician"/>
                                    <field name="description"/>
                                    <field name="billable"/>
                                </list>
                            </field>
                        </page>
                        <page string="üéí Materials &amp; Equipment" name="materials">
                            <field name="material_usage_ids" mode="list">
                                <list editable="bottom">
                                    <field name="material_name"/>
                                    <field name="quantity_used"/>
                                    <field name="unit_cost"/>
                                    <field name="total_cost"/>
                                    <field name="supplier"/>
                                    <field name="billable_to_customer"/>
                                </list>
                            </field>
                        </page>
                        <page string="üì± Mobile Operations" name="mobile">
                            <group>
                                <group string="üìç GPS Tracking">
                                    <field name="gps_tracking_enabled"/>
                                    <field name="current_location"/>
                                    <field name="arrival_time"/>
                                    <field name="departure_time"/>
                                </group>
                                <group string="üì∏ Digital Evidence">
                                    <field name="photos_required"/>
                                    <field name="signature_required"/>
                                    <field name="barcode_scanning"/>
                                    <field name="offline_sync_enabled"/>
                                </group>
                            </group>
                            <field name="mobile_update_ids" mode="list">
                                <list>
                                    <field name="timestamp"/>
                                    <field name="update_type"/>
                                    <field name="location"/>
                                    <field name="status"/>
                                    <field name="notes"/>
                                    <field name="photo_attachment"/>
                                </list>
                            </field>
                        </page>
                        <page string="üìû Customer Communication" name="communication">
                            <group>
                                <group string="üì± Contact Information">
                                    <field name="primary_contact"/>
                                    <field name="contact_phone"/>
                                    <field name="contact_email"/>
                                    <field name="backup_contact"/>
                                </group>
                                <group string="üîî Notifications">
                                    <field name="notify_customer_on_arrival"/>
                                    <field name="notify_customer_on_completion"/>
                                    <field name="sms_updates_enabled"/>
                                    <field name="email_updates_enabled"/>
                                </group>
                            </group>
                            <field name="communication_log_ids" mode="list">
                                <list>
                                    <field name="communication_date"/>
                                    <field name="communication_type"/>
                                    <field name="contact_person"/>
                                    <field name="subject"/>
                                    <field name="notes"/>
                                    <field name="response_required"/>
                                </list>
                            </field>
                        </page>
                        <page string="üìä Performance Analytics" name="analytics">
                            <group>
                                <group string="‚è±Ô∏è Time Metrics">
                                    <field name="total_time_spent" readonly="1"/>
                                    <field name="travel_time" readonly="1"/>
                                    <field name="work_time" readonly="1"/>
                                    <field name="efficiency_score" readonly="1"/>
                                </group>
                                <group string="üí∞ Cost Analysis">
                                    <field name="labor_cost" readonly="1"/>
                                    <field name="material_cost" readonly="1"/>
                                    <field name="total_cost" readonly="1"/>
                                    <field name="billable_amount" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        <page string="üìù Completion Report" name="completion">
                            <group>
                                <group string="‚úÖ Task Completion">
                                    <field name="completion_status"/>
                                    <field name="quality_rating"/>
                                    <field name="customer_satisfaction"/>
                                    <field name="issues_encountered"/>
                                </group>
                                <group string="üìã Deliverables">
                                    <field name="deliverables_completed"/>
                                    <field name="customer_signature_obtained"/>
                                    <field name="follow_up_required"/>
                                    <field name="next_service_scheduled"/>
                                </group>
                            </group>
                            <field name="completion_notes" placeholder="Detailed completion report and any recommendations..."/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- üìÖ Calendar View for Technician Scheduling -->
    <record id="view_fsm_task_calendar" model="ir.ui.view">
        <field name="name">fsm.task.calendar</field>
        <field name="model">fsm.task</field>
        <field name="arch" type="xml">
            <calendar string="üìÖ Field Service Schedule" 
                      date_start="scheduled_date" 
                      date_stop="actual_completion_time"
                      color="assigned_technician">
                <field name="name"/>
                <field name="customer_id"/>
                <field name="task_type"/>
                <field name="priority"/>
                <field name="location_address"/>
            </calendar>
        </field>
    </record>

    <!-- üîç Enhanced Search with Mobile Filters -->
    <record id="view_fsm_task_search" model="ir.ui.view">
        <field name="name">fsm.task.search</field>
        <field name="model">fsm.task</field>
        <field name="arch" type="xml">
            <search>
                <field name="name" string="Task"/>
                <field name="customer_id"/>
                <field name="assigned_technician"/>
                <field name="task_type"/>
                <field name="location_address"/>
                
                <filter string="üìÖ Scheduled" name="scheduled" domain="[('task_status', '=', 'scheduled')]"/>
                <filter string="üîÑ In Progress" name="in_progress" domain="[('task_status', '=', 'in_progress')]"/>
                <filter string="‚úÖ Completed" name="completed" domain="[('task_status', '=', 'completed')]"/>
                <filter string="‚ùå Cancelled" name="cancelled" domain="[('task_status', '=', 'cancelled')]"/>
                
                <separator/>
                <filter string="üî¥ High Priority" name="high_priority" domain="[('priority', '=', 'high')]"/>
                <filter string="üü° Medium Priority" name="medium_priority" domain="[('priority', '=', 'medium')]"/>
                <filter string="üü¢ Low Priority" name="low_priority" domain="[('priority', '=', 'low')]"/>
                
                <separator/>
                <filter string="üì± Mobile Optimized" name="mobile_optimized" domain="[('mobile_optimized', '=', True)]"/>
                <filter string="üìç GPS Enabled" name="gps_enabled" domain="[('gps_tracking_enabled', '=', True)]"/>
                <filter string="üîí Confidential" name="confidential" domain="[('confidentiality_level', 'in', ['high', 'confidential'])]"/>
                
                <separator/>
                <filter string="üìÖ Today" name="today" domain="[('scheduled_date', '=', context_today())]"/>
                <filter string="üìÜ This Week" name="this_week" 
                        domain="[('scheduled_date', '&gt;=', (context_today() - relativedelta(days=context_today().weekday())).strftime('%Y-%m-%d')), 
                                ('scheduled_date', '&lt;', (context_today() + relativedelta(days=7-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                <filter string="üóìÔ∏è This Month" name="this_month" 
                        domain="[('scheduled_date', '&gt;=', context_today().strftime('%Y-%m-01'))]"/>
                
                <group expand="0" string="üìä Group By">
                    <filter string="Technician" name="group_by_technician" context="{'group_by': 'assigned_technician'}"/>
                    <filter string="Task Type" name="group_by_task_type" context="{'group_by': 'task_type'}"/>
                    <filter string="Status" name="group_by_status" context="{'group_by': 'task_status'}"/>
                    <filter string="Priority" name="group_by_priority" context="{'group_by': 'priority'}"/>
                    <filter string="Customer" name="group_by_customer" context="{'group_by': 'customer_id'}"/>
                    <filter string="Scheduled Date" name="group_by_date" context="{'group_by': 'scheduled_date:day'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- üöÄ ENTERPRISE ACTION - Field Service Management -->
    <record id="action_fsm_task_records" model="ir.actions.act_window">
        <field name="name">üîß Field Service Tasks</field>
        <field name="res_model">fsm.task</field>
        <field name="view_mode">kanban,list,form,calendar</field>
        <field name="search_view_id" ref="view_fsm_task_search"/>
        <field name="context">{
            'search_default_this_week': 1,
            'search_default_scheduled': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                üîß Schedule your first field service task!
            </p>
            <p>
                <b>Enterprise Field Service Management:</b><br/>
                ‚Ä¢ üì± Mobile-optimized technician workflows<br/>
                ‚Ä¢ üìç Real-time GPS tracking and location services<br/>
                ‚Ä¢ ‚è±Ô∏è Comprehensive time tracking and analytics<br/>
                ‚Ä¢ üì∏ Digital photo documentation and signatures<br/>
                ‚Ä¢ üîÑ Offline synchronization capabilities<br/>
                ‚Ä¢ üìû Integrated customer communication tools<br/>
                ‚Ä¢ üì¶ Chain of custody for sensitive materials<br/>
                ‚Ä¢ üí∞ Complete cost tracking and billing integration<br/>
                ‚Ä¢ üìä Performance analytics and efficiency metrics
            </p>
        </field>
    </record>
</odoo>
