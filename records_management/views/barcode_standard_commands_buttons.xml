<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    <!-- ============================================================================ -->
    <!-- ODOO STANDARD BARCODE COMMANDS - BUTTON EXTENSIONS -->
    <!-- Adds standard Odoo barcode command buttons to container forms and wizards -->
    <!-- ============================================================================ -->

    <!-- Extend Container Form View with Standard Barcode Command Buttons -->
    <record id="view_records_container_form_barcode_commands" model="ir.ui.view">
        <field name="name">records.container.form.barcode.commands</field>
        <field name="model">records.container</field>
        <field name="inherit_id" ref="records_management.records_container_view_form"/>
        <field name="arch" type="xml">
            
            <!-- Add VALIDATE and DISCARD buttons in header when there's a pending transfer -->
            <xpath expr="//header" position="inside">
                
                <!-- VALIDATE Button - Standard Odoo Command -->
                <button name="action_validate_barcode_operation" 
                        type="object" 
                        string="✓ Validate Transfer"
                        class="btn-success"
                        invisible="pending_transfer_id == False"
                        icon="fa-check-circle"
                        help="Barcode: O-BTN.validate - Confirm and complete pending stock transfer"
                        groups="records_management.group_records_user,records_management.group_records_manager"/>
                
                <!-- DISCARD Button - Standard Odoo Command -->
                <button name="action_discard_barcode_operation" 
                        type="object" 
                        string="✕ Discard Transfer"
                        class="btn-secondary"
                        invisible="pending_transfer_id == False"
                        icon="fa-times-circle"
                        help="Barcode: O-BTN.discard - Cancel and discard pending stock transfer"
                        groups="records_management.group_records_user,records_management.group_records_manager"/>
                
            </xpath>
            
            <!-- Add PRINT buttons in header -->
            <xpath expr="//header" position="inside">
                
                <!-- PRINT PICKING OPERATION Button -->
                <button name="action_print_picking_operation" 
                        type="object" 
                        string="Print Movement Slip"
                        class="btn-secondary"
                        icon="fa-print"
                        help="Barcode: O-CMD.PRINT - Print picking/movement slip"
                        groups="records_management.group_records_user,records_management.group_records_manager"/>
                
                <!-- PRINT DELIVERY SLIP Button -->
                <button name="action_print_delivery_slip" 
                        type="object" 
                        string="Print Pickup Slip"
                        class="btn-secondary"
                        icon="fa-file-text-o"
                        help="Barcode: O-CMD.PACKING - Print delivery/pickup slip"
                        groups="records_management.group_records_user,records_management.group_records_manager"/>
                
            </xpath>
            
            <!-- Add SCRAP and RETURN buttons to existing barcode operations section -->
            <xpath expr="//field[@name='last_barcode_operation']" position="after">
                
                <!-- SCRAP Command Mapping -->
                <div class="alert alert-info mt-2" role="alert">
                    <strong>Standard Odoo Commands:</strong>
                    <ul class="mb-0">
                        <li><code>O-BTN.validate</code> - Validate pending transfer</li>
                        <li><code>O-BTN.discard</code> - Cancel pending operation</li>
                        <li><code>O-BTN.scrap</code> - Queue/complete shredding</li>
                        <li><code>O-CMD.RETURN</code> - Create retrieval request</li>
                        <li><code>O-CMD.PRINT</code> - Print movement slip</li>
                        <li><code>O-CMD.PACKING</code> - Print pickup slip</li>
                        <li><code>O-CMD.MAIN-MENU</code> - Return to barcode menu</li>
                    </ul>
                </div>
                
            </xpath>
            
            <!-- Add button group for SCRAP and RETURN commands -->
            <xpath expr="//button[@name='action_barcode_add_to_inventory']" position="after">
                
                <!-- SCRAP Command Button -->
                <button name="action_barcode_scrap" 
                        type="object" 
                        string="Scrap Container"
                        class="btn btn-warning"
                        invisible="state in ['destroyed', 'pending_destruction']"
                        icon="fa-trash"
                        help="Barcode: O-BTN.scrap - Queue for destruction (standard Odoo command)"
                        groups="records_management.group_records_manager"/>
                
                <!-- RETURN Command Button -->
                <button name="action_barcode_return" 
                        type="object" 
                        string="Request Return"
                        class="btn btn-info"
                        icon="fa-undo"
                        help="Barcode: O-CMD.RETURN - Create retrieval request (standard Odoo command)"
                        groups="records_management.group_records_user,records_management.group_records_manager"/>
                
            </xpath>
            
        </field>
    </record>

    <!-- ============================================================================
         BATCH BARCODE OPERATIONS WIZARD - Add Command Reference
         Note: Barcode commands work on individual containers, not the wizard itself
         ============================================================================ -->
    
    <record id="view_batch_barcode_operations_wizard_commands" model="ir.ui.view">
        <field name="name">batch.barcode.operations.wizard.commands</field>
        <field name="model">batch.barcode.operations</field>
        <field name="inherit_id" ref="records_management.view_batch_barcode_operations_wizard"/>
        <field name="arch" type="xml">
            
            <!-- Add barcode command reference info after operation_type field -->
            <xpath expr="//field[@name='operation_type']" position="after">
                <separator string="Standard Barcode Commands" invisible="not container_ids"/>
                <div class="alert alert-info" role="alert" invisible="not container_ids">
                    <p><strong>Available Commands (scan after container barcode):</strong></p>
                    <ul class="mb-0">
                        <li><code>O-BTN.validate</code> - Validate pending transfer on container</li>
                        <li><code>O-BTN.discard</code> - Cancel operation on container</li>
                        <li><code>O-CMD.MAIN-MENU</code> - Return to barcode main menu</li>
                    </ul>
                </div>
            </xpath>
            
        </field>
    </record>

    <!-- ============================================================================
         CONTAINER INDEXING WIZARD - Add Command Reference
         Note: Barcode commands work on containers, not the wizard itself
         ============================================================================ -->
    
    <record id="view_container_indexing_wizard_commands" model="ir.ui.view">
        <field name="name">container.indexing.wizard.commands</field>
        <field name="model">container.indexing.wizard</field>
        <field name="inherit_id" ref="records_management.container_indexing_wizard_view_form"/>
        <field name="arch" type="xml">
            
            <!-- Add barcode command reference info -->
            <xpath expr="//field[@name='container_id']" position="after">
                <div class="alert alert-info mt-2" role="alert">
                    <p><strong>Barcode Commands (scan after container):</strong></p>
                    <ul class="mb-0">
                        <li><code>O-BTN.validate</code> - Complete indexing on container</li>
                        <li><code>O-BTN.discard</code> - Cancel indexing on container</li>
                    </ul>
                </div>
            </xpath>
            
        </field>
    </record>

    <!-- ============================================================================ -->
    <!-- CONTAINER KANBAN VIEW - ADD QUICK ACTION BUTTONS -->
    <!-- ============================================================================ -->
    
    <record id="view_records_container_kanban_barcode_commands" model="ir.ui.view">
        <field name="name">records.container.kanban.barcode.commands</field>
        <field name="model">records.container</field>
        <field name="inherit_id" ref="records_management.view_records_container_kanban_barcode"/>
        <field name="arch" type="xml">
            
            <!-- Add VALIDATE button to kanban cards with pending transfers -->
            <xpath expr="//div[hasclass('row', 'mt-1')]" position="after">
                <div class="row mt-1" invisible="pending_transfer_id == False">
                    <div class="col-6">
                        <button name="action_validate_barcode_operation" 
                                type="object" 
                                class="btn btn-sm btn-success btn-block" 
                                title="Validate Transfer">
                            <i class="fa fa-check"/> Validate
                        </button>
                    </div>
                    <div class="col-6">
                        <button name="action_discard_barcode_operation" 
                                type="object" 
                                class="btn btn-sm btn-secondary btn-block" 
                                title="Discard Transfer">
                            <i class="fa fa-times"/> Discard
                        </button>
                    </div>
                </div>
            </xpath>
            
        </field>
    </record>

    <!-- ============================================================================ -->
    <!-- CONTAINER TREE/LIST VIEW - ADD ACTION BUTTONS -->
    <!-- ============================================================================ -->
    
    <record id="view_records_container_tree_barcode_commands" model="ir.ui.view">
        <field name="name">records.container.tree.barcode.commands</field>
        <field name="model">records.container</field>
        <field name="inherit_id" ref="records_management.records_container_view_tree"/>
        <field name="arch" type="xml">
            
            <!-- Add pending_transfer_id field to tree view for filtering -->
            <xpath expr="//field[@name='state']" position="after">
                <field name="pending_transfer_id" optional="hide"/>
                <field name="last_barcode_operation" optional="hide"/>
                <field name="last_barcode_operation_date" optional="hide"/>
            </xpath>
            
        </field>
    </record>
    </data>
</odoo>
