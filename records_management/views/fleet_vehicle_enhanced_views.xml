<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Form View Inheritance -->
        <record id="fleet_vehicle_view_form_inherit_records_management" model="ir.ui.view">
            <field name="name">fleet.vehicle.view.form.inherit.records</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_view_form"/>
            <field name="arch" type="xml">
                <!-- Stat buttons: insert inside button_box -->
                <xpath expr="//div[@name='button_box']" position="inside" groups="records_management.group_records_user,records_management.group_records_manager">
                    <button name="action_view_pickup_routes" type="object" class="oe_stat_button" icon="fa-route" string="Routes" attrs="{'invisible': [('pickup_route_ids','=',False)]}">
                        <field name="pickup_route_ids" widget="statinfo"/>
                    </button>
                    <button name="action_set_records_available" type="object" class="oe_stat_button" icon="fa-check-circle" string="Set Available" attrs="{'invisible': [('records_operational_status','!=','out_of_service')]}"/>
                </xpath>

                <!-- Add tab in existing notebook -->
                <xpath expr="//sheet/notebook" position="inside" groups="records_management.group_records_user,records_management.group_records_manager">
                    <page string="Records Management" name="records_management">
                        <group>
                            <group string="Operations">
                                <field name="records_vehicle_type"/>
                                <field name="records_operational_status"/>
                                <field name="max_container_capacity"/>
                                <field name="naid_compliant"/>
                            </group>
                            <group string="Active Routes">
                                <field name="pickup_route_ids" readonly="1" context="{'default_vehicle_id': id}"/>
                            </group>
                        </group>

                        <separator string="Vehicle Guidance"/>
                        <div class="alert alert-info" role="status">
                            <strong><i class="fa fa-truck"/> Records Vehicle Types</strong>
                            <ul class="mt8">
                                <li><b>Standard Pickup:</b> Regular document pickup &amp; delivery</li>
                                <li><b>Secure Transport:</b> NAID-compliant secure chain-of-custody</li>
                                <li><b>Shredding Truck:</b> Mobile on-site document destruction</li>
                                <li><b>Container Delivery:</b> Container placement &amp; retrieval</li>
                            </ul>
                        </div>

                        <group string="Capacity &amp; Compliance">
                            <div class="alert alert-warning" role="alert" attrs="{'invisible': ['|', ('records_vehicle_type','!=','secure_transport'), ('naid_compliant','=',True)]}">
                                <i class="fa fa-exclamation-triangle"/> NAID compliance required for secure transport vehicles.
                            </div>
                            <div class="alert alert-success" role="status" attrs="{'invisible': [('naid_compliant','=',False)]}">
                                <i class="fa fa-check-circle"/> This vehicle is NAID compliant.
                            </div>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <!-- Tree View Inheritance -->
        <record id="fleet_vehicle_view_tree_inherit_records_management" model="ir.ui.view">
            <field name="name">fleet.vehicle.view.tree.inherit.records</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_view_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//tree//field[@name='license_plate']" position="after" groups="records_management.group_records_user,records_management.group_records_manager">
                    <field name="records_vehicle_type" optional="show"/>
                    <field name="records_operational_status" optional="show"/>
                    <field name="max_container_capacity" optional="hide"/>
                    <field name="naid_compliant" optional="hide"/>
                </xpath>
            </field>
        </record>

        <!-- Kanban View Inheritance -->
        <record id="fleet_vehicle_view_kanban_inherit_records_management" model="ir.ui.view">
            <field name="name">fleet.vehicle.view.kanban.inherit.records</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_view_kanban"/>
            <field name="arch" type="xml">
                <!-- Insert badges in lower footer area -->
                <xpath expr="//div[contains(@class,'oe_kanban_bottom_left')]" position="inside" groups="records_management.group_records_user,records_management.group_records_manager">
                    <span t-if="record.records_vehicle_type.raw_value" class="badge badge-info me-1">
                        <t t-esc="record.records_vehicle_type.value"/>
                    </span>
                    <span t-if="record.naid_compliant.raw_value" class="badge badge-success me-1">
                        <i class="fa fa-lock"/> NAID
                    </span>
                    <span t-if="record.max_container_capacity.raw_value" class="badge badge-secondary">
                        <i class="fa fa-box"/> <t t-esc="record.max_container_capacity.value"/> ctrs
                    </span>
                </xpath>
            </field>
        </record>

        <!-- Search View Inheritance -->
        <record id="fleet_vehicle_view_search_inherit_records_management" model="ir.ui.view">
            <field name="name">fleet.vehicle.view.search.inherit.records</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_view_search"/>
            <field name="arch" type="xml">
                <xpath expr="//search/field[@name='driver_id']" position="after" groups="records_management.group_records_user,records_management.group_records_manager">
                    <field name="records_vehicle_type"/>
                    <field name="records_operational_status"/>
                </xpath>
                <xpath expr="//search/filter[@name='inactive']" position="after" groups="records_management.group_records_user,records_management.group_records_manager">
                    <separator/>
                    <filter string="Records Vehicles" name="records_vehicles" domain="[('records_vehicle_type','!=',False)]"/>
                    <filter string="Available for Routes" name="available_routes" domain="[('records_operational_status','=','available')]"/>
                    <filter string="Currently on Route" name="on_route" domain="[('records_operational_status','=','on_route')]"/>
                    <filter string="NAID Compliant" name="naid_compliant" domain="[('naid_compliant','=',True)]"/>
                    <filter string="Secure Transport" name="secure_transport" domain="[('records_vehicle_type','=','secure_transport')]"/>
                    <filter string="Shredding Trucks" name="shredding_trucks" domain="[('records_vehicle_type','=','shredding_truck')]"/>
                </xpath>
                <xpath expr="//search/filter[@name='group_location']" position="after">
                    <filter string="Records Vehicle Type" name="group_records_type" context="{'group_by':'records_vehicle_type'}"/>
                    <filter string="Records Status" name="group_records_status" context="{'group_by':'records_operational_status'}"/>
                </xpath>
            </field>
        </record>

        <!-- Action Window (kept same id for external references) -->
        <record id="action_fleet_vehicle_records" model="ir.actions.act_window">
            <field name="name">Records Fleet Vehicles</field>
            <field name="res_model">fleet.vehicle</field>
            <field name="view_mode">kanban,list,form</field>
            <field name="domain">[('records_vehicle_type','!=',False)]</field>
            <field name="context">{'search_default_records_vehicles':1,'search_default_available_routes':1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    <i class="fa fa-truck"/> Add your first Records Management Vehicle!
                </p>
                <ul>
                    <li><i class="fa fa-wrench"/> Leverage standard fleet management</li>
                    <li><i class="fa fa-box"/> Container capacity tracking</li>
                    <li><i class="fa fa-lock"/> NAID compliance monitoring</li>
                    <li><i class="fa fa-road"/> Route assignment &amp; tracking</li>
                    <li><i class="fa fa-mobile"/> Mobile-ready status updates</li>
                    <li><i class="fa fa-bar-chart"/> Performance analytics</li>
                    <li><i class="fa fa-cog"/> Maintenance integration</li>
                    <li><i class="fa fa-gas-pump"/> Fuel cost optimization</li>
                </ul>
            </field>
        </record>

    </data>
</odoo>
