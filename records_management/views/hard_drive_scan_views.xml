<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Hard Drive Scan Wizard Form -->
    <record id="view_hard_drive_scan_wizard_form" model="ir.ui.view">
        <field name="name">hard_drive.scan.wizard.form</field>
        <field name="model">hard_drive.scan.wizard</field>
        <field name="arch" type="xml">
            <form string="Hard Drive Serial Number Scanner">
                <header>
                    <button name="action_finish_scan" string="Finish Scanning" type="object" 
                            class="btn-primary" attrs="{'invisible': [('scan_count', '=', 0)]}"/>
                    <button name="action_view_scanned_drives" string="View All Drives" type="object" 
                            class="btn-secondary"/>
                </header>
                
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="scan_location" widget="radio" options="{'horizontal': true}"/>
                        </h1>
                        <div class="o_row">
                            <label for="service_id" string="Service:"/>
                            <field name="service_id" readonly="1"/>
                        </div>
                    </div>
                    
                    <group>
                        <group string="Serial Number Scanning">
                            <field name="serial_number" placeholder="Scan or type serial number..." 
                                   widget="char" attrs="{'required': [('bulk_serial_input', '=', False)]}"/>
                            <button name="action_scan_serial" string="Add Serial Number" type="object" 
                                    class="btn-success" attrs="{'invisible': [('serial_number', '=', False)]}"/>
                        </group>
                        
                        <group string="Scan Progress">
                            <field name="scan_count" readonly="1"/>
                            <field name="scanned_serials" readonly="1" widget="text" 
                                   attrs="{'invisible': [('scan_count', '=', 0)]}"/>
                        </group>
                    </group>
                    
                    <separator string="Bulk Scanning (Optional)"/>
                    <group>
                        <field name="bulk_serial_input" placeholder="Paste multiple serial numbers, one per line..."
                               widget="text" nolabel="1"/>
                        <button name="action_bulk_scan" string="Process Bulk Scan" type="object" 
                                class="btn-warning" attrs="{'invisible': [('bulk_serial_input', '=', False)]}"/>
                    </group>
                    
                    <separator string="Notes"/>
                    <field name="scan_notes" placeholder="Add any notes about this scanning session..." 
                           widget="text" nolabel="1"/>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Hard Drive List View -->
    <record id="view_shredding_hard_drive_tree" model="ir.ui.view">
        <field name="name">shredding.hard_drive.tree</field>
        <field name="model">shredding.hard_drive</field>
        <field name="arch" type="xml">
            <tree string="Hard Drives for Shredding" decoration-success="destroyed" 
                  decoration-warning="verified_before_destruction and not destroyed"
                  decoration-info="scanned_at_customer and not verified_before_destruction">
                <field name="serial_number"/>
                <field name="scanned_at_customer" widget="boolean_toggle"/>
                <field name="scanned_at_customer_date"/>
                <field name="scanned_at_customer_by"/>
                <field name="verified_before_destruction" widget="boolean_toggle"/>
                <field name="verified_at_facility_date"/>
                <field name="verified_at_facility_by"/>
                <field name="destroyed" widget="boolean_toggle"/>
                <field name="destruction_date"/>
                <field name="destruction_method"/>
                <field name="included_in_certificate" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>

    <!-- Hard Drive Form View -->
    <record id="view_shredding_hard_drive_form" model="ir.ui.view">
        <field name="name">shredding.hard_drive.form</field>
        <field name="model">shredding.hard_drive</field>
        <field name="arch" type="xml">
            <form string="Hard Drive Details">
                <header>
                    <button name="action_mark_customer_scanned" string="Mark Customer Scanned" 
                            type="object" class="btn-primary" 
                            attrs="{'invisible': [('scanned_at_customer', '=', True)]}"/>
                    <button name="action_mark_facility_verified" string="Mark Facility Verified" 
                            type="object" class="btn-warning" 
                            attrs="{'invisible': ['|', ('verified_before_destruction', '=', True), ('scanned_at_customer', '=', False)]}"/>
                    <button name="action_mark_destroyed" string="Mark Destroyed" 
                            type="object" class="btn-danger" 
                            attrs="{'invisible': ['|', ('destroyed', '=', True), ('verified_before_destruction', '=', False)]}"/>
                    <field name="destroyed" widget="statusbar" statusbar_visible="false,true"/>
                </header>
                
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="serial_number" placeholder="Serial Number"/>
                        </h1>
                        <div class="o_row">
                            <label for="service_id" string="Service:"/>
                            <field name="service_id"/>
                        </div>
                    </div>
                    
                    <group>
                        <group string="Customer Location Scanning">
                            <field name="scanned_at_customer" widget="boolean_toggle"/>
                            <field name="scanned_at_customer_date" attrs="{'readonly': [('scanned_at_customer', '=', False)]}"/>
                            <field name="scanned_at_customer_by" attrs="{'readonly': [('scanned_at_customer', '=', False)]}"/>
                            <field name="customer_location_notes" attrs="{'readonly': [('scanned_at_customer', '=', False)]}"/>
                        </group>
                        
                        <group string="Facility Verification">
                            <field name="verified_before_destruction" widget="boolean_toggle"/>
                            <field name="verified_at_facility_date" attrs="{'readonly': [('verified_before_destruction', '=', False)]}"/>
                            <field name="verified_at_facility_by" attrs="{'readonly': [('verified_before_destruction', '=', False)]}"/>
                            <field name="facility_verification_notes" attrs="{'readonly': [('verified_before_destruction', '=', False)]}"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Destruction Details">
                            <field name="destruction_method" attrs="{'readonly': [('destroyed', '=', False)]}"/>
                            <field name="destruction_date" attrs="{'readonly': [('destroyed', '=', False)]}"/>
                        </group>
                        
                        <group string="Certificate Information">
                            <field name="included_in_certificate" widget="boolean_toggle"/>
                            <field name="certificate_line_text" readonly="1"/>
                            <field name="hashed_serial" readonly="1" password="True"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Hard Drive Action -->
    <record id="action_shredding_hard_drive" model="ir.actions.act_window">
        <field name="name">Hard Drives</field>
        <field name="res_model">shredding.hard_drive</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a hard drive record for tracking serial numbers through the destruction process.
            </p>
            <p>
                Hard drives are scanned at customer locations, verified at the facility before destruction,
                and tracked for NAID compliance certificates.
            </p>
        </field>
    </record>

    <!-- Scanner Wizard Actions -->
    <record id="action_hard_drive_scan_customer" model="ir.actions.act_window">
        <field name="name">Scan at Customer Location</field>
        <field name="res_model">hard_drive.scan.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_scan_location': 'customer'}</field>
    </record>

    <record id="action_hard_drive_scan_facility" model="ir.actions.act_window">
        <field name="name">Verify at Facility</field>
        <field name="res_model">hard_drive.scan.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_scan_location': 'facility'}</field>
    </record>
</odoo>
