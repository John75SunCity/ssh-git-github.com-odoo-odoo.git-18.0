<?xml version="1.0" encoding="utf-8"?>
<odoo>

<data>
<!-- Enhanced Kanban view for Pickup Routes -->
<record id="pickup_route_view_kanban" model="ir.ui.view">
    <field name="name">pickup.route.view.kanban</field>
    <field name="model">pickup.route</field>
    <field name="type">tree</field>
        <field name="arch" type="xml">
        <kanban default_group_by="state" class="o_kanban_pickup_route">
            <field name="name"/>
            <field name="route_date"/>
            <field name="driver_id"/>
            <field name="vehicle_id"/>
            <field name="state"/>
            <field name="priority"/>
            <field name="estimated_duration"/>
            <field name="actual_duration"/>
            <field name="total_distance"/>
            <field name="completion_percentage"/>
            <field name="efficiency_score"/>
            <field name="request_count"/>
            <field name="fsm_state"/>
            <field name="color"/>
            <templates>
                <t t-name="kanban-box">
                    <div t-attf-class="oe_kanban_card oe_kanban_global_click #{record.color.raw_value ? 'oe_kanban_color_' + record.color.raw_value : ''}">
                        <div class="o_kanban_card_header">
                            <strong>üöö                                <field name="name"/>
                            </strong>
                            <span class="float-end">
                                <field name="priority" widget="priority"/>
                            </span>
                            <div class="text-muted">üë§ <field name="user_id"/>
                            </div>
                        </div>
                        <div class="o_kanban_card_content">
                            <div class="mb-2">
                                <strong>üìÖ Date:</strong>
                                <field name="route_date" widget="date"/>
                                <br/>
                                <strong>üöó Vehicle:</strong>
                                <field name="vehicle_id"/>
                                <br/>
                                <strong>üìç Stops:</strong>
                                <field name="total_stops"/>
                                <br/>
                                <strong>‚è±Ô∏è Est. Duration:</strong>
                                <field name="estimated_duration"/> hrs
                                <br/>
                                <strong>üéØ FSM Status:</strong>
                                <field name="fsm_state" attrs="{'invisible': [('fsm_state', '=', False)]}"/>
                            </div>
                            <div t-if="record.priority.raw_value == 'urgent'">
                                <span class="badge badge-danger">üö® Urgent Route</span>
                            </div>
                            <div t-if="record.state.raw_value == 'completed'">
                                <span class="badge badge-success">‚úÖ Completed</span>
                            </div>
                        </div>
                        <div class="o_kanban_card_footer">
                            <div class="text-muted small">
                                <i class="fa fa-clock-o"/>
 Last updated: <field name="write_date" widget="relative"/>
                            </div>
                        </div>
                    </div>
                </t>
            </templates>
        </kanban>
    </field>
</record>

<!-- Enhanced Tree view for Pickup Routes with FSM Integration -->
    <record id="pickup_route_view_tree" model="ir.ui.view">
        <field name="name">pickup.route.view.tree</field>
        <field name="model">pickup.route</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree decoration-info="state == 'draft'" decoration-warning="state == 'planned'" decoration-success="state == 'completed'" decoration-danger="priority == 'urgent'">
                <field name="name"/>
                <field name="route_date"/>
                <field name="user_id"/>
                <field name="vehicle_id"/>
                <field name="total_stops"/>
                <field name="container_count"/>
                <field name="estimated_duration" widget="float_time"/>
                <field name="actual_duration" widget="float_time"/>
                <field name="completion_percentage" widget="progressbar"/>
                <field name="fsm_state" string="FSM Status"/>
                <field name="state" widget="badge" decoration-info="state == 'draft'" decoration-warning="state == 'planned'" decoration-success="state == 'completed'"/>
                <field name="priority" widget="priority"/>
                <field name="company_id" groups="base.group_multi_company"/>
            </tree>
        </field>
    </record>

<!-- Enhanced Form view for Pickup Routes with FSM Integration -->
    <record id="pickup_route_view_form" model="ir.ui.view">
        <field name="name">pickup.route.view.form</field>
        <field name="model">pickup.route</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <form string="Pickup Route">
<header>
    <button name="action_plan_route" type="object" string="Plan Route" class="btn-primary" attrs="{'invisible': [('state', '!=', 'draft')]}"/>
    <button name="action_start_route" type="object" string="Start Route" class="btn-primary" attrs="{'invisible': [('state', '!=', 'planned')]}"/>
    <button name="action_complete_route" type="object" string="Complete Route" class="btn-success" attrs="{'invisible': [('state', '!=', 'in_progress')]}"/>
    <button name="action_cancel_route" type="object" string="Cancel Route" class="btn-secondary" attrs="{'invisible': [('state', 'in', ['completed', 'cancelled'])]}"/>
    <button name="action_optimize_route" type="object" string="Optimize Route" class="btn-warning" attrs="{'invisible': [('state', 'not in', ['draft', 'planned'])]}"/>
    <field name="state" widget="statusbar" statusbar_visible="draft,planned,in_progress,completed"/>
</header>
                <sheet>
<div class="oe_button_box" name="button_box">
    <button name="action_view_pickup_requests" type="object" class="oe_stat_button" icon="fa-truck">
        <field name="request_count" widget="statbutton" string="Requests"/>
    </button>
    <button name="action_view_fsm_task" type="object" class="oe_stat_button" icon="fa-tasks" attrs="{'invisible': [('fsm_task_id', '=', False)]}">
        <div class="o_field_widget o_stat_info">
            <span class="o_stat_value"><field name="fsm_state"/></span>
            <span class="o_stat_text">FSM Task</span>
        </div>
    </button>
    <button class="oe_stat_button" icon="fa-map-marker">
        <field name="total_stops" widget="statbutton" string="Stops"/>
    </button>
    <button class="oe_stat_button" icon="fa-percent">
        <field name="completion_percentage" widget="statbutton" string="Complete"/>
    </button>
</div>
<widget name="web_ribbon" title="Archived" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>

                    <div class="oe_title">
                        <label for="name"/>
                        <h1>
<field name="name" placeholder="Route Name..."/>
                        </h1>
<div class="o_row">
    <field name="priority" widget="priority"/>
    <label for="fsm_task_id" string="FSM Task:" attrs="{'invisible': [('fsm_task_id', '=', False)]}"/>
    <field name="fsm_task_id" attrs="{'invisible': [('fsm_task_id', '=', False)]}" readonly="1"/>
</div>
</div>
<group>
<group string="Route Information">
    <field name="route_date" required="1"/>
    <field name="user_id" string="Driver/Operator" required="1"/>
    <field name="vehicle_id" required="1"/>
    <field name="supervisor_id"/>
    <field name="planned_start_time"/>
    <field name="planned_end_time"/>
</group>
<group string="FSM Integration &amp; Timing">
    <field name="fsm_project_id" readonly="1" attrs="{'invisible': [('fsm_project_id', '=', False)]}"/>
    <field name="fsm_state" readonly="1" attrs="{'invisible': [('fsm_task_id', '=', False)]}"/>
    <field name="actual_start_time" readonly="1"/>
    <field name="actual_end_time" readonly="1"/>
    <field name="estimated_duration" widget="float_time"/>
    <field name="actual_duration" widget="float_time" readonly="1"/>
</group>
</group>
<notebook>
<page string="Pickup Requests" name="pickup_requests">
    <field name="pickup_request_ids">
        <tree decoration-info="state == 'confirmed'" decoration-success="state == 'completed'" decoration-warning="priority == 'high'">
            <field name="name"/>
            <field name="partner_id"/>
            <field name="pickup_address"/>
            <field name="container_count"/>
            <field name="priority" widget="priority"/>
            <field name="state" widget="badge"/>
        </tree>
    </field>
</page>
<page string="Route Stops" name="route_stops">
    <field name="route_stop_ids">
        <tree editable="bottom">
            <field name="sequence" widget="handle"/>
            <field name="pickup_request_id"/>
            <field name="location"/>
            <field name="distance"/>
            <field name="estimated_arrival"/>
            <field name="actual_arrival"/>
            <field name="status"/>
        </tree>
    </field>
</page>
<page string="Performance &amp; Analytics" name="analytics">
    <group>
        <group string="Route Metrics">
            <field name="total_distance"/>
            <field name="estimated_duration" widget="float_time"/>
            <field name="actual_duration" widget="float_time"/>
            <field name="container_count"/>
            <field name="pickup_count"/>
        </group>
        <group string="Performance Indicators">
            <field name="completion_percentage" widget="progressbar"/>
            <field name="efficiency_score"/>
            <field name="fuel_cost" widget="monetary"/>
            <field name="total_cost" widget="monetary"/>
        </group>
    </group>
    <separator string="Route Notes &amp; Instructions"/>
    <field name="notes" nolabel="1" placeholder="Add route notes, special instructions, or observations..."/>
    <separator string="Special Instructions"/>
    <field name="special_instructions" nolabel="1" placeholder="Add special handling instructions, customer requirements, etc..."/>
</page>
<page string="FSM Integration" name="fsm_integration" attrs="{'invisible': [('fsm_task_id', '=', False)]}">
    <group>
        <group string="FSM Task Details">
            <field name="fsm_task_id" readonly="1"/>
            <field name="fsm_project_id" readonly="1"/>
            <field name="fsm_state" readonly="1"/>
        </group>
        <group string="Task Actions">
            <button name="action_view_fsm_task" type="object" string="Open FSM Task" class="btn-primary" icon="fa-external-link"/>
        </group>
    </group>
    <div class="alert alert-info">
        <p><strong>FSM Integration Benefits:</strong></p>
        <ul>
            <li>üîÑ Automated task creation and synchronization</li>
            <li>üì± Mobile FSM app support for drivers</li>
            <li>üìä Standard Odoo project management workflows</li>
            <li>‚è∞ Advanced scheduling and dependency management</li>
            <li>üìà Performance tracking and analytics</li>
        </ul>
    </div>
</page>
<page string="System Information" name="system_info">
    <group>
        <group string="Record Details">
            <field name="company_id" groups="base.group_multi_company"/>
            <field name="user_id"/>
            <field name="create_date"/>
            <field name="write_date"/>
            <field name="active"/>
        </group>
        <group string="Currency">
            <field name="currency_id"/>
        </group>
    </group>
</page>
</notebook>
                </sheet>
<div class="oe_chatter">
    <field name="message_follower_ids"/>
    <field name="activity_ids"/>
    <field name="message_ids"/>
</div>
            </form>
        </field>
    </record>

<!-- Enhanced Search view for Pickup Routes -->
    <record id="pickup_route_view_search" model="ir.ui.view">
        <field name="name">pickup.route.view.search</field>
        <field name="model">pickup.route</field>
        <field name="type">search</field>
        <field name="arch" type="xml">
            <search>
<field name="name"/>
<field name="user_id"/>
<field name="vehicle_id"/>
<field name="route_date"/>
<field name="fsm_task_id"/>

<!-- State-based filters -->
<filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
<filter string="Planned" name="planned" domain="[('state', '=', 'planned')]"/>
<filter string="In Progress" name="in_progress" domain="[('state', '=', 'in_progress')]"/>
<filter string="Completed" name="completed" domain="[('state', '=', 'completed')]"/>

<separator/>
<!-- Priority and date filters -->
<filter string="Urgent Priority" name="urgent_priority" domain="[('priority', '=', 'urgent')]"/>
<filter string="High Priority" name="high_priority" domain="[('priority', '=', 'high')]"/>
<filter string="Today's Routes" name="today" domain="[('route_date', '=', context_today())]"/>
<filter string="This Week" name="this_week" domain="[('route_date', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d')), ('route_date', '&lt;=', (context_today() + datetime.timedelta(days=6-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
<filter string="Overdue" name="overdue" domain="[('route_date', '&lt;', context_today()), ('state', 'not in', ['completed', 'cancelled'])]"/>

<separator/>
<filter string="Active Routes" name="active" domain="[('active', '=', True)]"/>
<filter string="With FSM Task" name="with_fsm" domain="[('fsm_task_id', '!=', False)]"/>

<separator/>
<filter string="My Routes" name="my_routes" domain="[('user_id', '=', uid)]"/>

<group expand="0" string="Group By">
    <filter string="Driver/Operator" name="user" context="{'group_by': 'user_id'}"/>
    <filter string="Vehicle" name="vehicle" context="{'group_by': 'vehicle_id'}"/>
    <filter string="Status" name="state" context="{'group_by': 'state'}"/>
    <filter string="Priority" name="priority" context="{'group_by': 'priority'}"/>
    <filter string="FSM Status" name="fsm_state" context="{'group_by': 'fsm_state'}"/>
    <filter string="FSM Project" name="fsm_project" context="{'group_by': 'fsm_project_id'}"/>
    <filter string="Company" name="company" context="{'group_by': 'company_id'}" groups="base.group_multi_company"/>
    <separator/>
    <filter string="Route Date" name="route_date" context="{'group_by': 'route_date:day'}"/>
    <filter string="Route Week" name="route_week" context="{'group_by': 'route_date:week'}"/>
    <filter string="Route Month" name="route_month" context="{'group_by': 'route_date:month'}"/>
                </group>
            </search>
        </field>
    </record>

<!-- Enhanced Action for Pickup Routes -->
    <record id="action_pickup_route" model="ir.actions.act_window">
        <field name="name">Pickup Routes</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">pickup.route</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[]</field>
        <field name="context">{
            'default_user_id': uid,
            'search_default_active': 1,
            'search_default_today': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                üöö Create your first Pickup Route!
            </p>
            <p>
                <b>Advanced Pickup Route Management:</b>
                <br/>
                ‚Ä¢ üìç Intelligent route planning and optimization<br/>
                ‚Ä¢ üë®‚Äçüíº Driver and vehicle assignment with capacity tracking<br/>
                ‚Ä¢ ‚è±Ô∏è Real-time tracking and ETA calculations<br/>
                ‚Ä¢ üìä Performance analytics and fuel consumption monitoring<br/>
                ‚Ä¢ üó∫Ô∏è GPS integration with live location updates<br/>
                ‚Ä¢ üìã NAID compliance and audit trail management<br/>
                ‚Ä¢ üì± Mobile-friendly interface for drivers<br/>
                ‚Ä¢ üîî Automated notifications and status updates<br/>
                ‚Ä¢ üìà Customer satisfaction tracking and reporting<br/>
                ‚Ä¢ üöõ Multi-stop route coordination with time optimization
            </p>
        </field>
    </record>
</data>

</odoo>
