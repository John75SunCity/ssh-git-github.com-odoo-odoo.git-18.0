<templates>
    <template id="portal_my_inventory" name="My Inventory">
        <t t-call="portal.portal_layout">
            <div class="container">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2>My Inventory</h2>
                    </div>
                </div>
                
                <!-- Search and Filter -->
                <div class="row mb-4">
                    <div class="col-12">
                        <form class="o_portal_search_panel" t-att-action="request.httprequest.path" method="get">
                            <div class="input-group">
                                <input type="text" name="search" class="form-control" placeholder="Search by serial number or product..." t-att-value="search"/>
                                <select name="filter" class="form-control">
                                    <option value="all" t-att-selected="filter == 'all'">All Items</option>
                                    <option value="available" t-att-selected="filter == 'available'">Available Items</option>
                                    <option value="checkout" t-att-selected="filter == 'checkout'">Checked Out Items</option>
                                    <option value="reserved" t-att-selected="filter == 'reserved'">Reserved Items</option>
                                </select>
                                <div class="input-group-append">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fa fa-search"></i> Search
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Inventory Table -->
                <div class="row">
                    <div class="col-12">
                        <form method="post" action="/my/inventory/request_checkout">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>
                                                <input type="checkbox" id="select-all" class="mr-1"/> Select
                                            </th>
                                            <th>Product</th>
                                            <th>Serial Number</th>
                                            <th>Location</th>
                                            <th>Status</th>
                                            <th>Last Updated</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-if="inventory_items">
                                            <t t-foreach="inventory_items" t-as="item">
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" name="item_ids" t-att-value="item.id" 
                                                               t-att-disabled="item.state != 'available'" class="selectable-item"/>
                                                    </td>
                                                    <td>
                                                        <span t-esc="item.product_id.display_name"/>
                                                    </td>
                                                    <td>
                                                        <a t-att-href="'/my/inventory/detail/%s' % item.id">
                                                            <span t-esc="item.name"/>
                                                        </a>
                                                    </td>
                                                    <td>
                                                        <span t-esc="item.location_id.display_name"/>
                                                    </td>
                                                    <td>
                                                        <span t-att-class="'badge badge-pill badge-%s' % (item.state == 'available' and 'success' or (item.state == 'checkout' and 'danger' or (item.state == 'reserved' and 'warning' or 'secondary')))">
                                                            <t t-esc="item.state.capitalize()"/>
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <span t-esc="item.last_modified"/>
                                                    </td>
                                                </tr>
                                            </t>
                                        </t>
                                        <t t-if="not inventory_items">
                                            <tr>
                                                <td colspan="6" class="text-center">
                                                    <p class="text-muted">No items found</p>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Checkout Options -->
                            <div class="row mt-4 mb-4">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="requested_date">Requested Date</label>
                                        <input type="date" name="requested_date" class="form-control" required="required" t-att-min="today"/>
                                    </div>
                                    <div class="form-group">
                                        <label for="notes">Special Instructions</label>
                                        <textarea name="notes" class="form-control" rows="3"></textarea>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header bg-primary text-white">
                                            <h5 class="mb-0">Checkout Confirmation</h5>
                                        </div>
                                        <div class="card-body">
                                            <p>By requesting checkout, you acknowledge that:</p>
                                            <ul>
                                                <li>You are authorized to access these records</li>
                                                <li>You will maintain confidentiality of the information</li>
                                                <li>You will return the items by the due date</li>
                                            </ul>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" id="confirm_checkout" name="confirm_checkout" required="required"/>
                                                <label class="form-check-label" for="confirm_checkout">I confirm the above statements</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Submit Button -->
                            <div class="text-right">
                                <button id="request_checkout_button" type="submit" class="btn btn-primary" disabled="disabled">
                                    Request Check-Out for Selected Items
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- JavaScript for interaction -->
            <script type="text/javascript">
                $(document).ready(function() {
                    // Select all checkbox
                    $('#select-all').click(function() {
                        $('.selectable-item:not(:disabled)').prop('checked', this.checked);
                        updateCheckoutButton();
                    });
                    
                    // Update button state on individual checkbox change
                    $('.selectable-item').change(function() {
                        updateCheckoutButton();
                    });
                    
                    // Update button state on confirmation checkbox change
                    $('#confirm_checkout').change(function() {
                        updateCheckoutButton();
                    });
                    
                    // Enable/disable checkout button based on selections
                    function updateCheckoutButton() {
                        var itemsSelected = $('.selectable-item:checked').length > 0;
                        var confirmed = $('#confirm_checkout').is(':checked');
                        $('#request_checkout_button').prop('disabled', !(itemsSelected && confirmed));
                    }
                });
            </script>
        </t>
    </template>
</templates>
