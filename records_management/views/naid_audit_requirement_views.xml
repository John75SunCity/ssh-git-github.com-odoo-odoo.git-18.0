<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- NAID Audit Requirements Views -->

    <!-- Tree/List View -->
    <record id="naid_audit_requirement_view_tree" model="ir.ui.view">
        <field name="name">naid.audit.requirement.view.tree</field>
        <field name="model">naid.audit.requirement</field>
        <field name="arch" type="xml">
            <tree decoration-danger="status == 'overdue'" decoration-warning="status == 'scheduled'" decoration-success="status == 'completed'">
                <field name="name"/>
                <field name="audit_type"/>
                <field name="checklist_category"/>
                <field name="frequency_months"/>
                <field name="last_audit_date"/>
                <field name="next_audit_date"/>
                <field name="status"/>
                <field name="compliance_score"/>
                <field name="critical_item"/>
                <field name="active"/>
            </tree>
        </field>
    </record>

    <!-- Form View -->
    <record id="naid_audit_requirement_view_form" model="ir.ui.view">
        <field name="name">naid.audit.requirement.view.form</field>
        <field name="model">naid.audit.requirement</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_schedule_audit" string="Schedule Audit" type="object" class="btn-primary"/>
                    <button name="action_verify_checklist_item" string="Verify Item" type="object" class="btn-secondary"/>
                    <button name="action_view_audit_reports" string="View Reports" type="object" class="btn-info"/>
                    <button name="action_mark_verified" string="Mark Verified" type="object" class="btn-success" attrs="{'invisible': [('status', '=', 'completed')]}"/>
                    <button name="create_default_naid_checklist" string="Create Default Checklist" type="object" class="btn-warning" attrs="{'invisible': [('id', '!=', False)]}"/>
                    <field name="status" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Audit Requirement Name"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Basic Information">
                            <field name="audit_type"/>
                            <field name="checklist_category"/>
                            <field name="frequency_months"/>
                            <field name="critical_item"/>
                            <field name="active"/>
                        </group>
                        <group string="Audit Schedule">
                            <field name="last_audit_date"/>
                            <field name="next_audit_date"/>
                            <field name="days_since_last_audit"/>
                            <field name="compliance_score" widget="progressbar"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Details">
                            <group>
                                <group string="Scope &amp; Requirements">
                                    <field name="scope"/>
                                    <field name="auditor_requirements"/>
                                    <field name="documentation_requirements"/>
                                </group>
                                <group string="Verification">
                                    <field name="requires_signature"/>
                                    <field name="last_verified_by_id"/>
                                    <field name="last_verified_date"/>
                                    <field name="verification_notes"/>
                                </group>
                            </group>
                        </page>
                        <page string="Core App Integrations">
                            <group>
                                <group string="Survey &amp; Quality">
                                    <field name="survey_id"/>
                                    <field name="quality_check_id"/>
                                </group>
                                <group string="Documents &amp; Signatures">
                                    <field name="document_ids" widget="many2many_tags"/>
                                    <field name="sign_template_id"/>
                                </group>
                            </group>
                            <group>
                                <group string="Project Management">
                                    <field name="project_id"/>
                                    <button name="action_create_project_task" string="Create Audit Task" type="object" class="btn-primary"/>
                                </group>
                                <group string="Calendar &amp; Maintenance">
                                    <button name="action_schedule_calendar_event" string="Schedule Calendar Event" type="object" class="btn-info"/>
                                    <button name="action_create_maintenance_request" string="Create Maintenance Request" type="object" class="btn-warning" attrs="{'invisible': [('checklist_category', '!=', 'equipment_maintenance')]}"/>
                                </group>
                            </group>
                        </page>
                        <page string="Audit History">
                            <field name="related_audit_ids">
                                <tree>
                                    <field name="audit_date"/>
                                    <field name="auditor_id"/>
                                    <field name="result"/>
                                    <field name="notes"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Tasks &amp; Events">
                            <group>
                                <group string="Project Tasks">
                                    <field name="task_ids">
                                        <tree>
                                            <field name="name"/>
                                            <field name="user_ids"/>
                                            <field name="date_deadline"/>
                                            <field name="stage_id"/>
                                        </tree>
                                    </field>
                                </group>
                                <group string="Calendar Events">
                                    <field name="calendar_event_ids">
                                        <tree>
                                            <field name="name"/>
                                            <field name="start"/>
                                            <field name="stop"/>
                                            <field name="partner_ids"/>
                                        </tree>
                                    </field>
                                </group>
                            </group>
                        </page>
                        <page string="Signature Requests">
                            <field name="sign_request_ids">
                                <tree>
                                    <field name="reference"/>
                                    <field name="request_item_ids"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="naid_audit_requirement_view_search" model="ir.ui.view">
        <field name="name">naid.audit.requirement.view.search</field>
        <field name="model">naid.audit.requirement</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="audit_type"/>
                <field name="checklist_category"/>
                <field name="status"/>
                <field name="critical_item"/>
                <filter string="Overdue" name="overdue" domain="[('status', '=', 'overdue')]"/>
                <filter string="Scheduled" name="scheduled" domain="[('status', '=', 'scheduled')]"/>
                <filter string="Completed" name="completed" domain="[('status', '=', 'completed')]"/>
                <filter string="Critical Items" name="critical" domain="[('critical_item', '=', True)]"/>
                <filter string="Active" name="active" domain="[('active', '=', True)]"/>
                <group expand="0" string="Group By">
                    <filter string="Audit Type" name="group_audit_type" context="{'group_by': 'audit_type'}"/>
                    <filter string="Category" name="group_category" context="{'group_by': 'checklist_category'}"/>
                    <filter string="Status" name="group_status" context="{'group_by': 'status'}"/>
                    <filter string="Frequency" name="group_frequency" context="{'group_by': 'frequency_months'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Kanban View -->
    <record id="naid_audit_requirement_view_kanban" model="ir.ui.view">
        <field name="name">naid.audit.requirement.view.kanban</field>
        <field name="model">naid.audit.requirement</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="name"/>
                <field name="audit_type"/>
                <field name="status"/>
                <field name="next_audit_date"/>
                <field name="compliance_score"/>
                <field name="critical_item"/>
                <templates>
<t t-name="card">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click {{ record.critical_item.raw_value and 'oe_kanban_card_danger' or '' }}">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        <field name="name"/>
                                    </strong>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <span class="badge" t-attf-class="badge-{{ record.status.raw_value == 'overdue' and 'danger' or record.status.raw_value == 'scheduled' and 'warning' or 'success' }}">
                                                <field name="status"/>
                                            </span>
                                            <field name="audit_type"/>
                                        </div>
                                        <div class="oe_kanban_bottom_right">
                                            <field name="next_audit_date"/>
                                            <div class="progress" style="width: 60px; height: 8px;">
                                                <div t-attf-class="progress-bar bg-{{ record.compliance_score.raw_value >= 80 and 'success' or record.compliance_score.raw_value >= 60 and 'warning' or 'danger' }}"
                                                     t-attf-style="width: {{ record.compliance_score.raw_value }}%">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Action -->
    <record id="naid_audit_requirement_action" model="ir.actions.act_window">
        <field name="name">NAID Audit Requirements</field>
        <field name="res_model">naid.audit.requirement</field>
        <field name="view_mode">tree,kanban,form,pivot,graph</field>
        <field name="search_view_id" ref="naid_audit_requirement_view_search"/>
        <field name="help">Manage NAID AAA audit requirements and compliance checklists</field>
    </record>

    <!-- Action to create default NAID checklist -->
    <record id="action_create_default_naid_checklist" model="ir.actions.act_window">
        <field name="name">Create Default NAID Checklist</field>
        <field name="res_model">naid.audit.requirement</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_action': 'create_default'}</field>
        <field name="help">Create the complete NAID AAA audit checklist with all required items</field>
    </record>

    <!-- Menu -->
    <menuitem id="naid_audit_menu" name="NAID Audits" parent="records_management.menu_records_root" sequence="30"/>
    <menuitem id="naid_audit_requirement_menu" name="Audit Requirements" parent="naid_audit_menu" action="naid_audit_requirement_action" sequence="10"/>
    <menuitem id="naid_create_checklist_menu" name="Create Default Checklist" parent="naid_audit_menu" action="action_create_default_naid_checklist" sequence="5"/>

</odoo>
