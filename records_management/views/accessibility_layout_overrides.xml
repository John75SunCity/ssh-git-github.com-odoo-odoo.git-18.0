<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Accessibility & Standards Compliance Overrides (Backend webclient)
             - Adds lang attribute to <html>
             - Normalizes viewport to allow user scaling (removes user-scalable=no)
             - Removes obsolete X-UA-Compatible meta if present
             - Standardizes theme-color meta for modern browsers
        -->
    <template id="records_management_accessibility_layout" name="Records Management Accessibility Overrides" inherit_id="web.layout">
            <!-- Dynamic lang attribute: derive from context lang, fallback en-US -->
            <xpath expr="/t/html" position="attributes">
                <attribute name="t-att-lang">(env.context.get('lang') or 'en_US').replace('_','-')</attribute>
            </xpath>
            <!-- Insert accessibility / modern meta tags idempotently.
                 Using head insertion instead of replace so absence of elements does not cause ParseError.
                 Potential duplicates are acceptable; browsers use the first. For stricter uniqueness,
                 a future enhancement could search and remove via server-side cleanup script. -->
          <!-- NOTE: Previous versions attempted to remove obsolete or restrictive meta tags via
              xpath position="replace" expressions targeting nodes that might not exist.
              This caused ParseError on databases where those metas were already absent.
              We now skip explicit removals to maintain load safety across environments.
              If legacy metas exist, future cleanup can be done via server-side scripts. -->
            <!-- Ensure a single standards-compliant viewport meta exists (idempotent) -->
            <xpath expr="//head" position="inside">
                <meta name="viewport" content="width=device-width, initial-scale=1"/>
            </xpath>
            <!-- Theme color: keep first if core defines one; otherwise inject unified branding color -->
            <xpath expr="//head" position="inside">
                <!-- Dynamic theme color: pull from configurator (rm_theme_color) with fallback to Odoo default purple (#875A7B) -->
                <t t-set="_rm_theme_color" t-value="(env['rm.module.configurator'].sudo().get_config_parameter('rm_theme_color') or '#875A7B')"/>
                <meta name="theme-color" t-att-content="_rm_theme_color"/>
                <meta name="color-scheme" content="light dark"/>
            </xpath>
        </template>

        <!-- Portal frontend layout inheritance (if portal installed) -->
        <template id="records_management_portal_accessibility_layout" name="Records Management Portal Accessibility Overrides" inherit_id="portal.frontend_layout">
            <xpath expr="/t/html" position="attributes">
                <attribute name="t-att-lang">(env.context.get('lang') or 'en_US').replace('_','-')</attribute>
            </xpath>
            <!-- Safe: no direct removals (avoid ParseError if elements absent) -->
            <xpath expr="//head" position="inside">
                <meta name="viewport" content="width=device-width, initial-scale=1"/>
            </xpath>
            <xpath expr="//head" position="inside">
                <t t-set="_rm_theme_color" t-value="(env['rm.module.configurator'].sudo().get_config_parameter('rm_theme_color') or '#875A7B')"/>
                <meta name="theme-color" t-att-content="_rm_theme_color"/>
                <meta name="color-scheme" content="light dark"/>
            </xpath>
        </template>
    </data>
</odoo>
