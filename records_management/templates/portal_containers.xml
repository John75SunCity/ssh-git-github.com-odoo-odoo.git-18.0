<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <!-- Portal Container Form Template -->
        <template id="portal_container_form" name="Create Container">
            <t t-call="portal.portal_layout">
                <t t-set="title">Create New Container</t>

                <div class="o_portal_container_form">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h3 class="mb-0">
                                <i class="fa fa-plus-circle"></i>
                                Create New Container
                            </h3>
                        </div>
                        <div class="card-body">
                            <form method="POST" action="/my/containers/create">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                                <div class="form-group">
                                    <label for="container_type_id">Container Type *</label>
                                    <select name="container_type_id" id="container_type_id" class="form-control" required="required">
                                        <option value="">Select Container Type...</option>
                                        <t t-foreach="container_types" t-as="ctype">
                                            <option t-att-value="ctype.id" t-esc="ctype.name"/>
                                        </t>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="location_id">Initial Location *</label>
                                    <select name="location_id" id="location_id" class="form-control" required="required">
                                        <option value="">Select Location...</option>
                                        <t t-foreach="locations" t-as="location">
                                            <option t-att-value="location.id" t-esc="location.complete_name"/>
                                        </t>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="department_id">Department</label>
                                    <select name="department_id" id="department_id" class="form-control">
                                        <option value="">Select Department...</option>
                                        <t t-foreach="departments" t-as="dept">
                                            <option t-att-value="dept.id" t-esc="dept.name"/>
                                        </t>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="description">Description</label>
                                    <textarea name="description" id="description" class="form-control" rows="3" placeholder="Optional description of container contents or purpose"></textarea>
                                </div>

                                <div class="form-group">
                                    <div class="form-check">
                                        <input type="checkbox" name="generate_barcode" id="generate_barcode" class="form-check-input" checked="checked"/>
                                        <label for="generate_barcode" class="form-check-label">
                                            Generate barcode automatically
                                        </label>
                                    </div>
                                    <small class="form-text text-muted">
                                        If unchecked, you can enter a custom barcode below.
                                    </small>
                                </div>

                                <div class="form-group" id="custom_barcode_group" style="display: none;">
                                    <label for="custom_barcode">Custom Barcode</label>
                                    <input type="text" name="custom_barcode" id="custom_barcode" class="form-control" placeholder="Enter custom barcode"/>
                                </div>

                                <div class="form-group">
                                    <button type="submit" class="btn btn-success btn-lg">
                                        <i class="fa fa-plus-circle"></i> Create Container
                                    </button>
                                    <a href="/my/containers" class="btn btn-secondary btn-lg">
                                        <i class="fa fa-times"></i> Cancel
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>

                    <script>
                        // Toggle custom barcode field
                        document.getElementById('generate_barcode').addEventListener('change', function() {
                            var customGroup = document.getElementById('custom_barcode_group');
                            if (this.checked) {
                                customGroup.style.display = 'none';
                                document.getElementById('custom_barcode').required = false;
                            } else {
                                customGroup.style.display = 'block';
                                document.getElementById('custom_barcode').required = true;
                            }
                        });
                    </script>
                </div>
            </t>
        </template>

        <!-- Container Detail Template -->
        <template id="container_detail" name="Container Detail">
            <t t-call="portal.portal_layout">
                <t t-set="title">Container Details</t>

                <div class="o_portal_container_detail">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h3 class="mb-0">
                                <i class="fa fa-box"></i>
                                Container: <span t-esc="container.name"/>
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <dl class="row">
                                        <dt class="col-sm-4">Barcode:</dt>
                                        <dd class="col-sm-8" t-esc="container.barcode or 'N/A'"/>

                                        <dt class="col-sm-4">Type:</dt>
                                        <dd class="col-sm-8" t-esc="container.container_type_id.name if container.container_type_id else 'N/A'"/>

                                        <dt class="col-sm-4">Location:</dt>
                                        <dd class="col-sm-8" t-esc="container.location_id.name if container.location_id else 'N/A'"/>

                                        <dt class="col-sm-4">Status:</dt>
                                        <dd class="col-sm-8">
                                            <span t-if="container.state == 'active'" class="badge badge-success">Active</span>
                                            <span t-if="container.state == 'archived'" class="badge badge-warning">Archived</span>
                                            <span t-if="container.state == 'destroyed'" class="badge badge-danger">Destroyed</span>
                                        </dd>
                                    </dl>
                                </div>
                                <div class="col-md-6">
                                    <h5>Description</h5>
                                    <p t-esc="container.description or 'No description available'"/>
                                </div>
                            </div>

                            <div class="mt-3">
                                <a href="/my/containers" class="btn btn-secondary">
                                    <i class="fa fa-arrow-left"></i> Back to Containers
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>
    </data>
</odoo>
