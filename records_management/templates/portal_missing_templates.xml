<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- ================================================================== -->
        <!-- CRITICAL PRIORITY TEMPLATES (Grok-Enhanced UI/UX)                 -->
        <!-- ================================================================== -->
        
        <!-- 1. INVENTORY CONTAINERS LIST -->
        <template id="portal_inventory_containers_list" name="Portal - Inventory Containers">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'inventory_containers'"/>
                
                <div class="container mt-4 o_portal_inventory">
                    <div class="page-header d-flex justify-content-between align-items-center">
                        <h1><i class="fa fa-box"></i> Inventory - Containers</h1>
                        <div class="actions">
                            <a href="/my/request/new/retrieval" class="btn btn-primary">
                                <i class="fa fa-plus"></i> New Request
                            </a>
                            <button class="btn btn-secondary btn-export" data-format="xlsx">
                                <i class="fa fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filter Bar -->
                    <div class="filter-bar">
                        <form method="get">
                            <div class="row">
                                <div class="col-md-3">
                                    <input type="text" name="search" class="form-control search-input" 
                                           placeholder="Search..." t-att-value="search or ''"/>
                                </div>
                                <div class="col-md-3">
                                    <select name="status" class="form-select">
                                        <option value="">All Status</option>
                                        <option value="stored">Stored</option>
                                        <option value="retrieved">Retrieved</option>
                                        <option value="pending">Pending</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <input type="date" name="date_from" class="form-control"/>
                                </div>
                                <div class="col-md-2">
                                    <input type="date" name="date_to" class="form-control"/>
                                </div>
                                <div class="col-md-2">
                                    <button type="submit" class="btn btn-purple w-100">
                                        <i class="fa fa-filter"></i> Filter
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Table -->
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Container ID</th>
                                    <th>Status</th>
                                    <th>Location</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-if="containers">
                                    <t t-foreach="containers" t-as="container">
                                        <tr>
                                            <td><strong t-esc="container.name"/></td>
                                            <td>
                                                <span t-att-class="'badge bg-' + ('success' if container.state == 'in' else 'warning' if container.state == 'pending' else 'info' if container.state == 'out' else 'secondary' if container.state == 'perm_out' else 'danger')">
                                                    <t t-esc="container.state_display or 'Pending'"/>
                                                </span>
                                            </td>
                                            <td t-esc="container.location_id.name if container.location_id else '-'"/>
                                            <td><t t-esc="container.create_date.strftime('%Y-%m-%d') if container.create_date else '-'"/></td>
                                            <td>
                                                <a t-attf-href="/my/inventory/container/{{container.id}}" 
                                                   class="btn btn-sm btn-info">
                                                    <i class="fa fa-eye"></i> View
                                                </a>
                                            </td>
                                        </tr>
                                    </t>
                                </t>
                                <t t-else="">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted py-4">
                                            <i class="fa fa-inbox fa-3x mb-3"></i>
                                            <p>No containers found</p>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                    
                    <t t-if="pager">
                        <t t-call="portal.pager"/>
                    </t>
                    
                    <div class="spinner-border text-purple d-none" id="loading"></div>
                </div>
            </t>
        </template>

        <!-- 2. INVENTORY FILES LIST -->
        <template id="portal_inventory_files_list" name="Portal - Inventory Files">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'inventory_files'"/>
                
                <div class="container mt-4 o_portal_inventory">
                    <div class="page-header d-flex justify-content-between align-items-center">
                        <h1><i class="fa fa-folder"></i> Inventory - File Folders</h1>
                        <div class="actions">
                            <button class="btn btn-secondary btn-export">
                                <i class="fa fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search Bar -->
                    <div class="filter-bar">
                        <form method="get">
                            <div class="row">
                                <div class="col-md-10">
                                    <input type="text" name="search" class="form-control search-input" 
                                           placeholder="Search file folders..." t-att-value="search or ''"/>
                                </div>
                                <div class="col-md-2">
                                    <button type="submit" class="btn btn-purple w-100">
                                        <i class="fa fa-search"></i> Search
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>File ID</th>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Container</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-if="files">
                                    <t t-foreach="files" t-as="file">
                                        <tr>
                                            <td t-esc="file.name"/>
                                            <td t-esc="file.description or '-'"/>
                                            <td t-esc="file.file_type_id.name if file.file_type_id else '-'"/>
                                            <td t-esc="file.container_id.name if file.container_id else '-'"/>
                                            <td>
                                                <a t-attf-href="/my/inventory/file/{{file.id}}" class="btn btn-sm btn-info">
                                                    <i class="fa fa-eye"></i> View
                                                </a>
                                            </td>
                                        </tr>
                                    </t>
                                </t>
                                <t t-else="">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted py-4">
                                            <i class="fa fa-folder-open fa-3x mb-3"></i>
                                            <p>No files found</p>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                    
                    <t t-if="pager">
                        <t t-call="portal.pager"/>
                    </t>
                </div>
            </t>
        </template>

        <!-- 3. INVENTORY DOCUMENTS LIST -->
        <template id="portal_inventory_documents_list" name="Portal - Inventory Documents">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'inventory_documents'"/>
                
                <div class="container mt-4 o_portal_inventory">
                    <div class="page-header d-flex justify-content-between align-items-center">
                        <h1><i class="fa fa-file-alt"></i> Inventory - Physical Documents</h1>
                        <div class="actions">
                            <button class="btn btn-secondary btn-export">
                                <i class="fa fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filter Bar with Type Filter -->
                    <div class="filter-bar">
                        <form method="get">
                            <div class="row">
                                <div class="col-md-6">
                                    <input type="text" name="search" class="form-control search-input" 
                                           placeholder="Search documents..."/>
                                </div>
                                <div class="col-md-4">
                                    <select name="doc_type" class="form-select">
                                        <option value="">All Types</option>
                                        <t t-if="document_types">
                                            <t t-foreach="document_types" t-as="dtype">
                                                <option t-att-value="dtype.id" t-esc="dtype.name"/>
                                            </t>
                                        </t>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button type="submit" class="btn btn-purple w-100">
                                        <i class="fa fa-filter"></i> Filter
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Document ID</th>
                                    <th>Type</th>
                                    <th>Container</th>
                                    <th>Date Added</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-if="documents">
                                    <t t-foreach="documents" t-as="doc">
                                        <tr>
                                            <td t-esc="doc.name"/>
                                            <td t-esc="doc.document_type_id.name if doc.document_type_id else '-'"/>
                                            <td t-esc="doc.container_id.name if doc.container_id else '-'"/>
                                            <td><t t-esc="doc.create_date.strftime('%Y-%m-%d') if doc.create_date else '-'"/></td>
                                            <td>
                                                <a t-attf-href="/my/inventory/document/{{doc.id}}" 
                                                   class="btn btn-sm btn-info">
                                                    <i class="fa fa-eye"></i> View
                                                </a>
                                            </td>
                                        </tr>
                                    </t>
                                </t>
                                <t t-else="">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted py-4">
                                            <i class="fa fa-file fa-3x mb-3"></i>
                                            <p>No documents found</p>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                    
                    <t t-if="pager">
                        <t t-call="portal.pager"/>
                    </t>
                </div>
            </t>
        </template>

        <!-- 4. INVENTORY LOCATIONS BROWSER -->
        <template id="portal_inventory_locations_list" name="Portal - Storage Locations">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'inventory_locations'"/>
                
                <div class="container mt-4">
                    <div class="page-header d-flex justify-content-between align-items-center">
                        <h1><i class="fa fa-map-marker-alt"></i> Storage Locations</h1>
                    </div>
                    
                    <div class="row">
                        <t t-if="locations">
                            <t t-foreach="locations" t-as="location">
                                <div class="col-md-4 mb-4">
                                    <div class="card h-100">
                                        <div class="card-header bg-primary text-white">
                                            <h5 class="mb-0">
                                                <i class="fa fa-warehouse"></i>
                                                <t t-esc="location.name"/>
                                            </h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="mb-3">
                                                <strong>Capacity:</strong>
                                                <div class="progress mt-2">
                                                    <div class="progress-bar" role="progressbar" 
                                                         t-att-style="'width: ' + str(location.capacity_percentage or 0) + '%'"
                                                         t-att-aria-valuenow="location.capacity_percentage or 0">
                                                        <t t-esc="location.capacity_percentage or 0"/>%
                                                    </div>
                                                </div>
                                            </div>
                                            <p class="mb-2">
                                                <strong>Containers:</strong> 
                                                <t t-esc="location.container_count or 0"/>
                                            </p>
                                            <p class="mb-0">
                                                <strong>Type:</strong> 
                                                <t t-esc="location.location_type or 'Standard'"/>
                                            </p>
                                        </div>
                                        <div class="card-footer">
                                            <a t-attf-href="/my/inventory/location/{{location.id}}" 
                                               class="btn btn-sm btn-primary w-100">
                                                <i class="fa fa-eye"></i> View Details
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </t>
                        <t t-else="">
                            <div class="col-12">
                                <div class="alert alert-info text-center">
                                    <i class="fa fa-info-circle fa-3x mb-3"></i>
                                    <p>No locations available</p>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </t>
        </template>

        <!-- 5. INVENTORY MOVEMENTS TIMELINE -->
        <template id="portal_inventory_movements_list" name="Portal - Inventory Movements">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'inventory_movements'"/>
                
                <div class="container mt-4">
                    <div class="page-header">
                        <h1><i class="fa fa-exchange-alt"></i> Inventory Movements History</h1>
                    </div>
                    
                    <!-- Timeline View -->
                    <div class="timeline">
                        <t t-if="movements">
                            <t t-foreach="movements" t-as="movement">
                                <div class="timeline-item mb-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <h5 class="card-title">
                                                        <i class="fa fa-arrow-right text-primary"></i>
                                                        <t t-esc="movement.name"/>
                                                    </h5>
                                                    <p class="mb-1">
                                                        <strong>From:</strong> <t t-esc="movement.location_id.name if movement.location_id else 'N/A'"/>
                                                        <i class="fa fa-long-arrow-alt-right mx-2"></i>
                                                        <strong>To:</strong> <t t-esc="movement.location_dest_id.name if movement.location_dest_id else 'N/A'"/>
                                                    </p>
                                                    <p class="mb-0 text-muted">
                                                        <small>
                                                            <i class="fa fa-clock"></i>
                                                            <t t-esc="movement.create_date.strftime('%Y-%m-%d %H:%M') if movement.create_date else '-'"/>
                                                        </small>
                                                    </p>
                                                </div>
                                                <div>
                                                    <span t-att-class="'badge bg-' + ('success' if movement.state == 'done' else 'warning')">
                                                        <t t-esc="movement.state"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </t>
                        <t t-else="">
                            <div class="alert alert-info text-center">
                                <i class="fa fa-history fa-3x mb-3"></i>
                                <p>No movement history found</p>
                            </div>
                        </t>
                    </div>
                    
                    <t t-if="pager">
                        <t t-call="portal.pager"/>
                    </t>
                </div>
            </t>
        </template>

        <!-- 6. DESTRUCTION REQUESTS WITH APPROVAL WORKFLOW -->
        <template id="portal_destruction_requests" name="Portal - Destruction Requests">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'destruction'"/>
                
                <div class="container mt-4">
                    <div class="page-header d-flex justify-content-between align-items-center">
                        <h1><i class="fa fa-fire"></i> Destruction Requests</h1>
                        <div class="actions">
                            <a href="/my/request/new/destruction" class="btn btn-danger">
                                <i class="fa fa-plus"></i> New Destruction Request
                            </a>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Request #</th>
                                    <th>Date Requested</th>
                                    <th>Items</th>
                                    <th>Status</th>
                                    <th>Certificate</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-if="destruction_requests">
                                    <t t-foreach="destruction_requests" t-as="req">
                                        <tr>
                                            <td><strong t-esc="req.name"/></td>
                                            <td><t t-esc="req.create_date.strftime('%Y-%m-%d') if req.create_date else '-'"/></td>
                                            <td>
                                                <t t-if="req.container_ids">
                                                    <t t-esc="len(req.container_ids)"/> container(s)
                                                </t>
                                                <t t-else="">0 items</t>
                                            </td>
                                            <td>
                                                <span t-att-class="'badge bg-' + ('success' if req.state == 'done' else 'warning' if req.state == 'pending' else 'secondary')">
                                                    <t t-esc="req.state"/>
                                                </span>
                                            </td>
                                            <td>
                                                <t t-if="req.certificate_id">
                                                    <a t-attf-href="/my/certificate/{{req.certificate_id.id}}" 
                                                       class="btn btn-sm btn-success">
                                                        <i class="fa fa-certificate"></i> View
                                                    </a>
                                                </t>
                                                <t t-else="">
                                                    <span class="text-muted">Pending</span>
                                                </t>
                                            </td>
                                            <td>
                                                <a t-attf-href="/my/destruction/{{req.id}}" class="btn btn-sm btn-info">
                                                    <i class="fa fa-eye"></i> Details
                                                </a>
                                            </td>
                                        </tr>
                                    </t>
                                </t>
                                <t t-else="">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted py-4">
                                            <i class="fa fa-inbox fa-3x mb-3"></i>
                                            <p>No destruction requests</p>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>
            </t>
        </template>

        <!-- 7. BILLING RATES DISPLAY -->
        <template id="portal_billing_rates" name="Portal - Service Rates">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'billing_rates'"/>
                
                <div class="container mt-4">
                    <div class="page-header">
                        <h1><i class="fa fa-dollar-sign"></i> Service Rates &amp; Pricing</h1>
                    </div>
                    
                    <!-- Standard Rates Section -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h4><i class="fa fa-list me-2"/>Standard Rates</h4>
                        </div>
                        <t t-if="rates">
                            <t t-foreach="rates" t-as="rate">
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <div class="card-header bg-primary text-white">
                                            <h5 class="mb-0" t-esc="rate.name"/>
                                        </div>
                                        <div class="card-body">
                                            <h3 class="text-primary mb-3">
                                                <t t-esc="rate.rate" t-options="{'widget': 'monetary', 'display_currency': rate.currency_id}"/>
                                                <small class="text-muted">/ <t t-esc="rate.billing_unit or 'unit'"/></small>
                                            </h3>
                                            <p t-if="rate.description" t-esc="rate.description"/>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </t>
                        <t t-else="">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <i class="fa fa-info-circle me-2"/>Contact us for current service rates.
                                </div>
                            </div>
                        </t>
                    </div>

                    <!-- Customer Negotiated Rates Section -->
                    <t t-if="negotiated_rates">
                        <div class="row">
                            <div class="col-12">
                                <h4><i class="fa fa-handshake me-2"/>Your Negotiated Rates</h4>
                            </div>
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Service Type</th>
                                                    <th>Rate</th>
                                                    <th>Effective Date</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="negotiated_rates" t-as="neg_rate">
                                                    <tr>
                                                        <td><t t-esc="neg_rate.name"/></td>
                                                        <td>
                                                            <t t-esc="neg_rate.rate" t-options="{'widget': 'monetary', 'display_currency': neg_rate.currency_id}"/>
                                                        </td>
                                                        <td>
                                                            <t t-if="neg_rate.date_start" t-esc="neg_rate.date_start" t-options="{'widget': 'date'}"/>
                                                        </td>
                                                        <td>
                                                            <span t-att-class="'badge ' + ('bg-success' if neg_rate.active else 'bg-secondary')">
                                                                <t t-esc="'Active' if neg_rate.active else 'Inactive'"/>
                                                            </span>
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </t>
        </template>

        <!-- 8. REPORTS DASHBOARD -->
        <template id="portal_reports_dashboard" name="Portal - Reports Dashboard">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'reports'"/>
                
                <div class="container mt-4">
                    <div class="page-header">
                        <h1><i class="fa fa-chart-bar"></i> Inventory Reports</h1>
                    </div>
                    
                    <div class="row">
                        <!-- Container Summary Report -->
                        <div class="col-md-4 mb-4">
                            <div class="card dashboard-widget">
                                <div class="card-body text-center">
                                    <i class="fa fa-box fa-3x text-primary mb-3"></i>
                                    <h5>Container Summary</h5>
                                    <p class="text-muted">Complete overview of all containers</p>
                                    <a href="/records/reports/container-summary" class="btn btn-primary mt-2">
                                        <i class="fa fa-file-pdf"></i> Generate Report
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Activity Report -->
                        <div class="col-md-4 mb-4">
                            <div class="card dashboard-widget">
                                <div class="card-body text-center">
                                    <i class="fa fa-chart-line fa-3x text-success mb-3"></i>
                                    <h5>Activity Report</h5>
                                    <p class="text-muted">Movement and retrieval history</p>
                                    <a href="/my/reports/activity" class="btn btn-success mt-2">
                                        <i class="fa fa-file-excel"></i> Generate Report
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Compliance Report -->
                        <div class="col-md-4 mb-4">
                            <div class="card dashboard-widget">
                                <div class="card-body text-center">
                                    <i class="fa fa-shield-alt fa-3x text-warning mb-3"></i>
                                    <h5>Compliance Report</h5>
                                    <p class="text-muted">NAID AAA certification status</p>
                                    <a href="/my/reports/compliance" class="btn btn-warning mt-2">
                                        <i class="fa fa-file-pdf"></i> Generate Report
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Data Export -->
                        <div class="col-md-4 mb-4">
                            <div class="card dashboard-widget">
                                <div class="card-body text-center">
                                    <i class="fa fa-download fa-3x text-info mb-3"></i>
                                    <h5>Data Export</h5>
                                    <p class="text-muted">Export inventory to Excel/CSV</p>
                                    <a href="/my/reports/export" class="btn btn-info mt-2">
                                        <i class="fa fa-download"></i> Export Data
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <!-- ================================================================== -->
        <!-- SERVICE REQUEST TEMPLATES (Original, keeping for compatibility)   -->
        <!-- ================================================================== -->
        
        <template id="portal_request_form" name="Service Request Form">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'request_create'"/>
                
                <div class="container my-5">
                    <div class="row">
                        <div class="col-lg-8 mx-auto">
                            <div class="card shadow">
                                <div class="card-header bg-primary text-white">
                                    <h3 class="mb-0">
                                        <i t-att-class="'fa ' + config['icon'] + ' me-2'"/>
                                        <t t-esc="config['title']"/>
                                    </h3>
                                    <p class="mb-0 mt-2 text-white-50">
                                        <t t-esc="config['description']"/>
                                    </p>
                                </div>
                                <div class="card-body">
                                    <form method="POST" t-attf-action="/my/request/submit/#{request_type}">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                        
                                        <!-- Container Selection -->
                                        <div class="mb-3" t-if="'container_ids' in config['form_fields']">
                                            <label class="form-label fw-bold">Select Containers</label>
                                            <select name="container_ids" class="form-select" multiple="multiple">
                                                <t t-foreach="containers" t-as="container">
                                                    <option t-att-value="container.id">
                                                        <t t-esc="container.name"/> - <t t-esc="container.location_id.name"/>
                                                    </option>
                                                </t>
                                            </select>
                                        </div>
                                        
                                        <!-- Special Instructions -->
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Special Instructions</label>
                                            <textarea name="special_instructions" class="form-control" rows="4" 
                                                      placeholder="Add any special instructions or requirements..."/>
                                        </div>
                                        
                                        <div class="d-flex justify-content-between">
                                            <a href="/my/requests" class="btn btn-secondary">
                                                <i class="fa fa-arrow-left me-2"/>Cancel
                                            </a>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fa fa-check me-2"/>Submit Request
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>
        
        <!-- ================================================================== -->
        <!-- DESTRUCTION MANAGEMENT TEMPLATES                                   -->
        <!-- ================================================================== -->
        
        <template id="portal_destruction_list" name="Destruction Requests List">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'destruction'"/>
                
                <div class="container my-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fa fa-fire me-2"/>Destruction Requests</h2>
                        <a href="/my/request/new/destruction" class="btn btn-primary">
                            <i class="fa fa-plus me-2"/>New Request
                        </a>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Request #</th>
                                    <th>Date</th>
                                    <th>Items</th>
                                    <th>Status</th>
                                    <th>Certificate</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="requests" t-as="req">
                                    <tr>
                                        <td><t t-esc="req.name"/></td>
                                        <td><t t-esc="req.create_date" t-options="{'widget': 'date'}"/></td>
                                        <td><t t-esc="len(req.container_ids)"/> containers</td>
                                        <td>
                                            <span t-att-class="'badge bg-' + ('success' if req.state == 'done' else 'warning')">
                                                <t t-esc="req.state"/>
                                            </span>
                                        </td>
                                        <td>
                                            <a t-if="req.certificate_id" 
                                               t-attf-href="/my/certificate/#{req.certificate_id.id}/download"
                                               class="btn btn-sm btn-outline-primary">
                                                <i class="fa fa-download"/>
                                            </a>
                                        </td>
                                        <td>
                                            <a t-attf-href="/my/requests/#{req.id}" class="btn btn-sm btn-info">
                                                View
                                            </a>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>
            </t>
        </template>
        
        <template id="portal_destruction_pending" name="Pending Destruction Approvals">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'destruction'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-clock-o me-2"/>Pending Approvals</h2>
                    
                    <div class="alert alert-info">
                        <i class="fa fa-info-circle me-2"/>
                        These requests require approval before destruction can proceed.
                    </div>
                    
                    <div class="row">
                        <t t-foreach="requests" t-as="req">
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-header bg-warning text-dark">
                                        <strong><t t-esc="req.name"/></strong>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>Submitted:</strong> <t t-esc="req.create_date" t-options="{'widget': 'date'}"/></p>
                                        <p><strong>Containers:</strong> <t t-esc="len(req.container_ids)"/></p>
                                        <a t-attf-href="/my/requests/#{req.id}" class="btn btn-primary btn-sm">
                                            View Details
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </t>
        </template>
        
        <template id="portal_custody_chain" name="Chain of Custody">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'custody'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-link me-2"/>Chain of Custody Tracking</h2>
                    
                    <div class="timeline">
                        <t t-foreach="custody_records" t-as="record">
                            <div class="timeline-item mb-4">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h5><t t-esc="record.container_id.name"/></h5>
                                                <p class="mb-0">
                                                    <strong>From:</strong> <t t-esc="record.from_custodian_id.name"/> â†’
                                                    <strong>To:</strong> <t t-esc="record.to_custodian_id.name"/>
                                                </p>
                                            </div>
                                            <div class="text-end">
                                                <small class="text-muted">
                                                    <t t-esc="record.transfer_date" t-options="{'widget': 'datetime'}"/>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </t>
        </template>
        
        <!-- ================================================================== -->
        <!-- BILLING TEMPLATES                                                  -->
        <!-- ================================================================== -->
        
        <template id="portal_invoice_history" name="Invoice Payment History">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'invoices'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-history me-2"/>Payment History</h2>
                    
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Paid Date</th>
                                    <th>Download</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="invoices" t-as="invoice">
                                    <tr>
                                        <td><t t-esc="invoice.name"/></td>
                                        <td><t t-esc="invoice.invoice_date" t-options="{'widget': 'date'}"/></td>
                                        <td><t t-esc="invoice.amount_total" t-options="{'widget': 'monetary', 'display_currency': invoice.currency_id}"/></td>
                                        <td><t t-esc="invoice.invoice_date_due" t-options="{'widget': 'date'}"/></td>
                                        <td>
                                            <a t-attf-href="/my/invoices/#{invoice.id}/download" class="btn btn-sm btn-primary">
                                                <i class="fa fa-download"/>
                                            </a>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>
            </t>
        </template>
        
        <!-- NOTE: portal_billing_rates template moved above (consolidated) -->
        
        <template id="portal_billing_statements" name="Billing Statements">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'billing'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-download me-2"/>Download Statements</h2>
                    
                    <div class="list-group">
                        <t t-foreach="statements" t-as="statement">
                            <a t-attf-href="/my/invoices/#{statement.id}/download" 
                               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1"><t t-esc="statement.name"/></h5>
                                    <small><t t-esc="statement.invoice_date" t-options="{'widget': 'date'}"/></small>
                                </div>
                                <span class="badge bg-primary rounded-pill">
                                    <t t-esc="statement.amount_total" t-options="{'widget': 'monetary', 'display_currency': statement.currency_id}"/>
                                </span>
                            </a>
                        </t>
                    </div>
                </div>
            </t>
        </template>
        
        <!-- ================================================================== -->
        <!-- REPORTS TEMPLATES                                                  -->
        <!-- ================================================================== -->
        
        <template id="portal_reports_inventory" name="Inventory Reports">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'reports'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-chart-bar me-2"/>Inventory Reports</h2>
                    
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3><t t-esc="summary['total_containers']"/></h3>
                                    <p class="text-muted">Total Containers</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3><t t-esc="summary['in_storage']"/></h3>
                                    <p class="text-muted">In Storage</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3><t t-esc="summary['active_containers']"/></h3>
                                    <p class="text-muted">Active</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3><t t-esc="summary['total_files']"/></h3>
                                    <p class="text-muted">Total Files</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <a href="/my/reports/export" class="btn btn-primary">
                        <i class="fa fa-download me-2"/>Export Full Report
                    </a>
                </div>
            </t>
        </template>
        
        <template id="portal_reports_activity" name="Activity Reports">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'reports'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-activity me-2"/>Activity Reports</h2>
                    
                    <div class="card mb-4">
                        <div class="card-header"><strong>Recent Requests</strong></div>
                        <div class="list-group list-group-flush">
                            <t t-foreach="requests[:10]" t-as="req">
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between">
                                        <span><t t-esc="req.name"/> - <t t-esc="req.request_type"/></span>
                                        <span class="text-muted"><t t-esc="req.create_date" t-options="{'widget': 'date'}"/></span>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </div>
                </div>
            </t>
        </template>
        
        <template id="portal_reports_compliance" name="Compliance Reports">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'reports'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-shield-check me-2"/>NAID Compliance Reports</h2>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h4 class="mb-0">Destruction Certificates</h4>
                                </div>
                                <div class="card-body">
                                    <p><strong><t t-esc="len(certificates)"/></strong> certificates issued</p>
                                    <a href="/my/certificates" class="btn btn-primary">View All</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-info text-white">
                                    <h4 class="mb-0">Audit Logs</h4>
                                </div>
                                <div class="card-body">
                                    <p><strong><t t-esc="len(audit_logs)"/></strong> audit entries</p>
                                    <a href="/my/custody/chain" class="btn btn-primary">View Chain</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>
        
        <template id="portal_reports_export" name="Export Reports">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'reports'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-file-export me-2"/>Export Data</h2>
                    
                    <div class="row">
                        <t t-foreach="export_options" t-as="option">
                            <div class="col-md-4 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i t-att-class="'fa ' + option['icon'] + ' fa-3x mb-3 text-primary'"/>
                                        <h5><t t-esc="option['label']"/></h5>
                                        <button class="btn btn-primary mt-2">Download</button>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </t>
        </template>
        
        <!-- ================================================================== -->
        <!-- FEEDBACK & SUPPORT TEMPLATES                                       -->
        <!-- ================================================================== -->
        
        <!-- NOTE: portal_feedback_form removed 2025-12-04 - Use feedback_form_template in portal_feedback.xml -->
        
        <template id="portal_feedback_history" name="Feedback History">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'feedback'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-history me-2"/>Your Feedback History</h2>
                    
                    <div class="list-group">
                        <t t-foreach="feedback_records" t-as="feedback">
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h5>Rating: <t t-esc="'â­' * int(feedback.rating)"/></h5>
                                        <p><t t-esc="feedback.comments"/></p>
                                        <small class="text-muted">
                                            Submitted: <t t-esc="feedback.create_date" t-options="{'widget': 'datetime'}"/>
                                        </small>
                                    </div>
                                    <span t-if="feedback.sentiment_category" 
                                          t-att-class="'badge bg-' + ('success' if feedback.sentiment_category == 'positive' else 'warning')">
                                        <t t-esc="feedback.sentiment_category"/>
                                    </span>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </t>
        </template>
        
        <template id="portal_help_center" name="Help Center">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'support'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-question-circle me-2"/>Help Center</h2>
                    
                    <div class="row">
                        <t t-foreach="help_topics" t-as="topic">
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h4>
                                            <i t-att-class="'fa ' + topic['icon'] + ' me-2'"/>
                                            <t t-esc="topic['title']"/>
                                        </h4>
                                    </div>
                                    <div class="list-group list-group-flush">
                                        <t t-foreach="topic['articles']" t-as="article">
                                            <a t-att-href="article['url']" class="list-group-item list-group-item-action">
                                                <i class="fa fa-file-alt me-2"/><t t-esc="article['title']"/>
                                            </a>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </t>
        </template>
        
        <!-- ================================================================== -->
        <!-- SETTINGS TEMPLATES                                                 -->
        <!-- ================================================================== -->
        
        <template id="portal_department_users" name="Department Users">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'settings'"/>
                
                <div class="container my-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fa fa-users me-2"/>Department Users</h2>
                        <div class="btn-group">
                            <!-- Export Dropdown -->
                            <div class="dropdown me-2">
                                <button class="btn btn-success dropdown-toggle" type="button" id="exportUsersDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fa fa-download"></i> Export
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="exportUsersDropdown">
                                    <li><a class="dropdown-item" href="/my/users/export?format=xlsx"><i class="fa fa-file-excel-o text-success"></i> Excel (.xlsx)</a></li>
                                    <li><a class="dropdown-item" href="/my/users/export?format=csv"><i class="fa fa-file-text-o text-primary"></i> CSV</a></li>
                                    <li><hr class="dropdown-divider"/></li>
                                    <li><a class="dropdown-item" href="/my/import/template/users"><i class="fa fa-download text-info"></i> Download Import Template</a></li>
                                </ul>
                            </div>
                            <!-- Import Button -->
                            <button class="btn btn-outline-primary me-2" type="button" data-bs-toggle="modal" data-bs-target="#importUsersModal">
                                <i class="fa fa-upload"></i> Import
                            </button>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                                <i class="fa fa-plus me-2"/>Add New User
                            </button>
                        </div>
                    </div>
                    
                    <!-- Import Users Modal -->
                    <div class="modal fade" id="importUsersModal" tabindex="-1" aria-labelledby="importUsersModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="importUsersModalLabel"><i class="fa fa-upload"></i> Import Portal Users</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form action="/my/users/import" method="POST" enctype="multipart/form-data">
                                    <div class="modal-body">
                                        <p class="text-muted">Upload a CSV or Excel file to bulk import portal users. Users will receive invitation emails.</p>
                                        <div class="mb-3">
                                            <label for="importUserFile" class="form-label">Select File</label>
                                            <input type="file" class="form-control" id="importUserFile" name="file" accept=".csv,.xlsx" required="required"/>
                                        </div>
                                        <div class="alert alert-info">
                                            <strong>Required columns:</strong> Name, Email, Department<br/>
                                            <strong>Optional columns:</strong> Phone, Job Title<br/>
                                            <a href="/my/import/template/users">Download the import template</a> to see the required format.
                                        </div>
                                        <div class="alert alert-warning">
                                            <i class="fa fa-exclamation-triangle"></i> <strong>Note:</strong> Department names must match existing departments exactly.
                                        </div>
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-primary"><i class="fa fa-upload"></i> Import Users</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Success/Error Messages -->
                    <t t-if="request.params.get('created') == 'success'">
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="fa fa-check-circle me-2"/>User created successfully! An invitation email has been sent.
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    </t>
                    <t t-if="request.params.get('updated') == 'success'">
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="fa fa-check-circle me-2"/>User updated successfully!
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    </t>
                    <t t-if="request.params.get('imported')">
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="fa fa-check-circle me-2"/>Successfully imported <t t-esc="request.params.get('imported')"/> users! Invitation emails have been sent.
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    </t>
                    <t t-if="request.params.get('error')">
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fa fa-exclamation-circle me-2"/>Error: <t t-esc="request.params.get('error')"/>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    </t>
                    
                    <!-- Users Table -->
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Department</th>
                                            <th>Last Login</th>
                                            <th>Status</th>
                                            <th class="text-end">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-if="not users">
                                            <tr>
                                                <td colspan="6" class="text-center text-muted py-4">
                                                    <i class="fa fa-info-circle fa-2x mb-2 d-block"/>
                                                    No department users found. Click "Add New User" to create one.
                                                </td>
                                            </tr>
                                        </t>
                                        <t t-foreach="users" t-as="user">
                                            <tr>
                                                <td>
                                                    <strong t-esc="user.name"/>
                                                    <t t-if="not user.active">
                                                        <span class="badge bg-secondary ms-2">Deactivated</span>
                                                    </t>
                                                </td>
                                                <td><t t-esc="user.login"/></td>
                                                <td>
                                                    <t t-if="user.accessible_department_ids">
                                                        <t t-esc="', '.join(user.accessible_department_ids.mapped('name'))"/>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="text-muted">No department</span>
                                                    </t>
                                                </td>
                                                <td>
                                                    <t t-if="user.login_date">
                                                        <t t-esc="user.login_date" t-options="{'widget': 'datetime'}"/>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="text-muted">Never</span>
                                                    </t>
                                                </td>
                                                <td>
                                                    <span t-att-class="'badge bg-' + ('success' if user.active else 'secondary')">
                                                        <t t-esc="'Active' if user.active else 'Inactive'"/>
                                                    </span>
                                                </td>
                                                <td class="text-end">
                                                    <div class="btn-group btn-group-sm">
                                                        <button class="btn btn-outline-primary" 
                                                                data-bs-toggle="modal" 
                                                                t-att-data-bs-target="'#editUserModal' + str(user.id)"
                                                                title="Edit User">
                                                            <i class="fa fa-edit"/>
                                                        </button>
                                                        <button class="btn btn-outline-danger" 
                                                                t-att-onclick="'deactivateUser(' + str(user.id) + ')'"
                                                                t-if="user.active"
                                                                title="Deactivate User">
                                                            <i class="fa fa-ban"/>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            
                                            <!-- Edit User Modal -->
                                            <div class="modal fade" t-att-id="'editUserModal' + str(user.id)" tabindex="-1">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <form t-attf-action="/my/users/{{user.id}}/edit" method="POST">
                                                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                            <div class="modal-header">
                                                                <h5 class="modal-title">Edit User</h5>
                                                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="mb-3">
                                                                    <label class="form-label">Name</label>
                                                                    <input type="text" class="form-control" name="name" 
                                                                           t-att-value="user.name" required="required"/>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label class="form-label">Email (cannot be changed)</label>
                                                                    <input type="email" class="form-control" 
                                                                           t-att-value="user.login" disabled="disabled"/>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label class="form-label">Department</label>
                                                                    <select class="form-select" name="department_id" required="required">
                                                                        <option value="">Select Department</option>
                                                                        <t t-foreach="departments" t-as="dept">
                                                                            <option t-att-value="dept.id" 
                                                                                    t-att-selected="'selected' if dept.id in user.accessible_department_ids.ids else None">
                                                                                <t t-esc="dept.name"/>
                                                                            </option>
                                                                        </t>
                                                                    </select>
                                                                </div>
                                                                <div class="form-check form-switch">
                                                                    <input class="form-check-input" type="checkbox" 
                                                                           name="active" value="true" id="activeSwitch"
                                                                           t-att-checked="'checked' if user.active else None"/>
                                                                    <label class="form-check-label" for="activeSwitch">
                                                                        Active User
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                <button type="submit" class="btn btn-primary">
                                                                    <i class="fa fa-save me-2"/>Save Changes
                                                                </button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Add User Modal -->
                <div class="modal fade" id="addUserModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="/my/users/create" method="POST">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <div class="modal-header">
                                    <h5 class="modal-title">
                                        <i class="fa fa-user-plus me-2"/>Add New Department User
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="alert alert-info">
                                        <i class="fa fa-info-circle me-2"/>
                                        The new user will receive an invitation email to set their password.
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="userName" class="form-label">Full Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="userName" name="name" 
                                               placeholder="John Doe" required="required"/>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="userEmail" class="form-label">Email Address <span class="text-danger">*</span></label>
                                        <input type="email" class="form-control" id="userEmail" name="email" 
                                               placeholder="john.doe@example.com" required="required"/>
                                        <small class="form-text text-muted">This will be used as the login username</small>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="userDepartment" class="form-label">Department <span class="text-danger">*</span></label>
                                        <select class="form-select" id="userDepartment" name="department_id" required="required">
                                            <option value="">Select a department</option>
                                            <t t-foreach="departments" t-as="dept">
                                                <option t-att-value="dept.id">
                                                    <t t-esc="dept.name"/>
                                                </option>
                                            </t>
                                        </select>
                                        <t t-if="not departments">
                                            <small class="form-text text-danger">
                                                No departments found. Please create a department first.
                                            </small>
                                        </t>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary" t-att-disabled="'disabled' if not departments else None">
                                        <i class="fa fa-save me-2"/>Create User &amp; Send Invitation
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- JavaScript -->
                <script>
                    function deactivateUser(userId) {
                        if (!confirm('Are you sure you want to deactivate this user? They will no longer be able to access the portal.')) {
                            return;
                        }
                        
                        fetch('/my/users/' + userId + '/deactivate', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({})
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                window.location.reload();
                            } else {
                                alert('Error: ' + data.error);
                            }
                        })
                        .catch(error => {
                            alert('An error occurred: ' + error);
                        });
                    }
                </script>
            </t>
        </template>
        
        <template id="portal_notifications" name="Notification Settings">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'settings'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-bell me-2"/>Notification Preferences</h2>
                    
                    <div class="card">
                        <div class="card-body">
                            <form method="POST" action="/my/notifications/update">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                
                                <t t-foreach="notification_channels" t-as="channel">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" 
                                               t-att-id="'notif_' + channel['type']"
                                               t-att-name="'notif_' + channel['type']"
                                               t-att-checked="'checked' if channel['enabled'] else None"/>
                                        <label class="form-check-label" t-att-for="'notif_' + channel['type']">
                                            <t t-esc="channel['label']"/>
                                        </label>
                                    </div>
                                </t>
                                
                                <button type="submit" class="btn btn-primary mt-3">
                                    <i class="fa fa-save me-2"/>Save Preferences
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </t>
        </template>
        
        <template id="portal_access_management" name="Access Management">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'settings'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-key me-2"/>Access Management</h2>
                    
                    <div class="alert alert-info">
                        <i class="fa fa-info-circle me-2"/>
                        Manage user access and permissions for your departments.
                    </div>
                    
                    <!-- Department Users Table -->
                    <t t-if="department_users">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fa fa-users me-2"/>Department Users</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th>User</th>
                                                <th>Department</th>
                                                <th>Role</th>
                                                <th>Status</th>
                                                <th class="text-center">View</th>
                                                <th class="text-center">Create</th>
                                                <th class="text-center">Edit</th>
                                                <th class="text-center">Delete</th>
                                                <th class="text-center">Export</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="department_users" t-as="du">
                                                <tr>
                                                    <td>
                                                        <strong t-esc="du.user_id.name"/>
                                                        <br/>
                                                        <small class="text-muted" t-esc="du.user_id.email"/>
                                                    </td>
                                                    <td t-esc="du.department_id.name"/>
                                                    <td>
                                                        <span t-attf-class="badge bg-#{du.role == 'manager' and 'danger' or du.role == 'editor' and 'warning' or 'secondary'}">
                                                            <t t-esc="du.role.capitalize() if du.role else 'Viewer'"/>
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <span t-attf-class="badge bg-#{du.state == 'active' and 'success' or 'secondary'}">
                                                            <t t-esc="du.state.capitalize() if du.state else 'Active'"/>
                                                        </span>
                                                    </td>
                                                    <td class="text-center">
                                                        <i t-attf-class="fa fa-#{du.can_view_records and 'check text-success' or 'times text-muted'}"/>
                                                    </td>
                                                    <td class="text-center">
                                                        <i t-attf-class="fa fa-#{du.can_create_records and 'check text-success' or 'times text-muted'}"/>
                                                    </td>
                                                    <td class="text-center">
                                                        <i t-attf-class="fa fa-#{du.can_edit_records and 'check text-success' or 'times text-muted'}"/>
                                                    </td>
                                                    <td class="text-center">
                                                        <i t-attf-class="fa fa-#{du.can_delete_records and 'check text-success' or 'times text-muted'}"/>
                                                    </td>
                                                    <td class="text-center">
                                                        <i t-attf-class="fa fa-#{du.can_export_records and 'check text-success' or 'times text-muted'}"/>
                                                    </td>
                                                    <td>
                                                        <a t-attf-href="/my/access/user/#{du.id}/edit" 
                                                           class="btn btn-sm btn-outline-primary" title="Edit Permissions">
                                                            <i class="fa fa-pencil"/>
                                                        </a>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Permission Legend -->
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fa fa-info-circle me-2"/>Permission Legend</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <h6>Roles</h6>
                                        <ul class="list-unstyled">
                                            <li><span class="badge bg-secondary">Viewer</span> - Can only view records</li>
                                            <li><span class="badge bg-warning">Editor</span> - Can view and edit records</li>
                                            <li><span class="badge bg-danger">Manager</span> - Full access including delete</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-8">
                                        <h6>Permissions</h6>
                                        <ul class="list-unstyled">
                                            <li><i class="fa fa-check text-success"/> <strong>View</strong> - Can see containers, files, and documents</li>
                                            <li><i class="fa fa-check text-success"/> <strong>Create</strong> - Can add new containers and documents</li>
                                            <li><i class="fa fa-check text-success"/> <strong>Edit</strong> - Can modify existing records</li>
                                            <li><i class="fa fa-check text-success"/> <strong>Delete</strong> - Can request deletion of records</li>
                                            <li><i class="fa fa-check text-success"/> <strong>Export</strong> - Can download/export data</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                    
                    <!-- No Users Message -->
                    <t t-else="">
                        <div class="card">
                            <div class="card-body text-center py-5">
                                <i class="fa fa-users fa-3x text-muted mb-3"/>
                                <h5>No Department Users Found</h5>
                                <p class="text-muted">
                                    No users are assigned to your departments yet.
                                    Contact your administrator to add users.
                                </p>
                            </div>
                        </div>
                    </t>
                </div>
            </t>
        </template>
        
        <!-- Access User Edit Form -->
        <template id="portal_access_user_edit" name="Edit User Access">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'settings'"/>
                
                <div class="container my-4">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/my/access">Access Management</a></li>
                            <li class="breadcrumb-item active" t-esc="department_user.user_id.name"/>
                        </ol>
                    </nav>
                    
                    <h2 class="mb-4">
                        <i class="fa fa-user-cog me-2"/>
                        Edit Permissions: <t t-esc="department_user.user_id.name"/>
                    </h2>
                    
                    <form method="POST" t-attf-action="/my/access/user/#{department_user.id}/save">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">User Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <dl class="row mb-0">
                                            <dt class="col-sm-4">User</dt>
                                            <dd class="col-sm-8" t-esc="department_user.user_id.name"/>
                                            
                                            <dt class="col-sm-4">Email</dt>
                                            <dd class="col-sm-8" t-esc="department_user.user_id.email"/>
                                            
                                            <dt class="col-sm-4">Department</dt>
                                            <dd class="col-sm-8" t-esc="department_user.department_id.name"/>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Role &amp; Status</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Role</label>
                                            <select name="role" class="form-select">
                                                <option value="viewer" t-att-selected="department_user.role == 'viewer'">Viewer</option>
                                                <option value="editor" t-att-selected="department_user.role == 'editor'">Editor</option>
                                                <option value="manager" t-att-selected="department_user.role == 'manager'">Manager</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Status</label>
                                            <select name="state" class="form-select">
                                                <option value="active" t-att-selected="department_user.state == 'active'">Active</option>
                                                <option value="inactive" t-att-selected="department_user.state == 'inactive'">Inactive</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0">Granular Permissions</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" name="can_view_records" 
                                                   id="can_view_records" value="1"
                                                   t-att-checked="department_user.can_view_records"/>
                                            <label class="form-check-label" for="can_view_records">
                                                <i class="fa fa-eye me-1"/> Can View Records
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" name="can_create_records" 
                                                   id="can_create_records" value="1"
                                                   t-att-checked="department_user.can_create_records"/>
                                            <label class="form-check-label" for="can_create_records">
                                                <i class="fa fa-plus me-1"/> Can Create Records
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" name="can_edit_records" 
                                                   id="can_edit_records" value="1"
                                                   t-att-checked="department_user.can_edit_records"/>
                                            <label class="form-check-label" for="can_edit_records">
                                                <i class="fa fa-pencil me-1"/> Can Edit Records
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" name="can_delete_records" 
                                                   id="can_delete_records" value="1"
                                                   t-att-checked="department_user.can_delete_records"/>
                                            <label class="form-check-label" for="can_delete_records">
                                                <i class="fa fa-trash me-1"/> Can Delete Records
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" name="can_export_records" 
                                                   id="can_export_records" value="1"
                                                   t-att-checked="department_user.can_export_records"/>
                                            <label class="form-check-label" for="can_export_records">
                                                <i class="fa fa-download me-1"/> Can Export Records
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" name="can_approve_requests" 
                                                   id="can_approve_requests" value="1"
                                                   t-att-checked="department_user.can_approve_requests"/>
                                            <label class="form-check-label" for="can_approve_requests">
                                                <i class="fa fa-check-circle me-1"/> Can Approve Requests
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fa fa-save me-2"/>Save Changes
                            </button>
                            <a href="/my/access" class="btn btn-secondary">
                                <i class="fa fa-times me-2"/>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </t>
        </template>
        
        <template id="portal_advanced_search" name="Advanced Search">
            <t t-call="portal.portal_layout">
                <t t-set="page_name" t-value="'inventory'"/>
                
                <div class="container my-4">
                    <h2 class="mb-4"><i class="fa fa-search me-2"/>Advanced Search</h2>
                    
                    <div class="card">
                        <div class="card-body">
                            <form method="GET" action="/my/inventory/search_results">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Search Category</label>
                                        <select name="category" class="form-select">
                                            <t t-foreach="search_categories" t-as="cat">
                                                <option t-att-value="cat['id']">
                                                    <t t-esc="cat['label']"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Search Term</label>
                                        <input type="text" name="search" class="form-control" 
                                               placeholder="Enter search term..."/>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fa fa-search me-2"/>Search
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </t>
        </template>
        
    </data>
</odoo>
