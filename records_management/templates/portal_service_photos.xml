<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <!-- ============================================================ -->
        <!-- SERVICE PHOTOS PORTAL - Customer view of job photos         -->
        <!-- NOT for inventory documents (handled by /my/inventory)       -->
        <!-- ============================================================ -->

        <!-- Service Photos List Template -->
        <template id="portal_service_photos" name="My Service Photos">
            <t t-call="portal.portal_layout">
                <t t-set="breadcrumbs_searchbar" t-value="True"/>
                <t t-set="title">Service Photos</t>

                <div class="o_portal_my_service_photos">
                    <div class="card">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h3 class="mb-0">
                                <i class="fa fa-camera me-2"></i>
                                Service Job Photos
                            </h3>
                            <div class="btn-group" role="group">
                                <!-- Filter dropdown -->
                                <div class="dropdown">
                                    <button class="btn btn-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fa fa-filter me-1"></i>
                                        <t t-esc="searchbar_filters[filterby]['label']"/>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <t t-foreach="searchbar_filters" t-as="filter_key">
                                            <li>
                                                <a class="dropdown-item" t-attf-href="/my/service-photos?filterby=#{filter_key}&amp;sortby=#{sortby}">
                                                    <t t-esc="searchbar_filters[filter_key]['label']"/>
                                                </a>
                                            </li>
                                        </t>
                                    </ul>
                                </div>
                                <!-- Sort dropdown -->
                                <div class="dropdown ms-2">
                                    <button class="btn btn-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fa fa-sort me-1"></i>
                                        <t t-esc="searchbar_sortings[sortby]['label']"/>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <t t-foreach="searchbar_sortings" t-as="sort_key">
                                            <li>
                                                <a class="dropdown-item" t-attf-href="/my/service-photos?sortby=#{sort_key}&amp;filterby=#{filterby}">
                                                    <t t-esc="searchbar_sortings[sort_key]['label']"/>
                                                </a>
                                            </li>
                                        </t>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Info Alert -->
                            <div class="alert alert-info mb-4">
                                <i class="fa fa-info-circle me-2"></i>
                                <strong>Service Documentation:</strong> 
                                These are photos taken by technicians during your service jobs - 
                                including before/after photos, destruction proof, and pickup documentation.
                                <br/>
                                <small class="text-muted">
                                    For your own stored records and documents, visit 
                                    <a href="/my/inventory">My Inventory</a>.
                                </small>
                            </div>

                            <t t-if="not photos">
                                <div class="alert alert-secondary text-center py-5">
                                    <i class="fa fa-camera fa-3x mb-3 text-muted"></i>
                                    <h4>No Service Photos Yet</h4>
                                    <p class="mb-0">Photos from your service jobs will appear here once technicians upload them.</p>
                                </div>
                            </t>

                            <t t-if="photos">
                                <!-- Photo Grid (Kanban-like) -->
                                <div class="row g-4">
                                    <t t-foreach="photos" t-as="photo">
                                        <div class="col-md-4 col-lg-3">
                                            <div class="card h-100 shadow-sm">
                                                <!-- Photo Thumbnail -->
                                                <a t-attf-href="/my/service-photo/#{photo.id}" class="text-decoration-none">
                                                    <t t-if="photo.image">
                                                        <img t-att-src="'data:image/png;base64,' + photo.image.decode('utf-8')" 
                                                             class="card-img-top" 
                                                             style="height: 180px; object-fit: cover;"
                                                             t-att-alt="photo.name"/>
                                                    </t>
                                                    <t t-else="">
                                                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                                                            <i class="fa fa-image fa-3x text-muted"></i>
                                                        </div>
                                                    </t>
                                                </a>
                                                <div class="card-body">
                                                    <h6 class="card-title text-truncate mb-1">
                                                        <a t-attf-href="/my/service-photo/#{photo.id}" class="text-decoration-none text-dark">
                                                            <t t-esc="photo.name"/>
                                                        </a>
                                                    </h6>
                                                    <!-- Photo Purpose Badge -->
                                                    <span t-if="photo.photo_purpose == 'service_before'" class="badge bg-info">Before Service</span>
                                                    <span t-if="photo.photo_purpose == 'service_after'" class="badge bg-success">After Service</span>
                                                    <span t-if="photo.photo_purpose == 'destruction_proof'" class="badge bg-danger">Destruction Proof</span>
                                                    <span t-if="photo.photo_purpose == 'pickup_doc'" class="badge bg-warning text-dark">Pickup</span>
                                                    <span t-if="photo.photo_purpose == 'compliance'" class="badge bg-primary">Compliance</span>
                                                    <span t-if="photo.photo_purpose == 'equipment'" class="badge bg-secondary">Equipment</span>
                                                    <span t-if="photo.photo_purpose == 'other'" class="badge bg-light text-dark">Other</span>
                                                    
                                                    <p class="card-text small text-muted mt-2 mb-0">
                                                        <i class="fa fa-calendar me-1"></i>
                                                        <t t-esc="photo.date" t-options="{'widget': 'date'}"/>
                                                    </p>
                                                </div>
                                                <div class="card-footer bg-transparent border-top-0">
                                                    <div class="btn-group w-100" role="group">
                                                        <a t-attf-href="/my/service-photo/#{photo.id}" class="btn btn-sm btn-outline-primary">
                                                            <i class="fa fa-eye me-1"></i> View
                                                        </a>
                                                        <a t-attf-href="/my/service-photo/#{photo.id}/download" class="btn btn-sm btn-outline-success">
                                                            <i class="fa fa-download me-1"></i> Download
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                </div>

                                <!-- Pager -->
                                <div class="mt-4">
                                    <t t-call="portal.pager"/>
                                </div>
                            </t>
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <!-- Service Photo Detail Template -->
        <template id="portal_service_photo_detail" name="Service Photo Detail">
            <t t-call="portal.portal_layout">
                <t t-set="title" t-value="photo.name"/>

                <div class="o_portal_service_photo_detail">
                    <!-- Breadcrumb -->
                    <nav aria-label="breadcrumb" class="mb-3">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/my/home">Home</a></li>
                            <li class="breadcrumb-item"><a href="/my/service-photos">Service Photos</a></li>
                            <li class="breadcrumb-item active" t-esc="photo.name"/>
                        </ol>
                    </nav>

                    <div class="card">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h4 class="mb-0">
                                <i class="fa fa-camera me-2"></i>
                                <t t-esc="photo.name"/>
                            </h4>
                            <div class="btn-group">
                                <a t-attf-href="/my/service-photo/#{photo.id}/download" class="btn btn-light btn-sm">
                                    <i class="fa fa-download me-1"></i> Download
                                </a>
                                <a href="/my/service-photos" class="btn btn-outline-light btn-sm ms-2">
                                    <i class="fa fa-arrow-left me-1"></i> Back to Photos
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- Photo Display -->
                                <div class="col-lg-8 mb-4">
                                    <t t-if="photo.image">
                                        <img t-att-src="'data:image/png;base64,' + photo.image.decode('utf-8')" 
                                             class="img-fluid rounded shadow" 
                                             style="max-height: 600px; width: 100%; object-fit: contain;"
                                             t-att-alt="photo.name"/>
                                    </t>
                                    <t t-else="">
                                        <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 400px;">
                                            <div class="text-center text-muted">
                                                <i class="fa fa-image fa-5x mb-3"></i>
                                                <p>Image not available</p>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                                
                                <!-- Photo Details -->
                                <div class="col-lg-4">
                                    <div class="card bg-light">
                                        <div class="card-header">
                                            <h5 class="mb-0"><i class="fa fa-info-circle me-2"></i>Photo Details</h5>
                                        </div>
                                        <div class="card-body">
                                            <dl class="row mb-0">
                                                <dt class="col-5">Type:</dt>
                                                <dd class="col-7">
                                                    <span t-if="photo.photo_purpose == 'service_before'" class="badge bg-info">Before Service</span>
                                                    <span t-if="photo.photo_purpose == 'service_after'" class="badge bg-success">After Service</span>
                                                    <span t-if="photo.photo_purpose == 'destruction_proof'" class="badge bg-danger">Destruction Proof</span>
                                                    <span t-if="photo.photo_purpose == 'pickup_doc'" class="badge bg-warning text-dark">Pickup</span>
                                                    <span t-if="photo.photo_purpose == 'compliance'" class="badge bg-primary">Compliance</span>
                                                    <span t-if="photo.photo_purpose == 'equipment'" class="badge bg-secondary">Equipment</span>
                                                    <span t-if="photo.photo_purpose == 'other'" class="badge bg-light text-dark">Other</span>
                                                </dd>
                                                
                                                <dt class="col-5">Date:</dt>
                                                <dd class="col-7">
                                                    <t t-esc="photo.date" t-options="{'widget': 'datetime'}"/>
                                                </dd>
                                                
                                                <t t-if="photo.location">
                                                    <dt class="col-5">Location:</dt>
                                                    <dd class="col-7" t-esc="photo.location"/>
                                                </t>
                                                
                                                <t t-if="photo.description">
                                                    <dt class="col-5">Notes:</dt>
                                                    <dd class="col-7" t-esc="photo.description"/>
                                                </t>
                                                
                                                <t t-if="photo.file_size">
                                                    <dt class="col-5">File Size:</dt>
                                                    <dd class="col-7">
                                                        <t t-set="size_kb" t-value="photo.file_size / 1024"/>
                                                        <t t-if="size_kb > 1024">
                                                            <t t-esc="'%.1f MB' % (size_kb / 1024)"/>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-esc="'%.1f KB' % size_kb"/>
                                                        </t>
                                                    </dd>
                                                </t>
                                                
                                                <t t-if="photo.resolution">
                                                    <dt class="col-5">Resolution:</dt>
                                                    <dd class="col-7" t-esc="photo.resolution"/>
                                                </t>
                                            </dl>
                                        </div>
                                    </div>

                                    <!-- Related Documents (if any) -->
                                    <t t-if="photo.destruction_certificate_id or photo.shredding_work_order_id">
                                        <div class="card mt-3">
                                            <div class="card-header">
                                                <h6 class="mb-0"><i class="fa fa-link me-2"></i>Related Documents</h6>
                                            </div>
                                            <ul class="list-group list-group-flush">
                                                <t t-if="photo.destruction_certificate_id">
                                                    <li class="list-group-item">
                                                        <i class="fa fa-file-text text-danger me-2"></i>
                                                        Destruction Certificate: 
                                                        <a t-attf-href="/my/certificate/#{photo.destruction_certificate_id.id}">
                                                            <t t-esc="photo.destruction_certificate_id.name"/>
                                                        </a>
                                                    </li>
                                                </t>
                                            </ul>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>

    </data>
</odoo>
