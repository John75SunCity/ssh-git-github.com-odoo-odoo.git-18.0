<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
  <template id="portal_document_bulk_upload" name="Portal Document Bulk Upload">
    <t t-call="portal.portal_layout">
      <t t-set="breadcrumbs_searchbar" t-value="True"/>
      <t t-call="portal.portal_breadcrumbs">
        <t t-set="breadcrumbs" t-value="[(None, 'Bulk Upload Files')]"/>
      </t>
      
      <div class="container-fluid mt-3">
        <div class="row">
          <div class="col-lg-8">
            <div class="card">
              <div class="card-header bg-primary text-white">
                <h3 class="mb-0"><i class="fa fa-cloud-upload"></i> Bulk Upload Inventory</h3>
              </div>
              <div class="card-body">
                <div class="alert alert-info">
                  <i class="fa fa-info-circle"></i>
                  <strong>Instructions:</strong> Upload a CSV or Excel file with your inventory data. 
                  Use our template to ensure proper formatting.
                </div>
                
                <form method="post" enctype="multipart/form-data" t-att-action="request.httprequest.path">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="partner_id" class="font-weight-bold">
                          <i class="fa fa-building"></i> Customer/Department
                        </label>
                        <select name="partner_id" id="partner_id" class="form-control" required="required">
                          <option value="">-- Select Customer/Department --</option>
                          <t t-foreach="partners" t-as="p">
                            <option t-att-value="p.id" t-esc="p.display_name"/>
                          </t>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="upload_file" class="font-weight-bold">
                          <i class="fa fa-file"></i> Upload File (CSV/Excel)
                        </label>
                        <input type="file" name="upload_file" id="upload_file" class="form-control" 
                               accept=".csv,.xlsx,.xls" required="required"/>
                        <small class="text-muted">Accepted formats: CSV, Excel (.xlsx, .xls)</small>
                      </div>
                    </div>
                  </div>
                  
                  <div class="form-check mb-3">
                    <input type="checkbox" name="has_header" class="form-check-input" 
                           checked="checked" id="hasHeader"/>
                    <label for="hasHeader" class="form-check-label">
                      First row contains column headers
                    </label>
                  </div>
                  
                  <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-primary">
                      <i class="fa fa-upload"></i> Upload &amp; Parse
                    </button>
                    <a href="/my/documents/bulk_upload/template" class="btn btn-outline-secondary">
                      <i class="fa fa-download"></i> Download Template
                    </a>
                  </div>
                </form>
              </div>
            </div>
          </div>
          
          <div class="col-lg-4">
            <div class="card">
              <div class="card-header">
                <h5><i class="fa fa-question-circle"></i> Template Format</h5>
              </div>
              <div class="card-body">
                <p><strong>Required columns:</strong></p>
                <ul class="list-unstyled">
                  <li><i class="fa fa-check text-success"></i> <code>name</code> - Document/File name</li>
                  <li><i class="fa fa-check text-success"></i> <code>description</code> - Document description</li>
                  <li><i class="fa fa-check text-success"></i> <code>container</code> - Container reference</li>
                </ul>
                <p><strong>Optional columns:</strong></p>
                <ul class="list-unstyled">
                  <li><i class="fa fa-info text-info"></i> <code>temp_barcode</code> - Temporary barcode</li>
                  <li><i class="fa fa-info text-info"></i> <code>document_type</code> - Document type code</li>
                  <li><i class="fa fa-info text-info"></i> <code>received_date</code> - Date received (YYYY-MM-DD)</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <t t-if="wizard">
        <div class="row mt-4">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h4>
                  <i class="fa fa-list"></i> Upload Results 
                  <span class="badge badge-info ml-2" t-esc="wizard.state.title()"/>
                </h4>
              </div>
              <div class="card-body">
                <t t-if="wizard.error_log">
                  <div class="alert alert-danger">
                    <i class="fa fa-exclamation-triangle"></i>
                    <strong>Errors Found:</strong>
                    <pre class="mt-2 mb-0" t-esc="wizard.error_log"/>
                  </div>
                </t>
                
                <t t-if="wizard.line_ids">
                  <p><strong>Parsed <t t-esc="len(wizard.line_ids)"/> records from your file:</strong></p>
                  <div class="table-responsive">
                    <table class="table table-sm table-striped">
                      <thead class="thead-light">
                        <tr>
                          <th>#</th>
                          <th>Document Name</th>
                          <th>Description</th>
                          <th>Container Ref</th>
                          <th>Temp Barcode</th>
                          <th>Doc Type</th>
                          <th>Received Date</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr t-foreach="wizard.line_ids" t-as="l">
                          <td><span class="badge badge-secondary" t-esc="l.sequence"/></td>
                          <td><strong t-esc="l.name"/></td>
                          <td t-esc="l.raw_description or '-'"/>
                          <td><code t-esc="l.raw_container_ref or '-'"/></td>
                          <td><code t-esc="l.raw_temp_barcode or '-'"/></td>
                          <td t-esc="l.raw_doc_type_code or '-'"/>
                          <td t-esc="l.raw_received_date or '-'"/>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </t>
                
                <t t-if="wizard.state == 'parsed'">
                  <div class="alert alert-success">
                    <i class="fa fa-check-circle"></i>
                    <strong>Ready to Import:</strong> All records parsed successfully. 
                    Click below to create the documents in your inventory.
                  </div>
                  <form t-att-action="'/my/documents/bulk_upload/commit/%s' % wizard.id" method="post">
                    <button type="submit" class="btn btn-success btn-lg">
                      <i class="fa fa-database"></i> Import Records to Inventory
                    </button>
                    <a href="/my/documents/bulk_upload" class="btn btn-secondary ml-2">
                      <i class="fa fa-upload"></i> Upload Another File
                    </a>
                  </form>
                </t>
                
                <t t-if="wizard.state == 'done'">
                  <div class="alert alert-success">
                    <i class="fa fa-check-circle"></i>
                    <strong>Import Complete:</strong> All records have been successfully created in your inventory.
                  </div>
                  <a href="/my/containers" class="btn btn-primary">
                    <i class="fa fa-eye"></i> View My Inventory
                  </a>
                  <a href="/my/documents/bulk_upload" class="btn btn-secondary ml-2">
                    <i class="fa fa-upload"></i> Upload Another File
                  </a>
                </t>
              </div>
            </div>
          </div>
        </div>
      </t>
    </t>
  </template>
    </data>
</odoo>
