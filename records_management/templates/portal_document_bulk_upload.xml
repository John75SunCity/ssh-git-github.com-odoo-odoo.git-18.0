<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="portal_document_bulk_upload" name="Portal Document Bulk Upload" inherit_id="portal.layout">
    <xpath expr="//div[@id='wrap']" position="inside">
      <t t-call="portal.portal_breadcrumb">
        <t t-set="breadcrumbs" t-value="[(None, 'Bulk Upload Files')]"/>
      </t>
      <h2>Bulk Upload Files</h2>
      <form method="post" enctype="multipart/form-data" t-att-action="request.httprequest.path">
        <div class="form-group">
          <label>Customer (Partner)</label>
          <select name="partner_id" class="form-control" required="required">
            <option value="">Select...</option>
            <t t-foreach="partners" t-as="p">
              <option t-att-value="p.id">[[ p.display_name ]]</option>
            </t>
          </select>
        </div>
        <div class="form-group">
          <label>File (CSV)</label>
          <input type="file" name="upload_file" class="form-control" required="required"/>
        </div>
        <div class="form-check">
          <input type="checkbox" name="has_header" class="form-check-input" checked="checked" id="hasHeader"/>
          <label for="hasHeader" class="form-check-label">First Row is Header</label>
        </div>
        <button type="submit" class="btn btn-primary mt-2">Upload &amp; Parse</button>
      </form>
      <t t-if="wizard">
        <hr/>
        <h3>Parsed Lines (State: [[ wizard.state ]])</h3>
        <t t-if="wizard.error_log">
          <div class="alert alert-warning" style="white-space:pre-wrap;">[[ wizard.error_log ]]</div>
        </t>
        <table class="table table-sm table-bordered">
          <thead>
            <tr>
              <th>#</th><th>Name</th><th>Description</th><th>Container Ref</th><th>Temp Barcode</th><th>Doc Type Code</th><th>Received Date</th>
            </tr>
          </thead>
          <tbody>
            <tr t-foreach="wizard.line_ids" t-as="l">
              <td>[[ l.sequence ]]</td>
              <td>[[ l.name ]]</td>
              <td>[[ l.raw_description ]]</td>
              <td>[[ l.raw_container_ref ]]</td>
              <td>[[ l.raw_temp_barcode ]]</td>
              <td>[[ l.raw_doc_type_code ]]</td>
              <td>[[ l.raw_received_date ]]</td>
            </tr>
          </tbody>
        </table>
        <t t-if="wizard.state == 'parsed'">
          <form t-att-action="'/my/documents/bulk_upload/commit/%s' % wizard.id" method="post">
            <button type="submit" class="btn btn-success">Commit Records</button>
          </form>
        </t>
      </t>
    </xpath>
  </template>
</odoo>
