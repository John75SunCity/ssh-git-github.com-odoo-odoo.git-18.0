<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Destruction Certificate Report Action -->
        <record id="action_destruction_certificate_report" model="ir.actions.report">
            <field name="name">NAID Destruction Certificate</field>
            <field name="model">shredding.service</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">records_management.destruction_certificate_template</field>
            <field name="report_file">records_management.destruction_certificate</field>
            <field name="binding_model_id" ref="records_management.model_shredding_service"/>
            <field name="binding_type">report</field>
            <field name="print_report_name">'Destruction_Certificate_%s' % (object.name)</field>
        </record>

        <!-- NAID AAA Destruction Certificate Template -->
        <template id="destruction_certificate_template">
            <t t-call="web.external_layout">
                <div class="page">
                    <t t-foreach="docs" t-as="service">
                        <!-- NAID Compliance Header -->
                        <div class="certificate-header" style="text-align: center; border: 2px solid #000; padding: 20px; margin-bottom: 30px;">
                            <h1 style="color: #d32f2f; margin: 0;">CERTIFICATE OF DESTRUCTION</h1>
                            <h2 style="margin: 10px 0;">NAID AAA CERTIFIED</h2>
                            <p style="margin: 5px 0; font-weight: bold;">Secure Document Destruction Service</p>
                        </div>

                        <!-- Certificate Details -->
                        <div class="certificate-info" style="margin-bottom: 30px;">
                            <div class="row">
                                <div class="col-6">
                                    <h3>Service Information</h3>
                                    <table class="table table-borderless">
                                        <tr>
                                            <td><strong>Certificate No:</strong></td>
                                            <td><span t-field="service.name"/></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Service Date:</strong></td>
                                            <td><span t-field="service.service_date" t-options="{'widget': 'date'}"/></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Service Type:</strong></td>
                                            <td><span t-field="service.service_type"/></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Completion Time:</strong></td>
                                            <td><span t-field="service.completion_time" t-options="{'widget': 'datetime'}"/></td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-6">
                                    <h3>Customer Information</h3>
                                    <table class="table table-borderless">
                                        <tr>
                                            <td><strong>Customer:</strong></td>
                                            <td><span t-field="service.partner_id.name"/></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Address:</strong></td>
                                            <td>
                                                <span t-field="service.partner_id.street"/><br/>
                                                <span t-field="service.partner_id.city"/>, 
                                                <span t-field="service.partner_id.state_id.name"/> 
                                                <span t-field="service.partner_id.zip"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><strong>Contact:</strong></td>
                                            <td><span t-field="service.partner_id.phone"/></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Destruction Details -->
                        <div class="destruction-details" style="margin-bottom: 30px;">
                            <h3>Items Destroyed</h3>
                            <table class="table table-sm table-bordered">
                                <thead style="background-color: #f8f9fa;">
                                    <tr>
                                        <th>Container/Item ID</th>
                                        <th>Description</th>
                                        <th>Weight (lbs)</th>
                                        <th>Volume (CF)</th>
                                        <th>Document Type</th>
                                    </tr>
                                </thead>
                                <tbody>
                                                                    <tr>
                                    <td><strong>Name:</strong></td>
                                    <td><span t-esc="doc.name or 'N/A'"/></td>
                                </tr>
                                <tr t-if="doc.create_date">
                                    <td><strong>Created:</strong></td>
                                    <td><span t-esc="doc.create_date.strftime('%Y-%m-%d %H:%M')" /></td>
                                </tr>
                                <tr t-if="doc.user_id">
                                    <td><strong>Created by:</strong></td>
                                    <td><span t-esc="doc.user_id.name"/></td>
                                </tr>
                                </tbody>
                                <tfoot>
                                    <tr style="background-color: #e9ecef; font-weight: bold;">
                                        <td colspan="2">TOTAL</td>
                                        <td><span t-field="service.total_weight"/> lbs</td>
                                        <td><span t-field="service.total_volume"/> CF</td>
                                        <td>-</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                        <!-- NAID Compliance Statement -->
                        <div class="compliance-statement" style="border: 1px solid #ddd; padding: 15px; margin-bottom: 30px; background-color: #f8f9fa;">
                            <h4>NAID AAA Compliance Certification</h4>
                            <p style="text-align: justify;">
                                This certificate confirms that the above-listed materials have been destroyed 
                                in accordance with NAID (National Association for Information Destruction) 
                                AAA standards for secure destruction of confidential information. The destruction 
                                process ensures complete obliteration of all data, making reconstruction impossible.
                            </p>
                            
                            <div class="row">
                                <div class="col-6">
                                    <p><strong>Destruction Method:</strong> <span t-field="service.destruction_method"/></p>
                                    <p><strong>Equipment Used:</strong> <span t-field="service.equipment_id.name"/></p>
                                    <p><strong>Particle Size:</strong> <span t-field="service.particle_size"/> mm</p>
                                </div>
                                <div class="col-6">
                                    <p><strong>Technician:</strong> <span t-field="service.technician_id.name"/></p>
                                    <p><strong>Supervisor:</strong> <span t-field="service.supervisor_id.name"/></p>
                                    <p><strong>Witness:</strong> <span t-field="service.witness_name"/></p>
                                </div>
                            </div>
                        </div>

                        <!-- Chain of Custody -->
                        <div class="chain-of-custody" style="margin-bottom: 30px;">
                            <h4>Chain of Custody</h4>
                            <table class="table table-sm table-bordered">
                                <thead>
                                    <tr>
                                        <th>Date/Time</th>
                                        <th>Event</th>
                                        <th>Personnel</th>
                                        <th>Location</th>
                                    </tr>
                                </thead>
                                <tbody>
                                                                    <tr>
                                    <td><strong>Name:</strong></td>
                                    <td><span t-esc="doc.name or 'N/A'"/></td>
                                </tr>
                                <tr t-if="doc.create_date">
                                    <td><strong>Created:</strong></td>
                                    <td><span t-esc="doc.create_date.strftime('%Y-%m-%d %H:%M')" /></td>
                                </tr>
                                <tr t-if="doc.user_id">
                                    <td><strong>Created by:</strong></td>
                                    <td><span t-esc="doc.user_id.name"/></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Signatures Section -->
                        <div class="signatures" style="margin-bottom: 30px;">
                            <div class="row">
                                <div class="col-4">
                                    <div style="border: 1px solid #ccc; height: 80px; text-align: center; padding-top: 30px;">
                                        <t t-if="service.technician_signature">
                                            <img t-att-src="'data:image/png;base64,%s' % to_text(service.technician_signature)" 
                                                 style="max-width: 150px; max-height: 60px;"/>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #999;">Digital Signature</span>
                                        </t>
                                    </div>
                                    <p style="text-align: center; margin-top: 10px;">
                                        <strong>Technician Signature</strong><br/>
                                        <span t-field="service.technician_id.name"/>
                                    </p>
                                </div>
                                <div class="col-4">
                                    <div style="border: 1px solid #ccc; height: 80px; text-align: center; padding-top: 30px;">
                                        <t t-if="service.supervisor_signature">
                                            <img t-att-src="'data:image/png;base64,%s' % to_text(service.supervisor_signature)" 
                                                 style="max-width: 150px; max-height: 60px;"/>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #999;">Digital Signature</span>
                                        </t>
                                    </div>
                                    <p style="text-align: center; margin-top: 10px;">
                                        <strong>Supervisor Signature</strong><br/>
                                        <span t-field="service.supervisor_id.name"/>
                                    </p>
                                </div>
                                <div class="col-4">
                                    <div style="border: 1px solid #ccc; height: 80px; text-align: center; padding-top: 30px;">
                                        <t t-if="service.customer_signature">
                                            <img t-att-src="'data:image/png;base64,%s' % to_text(service.customer_signature)" 
                                                 style="max-width: 150px; max-height: 60px;"/>
                                        </t>
                                        <t t-else="">
                                            <span style="color: #999;">Customer Signature</span>
                                        </t>
                                    </div>
                                    <p style="text-align: center; margin-top: 10px;">
                                        <strong>Customer Representative</strong><br/>
                                        <span t-field="service.customer_representative"/>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- QR Code and Verification -->
                        <div class="verification" style="text-align: center; border-top: 1px solid #ddd; padding-top: 20px;">
                            <div class="row">
                                <div class="col-8">
                                    <p style="font-size: 12px; text-align: left;">
                                        <strong>Certificate Verification:</strong><br/>
                                        This certificate can be verified online using the QR code or by visiting our website 
                                        and entering certificate number: <strong><span t-field="service.name"/></strong><br/>
                                        
                                        <strong>Legal Statement:</strong> This certificate serves as legal proof of destruction 
                                        and satisfies regulatory compliance requirements for data protection laws including 
                                        HIPAA, FACTA, SOX, and GDPR.
                                    </p>
                                </div>
                                <div class="col-4" style="text-align: center;">
                                    <!-- QR Code for verification -->
                                    <img t-att-src="'/report/barcode/QR/'+service.name+'?width=100&amp;height=100'" 
                                         alt="Certificate Verification QR Code" style="width: 100px; height: 100px;"/>
                                    <p style="font-size: 10px; margin-top: 5px;">Scan to verify certificate</p>
                                </div>
                            </div>
                            
                            <p style="font-size: 10px; color: #666; margin-top: 20px;">
                                Certificate generated on <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M:%S')"/> | 
                                NAID Member ID: <span t-field="env.company.naid_member_id"/> | 
                                Page <span class="page"/> of <span class="topage"/>
                            </p>
                        </div>
                    </t>
                </div>
            </t>
        </template>

        <!-- Walk-in Destruction Certificate (for POS integration) -->
        <record id="action_walkin_destruction_certificate" model="ir.actions.report">
            <field name="name">Walk-in Destruction Certificate</field>
            <field name="model">pos.order</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">records_management.walkin_destruction_certificate_template</field>
            <field name="report_file">records_management.walkin_destruction_certificate</field>
            <field name="binding_model_id" ref="point_of_sale.model_pos_order"/>
            <field name="binding_type">report</field>
        </record>

        <!-- Walk-in Destruction Template (Simplified for POS) -->
        <template id="walkin_destruction_certificate_template">
            <t t-call="web.external_layout">
                <div class="page">
                    <t t-foreach="docs" t-as="order">
                        <div class="certificate-header" style="text-align: center; border: 2px solid #000; padding: 15px; margin-bottom: 20px;">
                            <h1 style="color: #d32f2f; margin: 0;">WALK-IN DESTRUCTION CERTIFICATE</h1>
                            <h2 style="margin: 10px 0;">NAID AAA CERTIFIED</h2>
                        </div>

                        <div class="service-info">
                            <div class="row">
                                <div class="col-6">
                                    <p><strong>Transaction:</strong> <span t-field="order.name"/></p>
                                    <p><strong>Date:</strong> <span t-field="order.date_order" t-options="{'widget': 'datetime'}"/></p>
                                    <p><strong>Customer:</strong> <span t-field="order.partner_id.name"/></p>
                                </div>
                                <div class="col-6">
                                    <p><strong>Total Amount:</strong> <span t-field="order.amount_total" t-options="{'widget': 'monetary', 'display_currency': order.currency_id}"/></p>
                                    <p><strong>Payment Method:</strong> <span t-field="order.payment_ids[0].payment_method_id.name" t-if="order.payment_ids"/></p>
                                </div>
                            </div>
                        </div>

                        <div class="destruction-statement" style="border: 1px solid #ddd; padding: 15px; margin: 20px 0; background-color: #f8f9fa;">
                            <h4>Destruction Confirmation</h4>
                            <p>
                                This certificate confirms the secure destruction of customer-provided materials 
                                in accordance with NAID AAA standards. All materials were destroyed using 
                                cross-cut shredding methods ensuring complete data obliteration.
                            </p>
                            
                            <div class="row" style="margin-top: 15px;">
                                <div class="col-6">
                                    <p><strong>Items Destroyed:</strong></p>
                                    <ul>
                                        <t t-foreach="order.lines" t-as="line">
                                            <li><span t-field="line.product_id.name"/> (Qty: <span t-field="line.qty"/>)</li>
                                        </t>
                                    </ul>
                                </div>
                                <div class="col-6">
                                    <p><strong>Destruction Details:</strong></p>
                                    <p>Method: Cross-cut shredding</p>
                                    <p>Particle Size: ≤ 2mm x 15mm</p>
                                    <p>Technician: <span t-field="order.user_id.name"/></p>
                                </div>
                            </div>
                        </div>

                        <div class="verification" style="text-align: center; margin-top: 30px;">
                            <img t-att-src="'/report/barcode/QR/'+order.name+'?width=80&amp;height=80'" 
                                 alt="Certificate Verification" style="width: 80px; height: 80px;"/>
                            <p style="font-size: 12px; margin-top: 10px;">
                                Certificate: <span t-field="order.name"/><br/>
                                Generated: <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                            </p>
                        </div>
                    </t>
                </div>
            </t>
        </template>
    </data>
</odoo>
