<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Portal Quote PDF Template -->
    <template id="portal_quote_pdf">
        <t t-call="web.external_layout">
            <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)"/>
            <div class="page">
                <!-- Header Section -->
                <div class="row mb-4">
                    <div class="col-8">
                        <h1 class="text-primary">
                            <i class="fa fa-file-text-o"/> Service Quote
                        </h1>
                        <h3 class="text-muted">For: <span t-field="o.partner_id.name" class="text-dark"/></h3>
                    </div>
                    <div class="col-4 text-right">
                        <div class="company-info">
                            <strong>Sun City Shred</strong><br/>
                            <small class="text-muted">Secure Document Management</small><br/>
                            <small class="text-muted">NAID AAA Certified</small>
                        </div>
                        <p class="text-muted mt-3">
                            <strong>Quote Date:</strong><br/>
                            <span t-esc="datetime.datetime.now().strftime('%B %d, %Y')"/>
                        </p>
                    </div>
                </div>

                <!-- Customer Information -->
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h4 class="mb-0"><i class="fa fa-building"/> Customer Information</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>Company:</strong></td>
                                        <td><span t-field="o.partner_id.name"/></td>
                                    </tr>
                                    <tr t-if="o.partner_id.contact_address_complete">
                                        <td><strong>Address:</strong></td>
                                        <td><span t-field="o.partner_id.contact_address_complete"/></td>
                                    </tr>
                                    <tr t-if="o.partner_id.phone">
                                        <td><strong>Phone:</strong></td>
                                        <td><span t-field="o.partner_id.phone"/></td>
                                    </tr>
                                    <tr t-if="o.partner_id.email">
                                        <td><strong>Email:</strong></td>
                                        <td><span t-field="o.partner_id.email"/></td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-borderless">
                                    <tr t-if="o.quote_number">
                                        <td><strong>Quote #:</strong></td>
                                        <td><span t-field="o.quote_number"/></td>
                                    </tr>
                                    <tr t-if="o.partner_id.customer_type">
                                        <td><strong>Customer Type:</strong></td>
                                        <td>
                                            <span t-field="o.partner_id.customer_type" class="badge badge-info"/>
                                        </td>
                                    </tr>
                                    <tr t-if="o.partner_id.special_rate">
                                        <td><strong>Special Pricing:</strong></td>
                                        <td>
                                            <span class="badge badge-success">
                                                <i class="fa fa-star"/> Preferred Customer
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Valid Until:</strong></td>
                                        <td>
                                            <span t-esc="(datetime.datetime.now() + datetime.timedelta(days=30)).strftime('%B %d, %Y')"/>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Service Quote Lines -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="fa fa-list"/> Service Details &amp; Pricing</h4>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-striped mb-0">
                                <thead class="thead-light">
                                    <tr>
                                        <th width="40%">Service Description</th>
                                        <th width="15%" class="text-center">Quantity</th>
                                        <th width="15%" class="text-right">Unit Price</th>
                                        <th width="15%" class="text-right">Discount</th>
                                        <th width="15%" class="text-right">Line Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="o.quote_line_ids" t-as="line">
                                        <tr>
                                            <td>
                                                <strong t-field="line.service_name"/>
                                                <div t-if="line.description" class="text-muted small">
                                                    <span t-field="line.description"/>
                                                </div>
                                                <t t-if="line.special_rate">
                                                    <span class="badge badge-warning badge-sm mt-1">
                                                        <i class="fa fa-star"/> Special Rate Applied
                                                    </span>
                                                </t>
                                            </td>
                                            <td class="text-center">
                                                <span t-field="line.quantity"/>
                                                <small class="text-muted d-block" t-field="line.unit_of_measure"/>
                                            </td>
                                            <td class="text-right">
                                                <span t-if="not line.special_rate" t-field="line.standard_rate" 
                                                      t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                <span t-if="line.special_rate">
                                                    <del class="text-muted" t-field="line.standard_rate" 
                                                         t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                    <br/>
                                                    <span class="text-success font-weight-bold" t-field="line.special_rate" 
                                                          t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                                </span>
                                            </td>
                                            <td class="text-right">
                                                <t t-if="line.discount_percent > 0">
                                                    <span class="text-success">
                                                        <span t-field="line.discount_percent"/>%
                                                    </span>
                                                </t>
                                                <t t-else="">
                                                    <span class="text-muted">-</span>
                                                </t>
                                            </td>
                                            <td class="text-right font-weight-bold">
                                                <span t-field="line.line_total" 
                                                      t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Quote Summary -->
                <div class="row">
                    <div class="col-md-8">
                        <!-- Additional Services Section -->
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="fa fa-plus-circle"/> Additional Services Available</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li><i class="fa fa-check text-success"/> NAID AAA Certified Destruction</li>
                                    <li><i class="fa fa-check text-success"/> Certificate of Destruction</li>
                                    <li><i class="fa fa-check text-success"/> Scheduled Pickup Service</li>
                                    <li><i class="fa fa-check text-success"/> Secure Storage Solutions</li>
                                    <li><i class="fa fa-check text-success"/> Document Scanning Services</li>
                                    <li><i class="fa fa-check text-success"/> Emergency Destruction Services</li>
                                </ul>
                                <p class="text-muted small mt-3">
                                    Contact us for pricing on additional services not included in this quote.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <!-- Totals Summary -->
                        <div class="card">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="fa fa-calculator"/> Quote Summary</h5>
                            </div>
                            <div class="card-body">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>Subtotal:</strong></td>
                                        <td class="text-right">
                                            <span t-field="o.subtotal" 
                                                  t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                        </td>
                                    </tr>
                                    <tr t-if="o.total_discount > 0">
                                        <td><strong>Total Discounts:</strong></td>
                                        <td class="text-right text-success">
                                            -<span t-field="o.total_discount" 
                                                   t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                        </td>
                                    </tr>
                                    <tr t-if="o.tax_amount > 0">
                                        <td><strong>Tax:</strong></td>
                                        <td class="text-right">
                                            <span t-field="o.tax_amount" 
                                                  t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                        </td>
                                    </tr>
                                    <tr class="border-top">
                                        <td><strong class="h5">Total:</strong></td>
                                        <td class="text-right">
                                            <strong class="h5 text-primary" t-field="o.total_amount" 
                                                    t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                        </td>
                                    </tr>
                                </table>
                                
                                <div class="alert alert-info mt-3" t-if="o.partner_id.special_rate">
                                    <small>
                                        <i class="fa fa-info-circle"/> Special customer pricing applied. 
                                        Standard rates shown with discount.
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Terms and Conditions -->
                <div class="card mt-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fa fa-exclamation-triangle"/> Terms &amp; Conditions</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Service Terms:</h6>
                                <ul class="small">
                                    <li>Quote valid for 30 days from issue date</li>
                                    <li>Services subject to NAID AAA compliance standards</li>
                                    <li>Pickup scheduling based on service area and availability</li>
                                    <li>Additional fees may apply for special handling requirements</li>
                                    <li>Certificate of Destruction provided within 48 hours</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Payment Terms:</h6>
                                <ul class="small">
                                    <li>Payment due within 30 days of service completion</li>
                                    <li>Accepted payment methods: Check, ACH, Credit Card</li>
                                    <li>Late payment fee: 1.5% per month on overdue amounts</li>
                                    <li>All prices are in USD and exclude applicable taxes</li>
                                    <li>Special rates subject to contract terms and minimum volumes</li>
                                </ul>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <p class="text-muted small">
                                    <strong>NAID AAA Certification:</strong> 
                                    Sun City Shred is NAID AAA certified for secure destruction services. 
                                    All services are performed in accordance with NAID AAA standards and regulations. 
                                    This quote constitutes our agreement to provide services at the specified rates 
                                    subject to the terms and conditions outlined herein.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact Information Footer -->
                <div class="card mt-4">
                    <div class="card-footer bg-light">
                        <div class="row">
                            <div class="col-md-8">
                                <h6>Questions about this quote?</h6>
                                <p class="mb-0">
                                    Contact our customer service team for clarification on services, 
                                    pricing, or scheduling. We're here to help with all your secure 
                                    document management needs.
                                </p>
                            </div>
                            <div class="col-md-4 text-right">
                                <strong>Contact Information:</strong><br/>
                                <i class="fa fa-phone"/> Phone: (555) 123-4567<br/>
                                <i class="fa fa-envelope"/> Email: quotes@suncityshred.com<br/>
                                <i class="fa fa-globe"/> Web: www.suncityshred.com
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Custom Styling -->
            <style>
                .company-info {
                    text-align: right;
                    border: 1px solid #dee2e6;
                    padding: 15px;
                    border-radius: 5px;
                    background: #f8f9fa;
                }
                .service-description {
                    line-height: 1.4;
                }
                .special-rate-highlight {
                    background: linear-gradient(45deg, #fff3cd, #ffeaa7);
                    padding: 2px 5px;
                    border-radius: 3px;
                }
                .total-highlight {
                    background: #e3f2fd;
                    padding: 10px;
                    border-radius: 5px;
                    border-left: 4px solid #2196f3;
                }
                @media print {
                    .page-break {
                        page-break-before: always;
                    }
                    .no-print {
                        display: none;
                    }
                }
            </style>
        </t>
    </template>

    <!-- Simplified Quote Template for Quick Generation -->
    <template id="portal_quote_simple">
        <t t-call="web.basic_layout">
            <div class="page">
                <div class="text-center mb-4">
                    <h2>Service Quote</h2>
                    <h4>Sun City Shred - NAID AAA Certified</h4>
                </div>
                
                <div class="row mb-3">
                    <div class="col-6">
                        <strong>Customer:</strong> <span t-field="o.partner_id.name"/>
                    </div>
                    <div class="col-6 text-right">
                        <strong>Date:</strong> <span t-esc="datetime.datetime.now().strftime('%m/%d/%Y')"/>
                    </div>
                </div>

                <table class="table table-bordered">
                    <thead>
                        <tr class="table-primary">
                            <th>Service</th>
                            <th class="text-center">Qty</th>
                            <th class="text-right">Rate</th>
                            <th class="text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="o.quote_line_ids" t-as="line">
                            <tr>
                                <td>
                                    <span t-field="line.service_name"/>
                                    <small t-if="line.special_rate" class="text-success"> (Special Rate)</small>
                                </td>
                                <td class="text-center"><span t-field="line.quantity"/></td>
                                <td class="text-right">
                                    <span t-field="line.unit_price" 
                                          t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                </td>
                                <td class="text-right">
                                    <span t-field="line.line_total" 
                                          t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                    <tfoot>
                        <tr class="table-secondary">
                            <th colspan="3" class="text-right">Total:</th>
                            <th class="text-right">
                                <span t-field="o.total_amount" 
                                      t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                            </th>
                        </tr>
                    </tfoot>
                </table>

                <div class="mt-4">
                    <small class="text-muted">
                        Quote valid for 30 days. NAID AAA certified secure destruction services.
                        Contact us at quotes@suncityshred.com for questions.
                    </small>
                </div>
            </div>
        </t>
    </template>

    <!-- Report Actions -->
    <report
        id="action_portal_quote_pdf"
        string="Service Quote"
        model="portal.request"
        report_type="qweb-pdf"
        name="records_management.portal_quote_pdf"
        file="records_management.portal_quote_pdf"
        print_report_name="'Quote_%s_%s' % (object.partner_id.name.replace(' ', '_'), datetime.datetime.now().strftime('%Y%m%d'))"
        paperformat="base.paperformat_us"
    />

    <report
        id="action_portal_quote_simple_pdf"
        string="Simple Quote"
        model="portal.request"
        report_type="qweb-pdf"
        name="records_management.portal_quote_simple"
        file="records_management.portal_quote_simple"
        print_report_name="'Simple_Quote_%s_%s' % (object.partner_id.name.replace(' ', '_'), datetime.datetime.now().strftime('%Y%m%d'))"
        paperformat="base.paperformat_us"
    />

</odoo>
