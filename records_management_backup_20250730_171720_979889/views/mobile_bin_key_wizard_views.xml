<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Mobile Bin Key Management Wizard Form -->
    <record id="view_mobile_bin_key_wizard_form" model="ir.ui.view">
        <field name="name">mobile.bin.key.wizard.form</field>
        <field name="model">mobile.bin.key.wizard</field>
        <field name="arch" type="xml">
            <form string="Mobile Bin Key Management">
                <div class="o_form_sheet" style="max-width: 100%; padding: 10px;">

                    <!-- Header with action type selector -->
                    <div class="row">
                        <div class="col-12">
                            <div class="alert alert-info" role="alert">
                                <h4 class="alert-heading">🔑 Mobile Key Management</h4>
                                <p>Quick access for field technicians to manage bin keys and services</p>
                            </div>
                        </div>
                    </div>

                    <!-- Action Type Selection -->
                    <group string="🎯 Select Action">
                        <field name="action_type" widget="radio" options="{'horizontal': false}"/>
                    </group>

                    <!-- Customer Company Selection -->
                    <group string="🏢 Customer Company" attrs="{'invisible': [('action_type', '=', False)]}">
                        <field name="customer_company_id" options="{'no_create_edit': True}" placeholder="Search for customer company..."/>
                    </group>

                    <!-- Contact Selection (for existing contacts) -->
                    <group string="👤 Contact Selection" attrs="{'invisible': ['|', 
                                    ('action_type', 'not in', ['update_existing', 'create_unlock_service']),
                                    ('customer_company_id', '=', False)]}">
                        <field name="contact_id" options="{'no_create_edit': True}" attrs="{'required': [('action_type', 'in', ['update_existing', 'create_unlock_service'])]}" placeholder="Search for contact..."/>
                    </group>

                    <!-- New Contact Creation -->
                    <group string="➕ Create New Contact" attrs="{'invisible': ['|', 
                                    ('action_type', 'not in', ['issue_new']),
                                    ('customer_company_id', '=', False)]}">
                        <field name="create_new_contact"/>
                        <field name="contact_name" attrs="{'required': [('create_new_contact', '=', True)],
                                       'invisible': [('create_new_contact', '=', False)]}" placeholder="Enter contact name..."/>
                        <field name="contact_email" attrs="{'invisible': [('create_new_contact', '=', False)]}" placeholder="email@company.com"/>
                        <field name="contact_phone" attrs="{'invisible': [('create_new_contact', '=', False)]}" placeholder="(555) 123-4567"/>
                        <field name="contact_mobile" attrs="{'invisible': [('create_new_contact', '=', False)]}" placeholder="(555) 987-6543"/>
                        <field name="contact_title" attrs="{'invisible': [('create_new_contact', '=', False)]}" placeholder="Job title or position"/>
                    </group>

                    <!-- Key Assignment Details -->
                    <group string="🔑 Key Assignment Details" attrs="{'invisible': [('show_key_assignment', '=', False)]}">
                        <field name="issue_location" placeholder="Where is the key being issued? (e.g., loading dock, main office)"/>
                        <field name="bin_locations" placeholder="List the bin locations this key provides access to..."/>
                        <field name="emergency_contact"/>
                        <field name="key_notes" placeholder="Additional notes about this key assignment..."/>
                    </group>

                    <!-- Unlock Service Details -->
                    <group string="🔓 Unlock Service Details" attrs="{'invisible': [('show_unlock_service', '=', False)]}">
                        <field name="unlock_reason" attrs="{'required': [('action_type', '=', 'create_unlock_service')]}"/>
                        <field name="unlock_reason_description" placeholder="Describe why the unlock was needed..."/>
                        <field name="unlock_bin_location" attrs="{'required': [('action_type', '=', 'create_unlock_service')]}" placeholder="Specific bin location that was unlocked"/>
                        <field name="items_retrieved" placeholder="Describe any items retrieved from the bin..."/>
                        <field name="unlock_charge"/>
                        <field name="billable"/>
                    </group>

                    <!-- Service Documentation -->
                    <group string="📸 Service Documentation" attrs="{'invisible': [('action_type', 'not in', ['create_unlock_service'])]}">
                        <field name="photo_ids" widget="many2many_binary" options="{'accepted_file_extensions': '.jpg,.jpeg,.png,.gif'}"/>
                        <field name="service_notes" placeholder="Additional notes about the service..."/>
                    </group>

                    <!-- Key Lookup Results -->
                    <div attrs="{'invisible': [('show_lookup_results', '=', False)]}">
                        <separator string="🔍 Key Holders Lookup"/>
                        <field name="key_lookup_results" widget="html" readonly="1"/>
                    </div>

                    <!-- Hidden computed fields -->
                    <field name="show_contact_creation" invisible="1"/>
                    <field name="show_key_assignment" invisible="1"/>
                    <field name="show_unlock_service" invisible="1"/>
                    <field name="show_lookup_results" invisible="1"/>

                </div>

                <!-- Footer with action buttons -->
                <footer>
                    <div class="row">
                        <div class="col-6">
                            <button string="❌ Cancel" class="btn btn-secondary btn-block" special="cancel"/>
                        </div>
                        <div class="col-6">
                            <button string="✅ Execute" class="btn btn-primary btn-block" name="action_execute" type="object" attrs="{'invisible': [('action_type', '=', 'quick_lookup')]}"/>
                            <button string="🔄 Refresh Lookup" class="btn btn-info btn-block" name="action_execute" type="object" attrs="{'invisible': [('action_type', '!=', 'quick_lookup')]}"/>
                        </div>
                    </div>
                </footer>
            </form>
        </field>
    </record>

    <!-- Mobile Action to open wizard -->
    <record id="action_mobile_bin_key_wizard" model="ir.actions.act_window">
        <field name="name">Mobile Key Management</field>
        <field name="res_model">mobile.bin.key.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

    <!-- Menu item for mobile users -->
    <menuitem id="menu_mobile_bin_key_wizard" name="📱 Mobile Key Manager" parent="records_management.menu_records_management_root" action="action_mobile_bin_key_wizard" sequence="5" groups="records_management.group_records_user"/>

    <!-- Shortcut action for quick access -->
    <record id="action_mobile_key_shortcut" model="ir.actions.server">
        <field name="name">🔑 Quick Key Access</field>
        <field name="model_id" ref="model_mobile_bin_key_wizard"/>
        <field name="state">code</field>
        <field name="code">
action = {
    'type': 'ir.actions.act_window',
    'name': 'Mobile Key Management',
    'res_model': 'mobile.bin.key.wizard',
    'view_mode': 'form',
    'target': 'new',
    'context': {'default_action_type': 'issue_new'}
}
        </field>
    </record>

</odoo>
