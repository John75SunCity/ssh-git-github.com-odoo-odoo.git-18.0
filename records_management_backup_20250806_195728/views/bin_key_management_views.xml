<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Bin Key Management Tree View -->
    <record id="view_bin_key_management_tree" model="ir.ui.view">
        <field name="name">bin.key.management.tree</field>
        <field name="model">bin.key.management</field>
        <field name="arch" type="xml">
            <tree string="Bin Key Management" decoration-success="status == 'issued'" decoration-warning="status == 'lost'" decoration-danger="status == 'replaced'">
                <field name="key_number"/>
                <field name="partner_id"/>
                <field name="partner_company"/>
                <field name="status" widget="badge" decoration-success="status == 'issued'" decoration-info="status == 'returned'" decoration-warning="status == 'lost'" decoration-danger="status == 'replaced'"/>
                <field name="issue_date"/>
                <field name="return_date"/>
                <field name="issue_location"/>
                <field name="emergency_contact" widget="boolean_toggle"/>
                <field name="company_id" optional="hide"/>
            </tree>
        </field>
    </record>

    <!-- Bin Key Management Form View -->
    <record id="view_bin_key_management_form" model="ir.ui.view">
        <field name="name">bin.key.management.form</field>
        <field name="model">bin.key.management</field>
        <field name="arch" type="xml">
            <form string="Bin Key Management">
                <header>
                    <button name="action_return_key" string="ðŸ”„ Return Key" type="object" class="btn-warning" attrs="{'invisible': [('status', '!=', 'issued')]}"/>
                    <button name="action_mark_lost" string="âš ï¸ Mark Lost" type="object" class="btn-danger" attrs="{'invisible': [('status', '!=', 'issued')]}"/>
                    <button name="action_replace_key" string="ðŸ”„ Replace Key" type="object" class="btn-info" attrs="{'invisible': [('status', '!=', 'lost')]}"/>
                    <field name="status" widget="statusbar" statusbar_visible="issued,returned,lost,replaced"/>
                </header>

                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_unlock_services" type="object" class="oe_stat_button" icon="fa-unlock-alt">
                            <field name="unlock_service_count" widget="statbutton" string="Unlock Services"/>
                        </button>
                    </div>

                    <div class="oe_title">
                        <h1>
                            <field name="key_number" readonly="1"/>
                        </h1>
                        <h2>
                            <field name="partner_id" options="{'no_create_edit': True}"/>
                        </h2>
                    </div>

                    <group>
                        <group string="Key Information">
                            <field name="partner_company" readonly="1"/>
                            <field name="issue_location"/>
                            <field name="bin_locations"/>
                            <field name="emergency_contact"/>
                        </group>
                        <group string="Dates">
                            <field name="issue_date" readonly="1"/>
                            <field name="return_date" readonly="1"/>
                            <field name="expected_return_date"/>
                        </group>
                    </group>

                    <group string="Replacement Chain" attrs="{'invisible': [('replacement_of_id', '=', False), ('replaced_by_id', '=', False)]}">
                        <field name="replacement_of_id" readonly="1"/>
                        <field name="replaced_by_id" readonly="1"/>
                    </group>

                    <notebook>
                        <page string="Notes &amp; Details">
                            <field name="notes" placeholder="Additional notes about this key assignment..."/>
                        </page>
                        <page string="Unlock Services" attrs="{'invisible': [('unlock_service_count', '=', 0)]}">
                            <field name="unlock_service_ids" readonly="1">
                                <tree>
                                    <field name="service_number"/>
                                    <field name="service_date"/>
                                    <field name="bin_location"/>
                                    <field name="unlock_reason"/>
                                    <field name="charge_amount"/>
                                    <field name="billable"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>

                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Bin Key Management Kanban View -->
    <record id="view_bin_key_management_kanban" model="ir.ui.view">
        <field name="name">bin.key.management.kanban</field>
        <field name="model">bin.key.management</field>
        <field name="arch" type="xml">
            <kanban default_group_by="status" class="o_kanban_small_column">
                <field name="partner_id"/>
                <field name="partner_company"/>
                <field name="key_number"/>
                <field name="issue_date"/>
                <field name="emergency_contact"/>
                <field name="status"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_record_top mb8">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title">
                                        ðŸ”‘                                        <field name="key_number"/>
                                    </strong>
                                    <br/>
                                    <span class="o_kanban_record_subtitle text-muted">
                                        <field name="partner_id"/>
                                    </span>
                                </div>
                                <div class="o_kanban_manage_button_section">
                                    <t t-if="record.emergency_contact.raw_value">
                                        <span class="badge badge-danger">ðŸš¨ Emergency</span>
                                    </t>
                                </div>
                            </div>
                            <div class="o_kanban_record_body">
                                <field name="partner_company"/>
                                <br/>
                                <i class="fa fa-calendar"/>
                                <field name="issue_date"/>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Bin Unlock Service Tree View -->
    <record id="view_bin_unlock_service_tree" model="ir.ui.view">
        <field name="name">bin.unlock.service.tree</field>
        <field name="model">bin.unlock.service</field>
        <field name="arch" type="xml">
            <tree string="Bin Unlock Services" decoration-success="billable == True" decoration-warning="billable == False">
                <field name="service_number"/>
                <field name="partner_id"/>
                <field name="service_date"/>
                <field name="bin_location"/>
                <field name="unlock_reason"/>
                <field name="charge_amount" sum="Total"/>
                <field name="billable" widget="boolean_toggle"/>
                <field name="technician_id"/>
                <field name="invoice_created" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>

    <!-- Bin Unlock Service Form View -->
    <record id="view_bin_unlock_service_form" model="ir.ui.view">
        <field name="name">bin.unlock.service.form</field>
        <field name="model">bin.unlock.service</field>
        <field name="arch" type="xml">
            <form string="Bin Unlock Service">
                <header>
                    <button name="action_create_invoice" string="ðŸ’° Create Invoice" type="object" class="btn-primary" attrs="{'invisible': ['|', ('billable', '=', False), ('invoice_created', '=', True)]}"/>
                    <button name="action_mark_completed" string="âœ… Mark Completed" type="object" class="btn-success" attrs="{'invisible': [('completed', '=', True)]}"/>
                </header>

                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="service_number" readonly="1"/>
                        </h1>
                        <h2>
                            Unlock Service for <field name="partner_id" options="{'no_create_edit': True}"/>
                        </h2>
                    </div>

                    <group>
                        <group string="Service Details">
                            <field name="service_date"/>
                            <field name="bin_location"/>
                            <field name="unlock_reason"/>
                            <field name="technician_id"/>
                            <field name="key_holder_id" readonly="1"/>
                        </group>
                        <group string="Billing">
                            <field name="charge_amount"/>
                            <field name="billable"/>
                            <field name="invoice_created" readonly="1"/>
                            <field name="completed"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Details">
                            <group>
                                <field name="reason_description" placeholder="Detailed description of why unlock was needed..."/>
                                <field name="items_retrieved" placeholder="Description of items retrieved from the bin..."/>
                                <field name="notes" placeholder="Additional service notes..."/>
                            </group>
                        </page>
                        <page string="Photos">
                            <field name="photo_ids" widget="many2many_binary"/>
                        </page>
                    </notebook>
                </sheet>

                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_bin_key_management" model="ir.actions.act_window">
        <field name="name">Bin Key Management</field>
        <field name="res_model">bin.key.management</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first bin key assignment!
            </p>
            <p>
                Track which contacts have bin keys, manage key returns, and handle replacements.
            </p>
        </field>
    </record>

    <record id="action_bin_unlock_service" model="ir.actions.act_window">
        <field name="name">Bin Unlock Services</field>
        <field name="res_model">bin.unlock.service</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Record your first bin unlock service!
            </p>
            <p>
                Track unlock services and automatically bill customers $25 for each service.
            </p>
        </field>
    </record>

    <!-- Menu Items -->
    <menuitem id="menu_bin_key_management" name="ðŸ”‘ Bin Key Management" parent="records_management.menu_records_management_root" action="action_bin_key_management" sequence="10"/>

    <menuitem id="menu_bin_unlock_services" name="ðŸ”“ Unlock Services" parent="records_management.menu_records_management_root" action="action_bin_unlock_service" sequence="11"/>

</odoo>
